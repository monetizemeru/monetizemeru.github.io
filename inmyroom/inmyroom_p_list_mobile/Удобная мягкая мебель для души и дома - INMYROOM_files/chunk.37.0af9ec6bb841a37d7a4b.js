(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{593:function(t,e,n){"use strict";n.r(e),n.d(e,"CommentsWidget",(function(){return at}));var r=n(3),o=n(19),c=n(2),i=n.n(c),a=n(8),u=n(374);function s(t,e,n,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var c=t.apply(e,n);function i(t){s(c,r,o,i,a,"next",t)}function a(t){s(c,r,o,i,a,"throw",t)}i(void 0)}))}}var m=Object(r.b)((function(t){var e=function(e){return f(i.a.mark((function r(){var o,c,a,u;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.e(50).then(n.bind(null,458));case 2:o=r.sent,c=o.PhotoModal,a=o.PhotoListCursor,u=new a({list:function(){return t.getProps().photos.map((function(t){return t.id}))}}).moveTo(e.id),c.open(u);case 7:case"end":return r.stop()}}),r)})))};return{render:function(t){var n=t.photos;return Object(r.f)("div",{class:"b-Comment_photos"},n.map((function(t){return Object(r.f)("div",{style:"background-image: url(".concat(t.image_url,")"),onClick:e(t)})})))}}})),l=n(34);var p=Object(r.b)((function(t){var e=null,n=function(){requestAnimationFrame((function(){e.style.height="auto";var t=e.offsetHeight-e.clientHeight,n=e.scrollHeight+t;e.style.height="".concat(n,"px")}))};return{render:function(t){var o=t.changeHandler,c=t.value,i=t.placeholder;return Object(r.f)("textarea",{onChange:o,onInput:n,value:c,placeholder:i,ref:function(t){return e=t}})},componentDidMount:function(){t.getProps().autoFocus&&e.focus()}}}));function b(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var v=Object(r.b)((function(t){t.setState({photos:[],text:""});var e=function(t){var e=t.isLoading;return Object(a.a)(["b-CommentForm",{"is-loading":e}])},n=function(){var e=t.getState(),n=e.text,r=e.photos;(0,t.getProps().onSubmit)({text:n,photos:r})},o=function(e){var n=new FileReader,r=e.target.files[0];n.onloadend=function(){return t.setState((function(t){return{photos:[].concat(b(t.photos),[{id:Object(l.a)(),src:n.result,file:r}])}}))},n.readAsDataURL(e.target.files[0])},c=function(e){return function(){t.setState((function(t){return{photos:t.photos.filter((function(t){return t.id!==e.id}))}}))}},i=function(e){t.setState({text:e.target.value})};return{render:function(t,a){var u=t.state,s=t.isLoading;t._onSubmit;return Object(r.f)("div",{class:e({isLoading:s})},Object(r.f)("div",{class:"b-CommentForm_avatar"},u.currentUser&&Object(r.f)("img",{src:u.currentUser.avatarUrl})),Object(r.f)("div",{class:"b-CommentForm_main"},Object(r.f)(p,{value:a.text,autoFocus:!0,changeHandler:i,placeholder:"Комментарий"}),Object(r.f)("div",{class:"b-CommentForm_actions"},Object(r.f)("div",{class:"b-CommentForm_btn-upload-photo"},"Фото",Object(r.f)("input",{type:"file",onChange:o})),Object(r.f)("div",{class:"b-CommentForm_btn-submit",onClick:n},"Добавить комментарий"))),Object(r.f)("div",{class:"b-CommentForm_photos"},a.photos.map((function(t){return Object(r.f)("div",{onClick:c(t),style:"background-image: url(".concat(t.src,")")})}))))}}})),O=n(4);function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){h(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(t){return function(t){if(Array.isArray(t))return w(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _=function(t,e){var n=t.filter((function(t){return t.id===e.parent_id||t.ancestor_ids.includes(e.parent_id)})).pop();return t.reduce((function(t,r){return r.id===n.id?[].concat(g(t),[r,e]):[].concat(g(t),[r])}),[])},P=function(t,e){return[].concat(g(t),[e])};function C(t,e){var n=e.comment,r=n.parent_id?_:P;return j(j({},t),{},{comments:r(t.comments,n),initialCommentsLimit:null})}function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function D(t,e,n,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}var A=function(t){var e=t.objectId,n=t.objectType,r=t.parentComment,o=t.text,c=t.photos,i=new FormData;return i.append("commentable_id",e),i.append("commentable_type",n),i.append("comment[raw_content]",o),r&&i.append("comment[parent_id]",r.id),c.forEach((function(t,e){var n=t.file;i.append("photo[".concat(e,"][file]"),n)})),i};function F(t){return function(){var e,n=(e=i.a.mark((function e(n){var r,o,c,a,u,s,f,m,l,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.text,o=n.photos,c=n.parentComment,a=void 0===c?null:c,u=t.getState(),s=u.objectId,f=u.objectType,m=A({parentComment:a,objectType:f,objectId:s,photos:o,text:r}),e.next=5,O.a.put("/front_api/comments",{data:m});case 5:l=e.sent,p=l.comment,t.commit(C,{comment:k(k({},p),{},{is_new:!0})});case 8:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var c=e.apply(t,n);function i(t){D(c,r,o,i,a,"next",t)}function a(t){D(c,r,o,i,a,"throw",t)}i(void 0)}))});return function(t){return n.apply(this,arguments)}}()}function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){L(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function T(t,e){var n=e.comment.id;return I(I({},t),{},{comments:t.comments.map((function(t){return t.id===n?function(t){return I(I({},t),{},{is_liked:!t.is_liked,likes_count:t.is_liked?t.likes_count-1:t.likes_count+1})}(t):t}))})}function R(t,e,n,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}function M(t){return function(){var e,n=(e=i.a.mark((function e(n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.comment,e.next=3,O.a.post("/front_api/comments/".concat(r.id,"/like"));case 3:t.commit(T,{comment:r});case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var c=e.apply(t,n);function i(t){R(c,r,o,i,a,"next",t)}function a(t){R(c,r,o,i,a,"throw",t)}i(void 0)}))});return function(t){return n.apply(this,arguments)}}()}function V(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function U(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?V(Object(n),!0).forEach((function(e){H(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function H(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $(t,e){var n=e.comment.id;return U(U({},t),{},{comments:t.comments.map((function(t){return t.id===n?function(t){return U(U({},t),{},{is_hidden:!t.is_hidden})}(t):t}))})}function J(t,e,n,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}function q(t){return function(){var e,n=(e=i.a.mark((function e(n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.comment,e.next=3,O.a.post("/front_api/comments/".concat(r.id,"/toggle"));case 3:t.commit($,{comment:r});case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var c=e.apply(t,n);function i(t){J(c,r,o,i,a,"next",t)}function a(t){J(c,r,o,i,a,"throw",t)}i(void 0)}))});return function(t){return n.apply(this,arguments)}}()}function B(t){return function(t){if(Array.isArray(t))return K(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return K(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return K(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function N(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?N(Object(n),!0).forEach((function(e){z(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function z(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function G(t,e){var n=e.comment.id;return W(W({},t),{},{comments:t.comments.reduce((function(t,e){return e.id===n||e.ancestor_ids.includes(n)?B(t):[].concat(B(t),[e])}),[])})}function Q(t,e,n,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}function X(t){return function(){var e,n=(e=i.a.mark((function e(n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.comment,e.next=3,O.a.delete("/front_api/comments/".concat(r.id));case 3:t.commit(G,{comment:r});case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var c=e.apply(t,n);function i(t){Q(c,r,o,i,a,"next",t)}function a(t){Q(c,r,o,i,a,"throw",t)}i(void 0)}))});return function(t){return n.apply(this,arguments)}}()}function Y(t,e,n,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}var Z=Object(r.b)((function(t){var e=t.getContext().store,n=function(){var e=t.getProps().comment;return Object(a.a)("_action","_action__like",{"is-active":e.is_liked})},o=function(){var e=t.getProps().comment;return Object(a.a)("_action","_action__toggle",{"is-active":e.is_hidden})},c=function(){var n,r=(n=i.a.mark((function n(r){var o,c,a,u;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=r.text,c=r.photos,a=t.getProps(),u=a.comment,n.prev=2,t.setState({isReplySending:!0}),n.next=6,e.operate(F,{text:o,photos:c,parentComment:u});case 6:t.setState({isReplyFormVisible:!1});case 7:return n.prev=7,t.setState({isReplySending:!1}),n.finish(7);case 10:case"end":return n.stop()}}),n,null,[[2,,7,10]])})),function(){var t=this,e=arguments;return new Promise((function(r,o){var c=n.apply(t,e);function i(t){Y(c,r,o,i,a,"next",t)}function a(t){Y(c,r,o,i,a,"throw",t)}i(void 0)}))});return function(t){return r.apply(this,arguments)}}(),s=function(){var n=t.getProps().comment;e.operate(q,{comment:n})},f=function(){var n=t.getProps().comment;e.operate(X,{comment:n})},m=Object(u.a)((function(){var n=t.getProps().comment;n.is_liked||e.operate(M,{comment:n})})),l=Object(u.a)((function(){t.setState((function(t){return{isReplyFormVisible:!t.isReplyFormVisible}}))}));return{render:function(e,i){var u,p=e.comment,b=e.state;return Object(r.f)("div",null,Object(r.f)("div",{class:"b-Comment_actions"},Object(r.f)("div",{class:n(),onClick:m},"Нравится"),Object(r.f)("div",{class:(u=t.getState().isReplyFormVisible,Object(a.a)("_action","_action-reply",{"is-active":u})),onClick:l},"Ответить"),p.has_toggle&&Object(r.f)("div",{class:o(),onClick:s}),p.has_destroy&&Object(r.f)("div",{class:"_action _action__destroy",onClick:f},"Удалить")),Object(r.f)("div",{class:"b-Comment_reply-form"},i.isReplyFormVisible&&Object(r.f)(v,{state:b,isLoading:i.isReplySending,onSubmit:c})))}}}));var tt=Object(r.b)((function(t){var e=function(){var e=t.getProps().comment;return Object(a.a)("b-Comment","b-Comment__depth_".concat(e.depth))},n=function(){t.getProps().comment.is_new&&t.getDOMNode().scrollIntoView({behavior:"smooth"})};return{componentDidUpdate:function(){n()},componentDidMount:function(){n()},render:function(n){var o=n.state,c=n.comment;return Object(r.f)("div",{class:e()},Object(r.f)("div",{class:"b-Comment_avatar"},Object(r.f)("a",{href:c.user_url},Object(r.f)("img",{src:c.user_avatar_url}))),Object(r.f)("div",{class:"b-Comment_content"},Object(r.f)("div",{class:"b-Comment_info"},Object(r.f)("a",{href:c.user_url,class:"_author"},c.user_name),Object(r.f)("div",{class:"_date"},c.created_at),c.has_parent&&Object(r.f)("div",{class:"_parent-author"},c.parent_user_name)),Object(r.f)("div",{dangerouslySetInnerHTML:{__html:t.getProps().comment.content}}),c.likes_count>0&&Object(r.f)("div",{class:"b-Comment_likes"},c.likes_count)),Object(r.f)(m,{photos:c.photos}),Object(r.f)(Z,{comment:c,state:o}))}}}));function et(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function nt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?et(Object(n),!0).forEach((function(e){rt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function rt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ot(t){return nt(nt({},t),{},{initialCommentsLimit:null})}function ct(t,e,n,r,o,c,i){try{var a=t[c](i),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,o)}var it=Object(r.b)((function(t){var e=t.getContext().store,n=function(t){return t.initialCommentsLimit&&t.comments.length>t.initialCommentsLimit},o=function(t){return Object(a.a)(["b-Comments_list",{"has-more-comments":n(t)}])},c=function(){var n,r=(n=i.a.mark((function n(r){var o,c;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=r.text,c=r.photos,t.setState({isCommentSending:!0}),n.prev=2,n.next=5,e.operate(F,{text:o,photos:c});case 5:t.setState({isCommentFormVisible:!1});case 6:return n.prev=6,t.setState({isCommentSending:!1}),n.finish(6);case 9:case"end":return n.stop()}}),n,null,[[2,,6,9]])})),function(){var t=this,e=arguments;return new Promise((function(r,o){var c=n.apply(t,e);function i(t){ct(c,r,o,i,a,"next",t)}function a(t){ct(c,r,o,i,a,"throw",t)}i(void 0)}))});return function(t){return r.apply(this,arguments)}}(),s=Object(u.a)((function(){t.setState((function(t){return{isCommentFormVisible:!t.isCommentFormVisible}}))})),f=function(){e.commit(ot)};return{render:function(t,e){var i=t.state;return Object(r.f)("div",{class:"b-Comments_wrapper"},Object(r.f)("div",{class:"b-Comments_title"},function(t){return t.comments.length?"Комментарии: ".concat(t.comments.length):"Комментариев пока нет, будьте первым"}(i)),e.isCommentFormVisible?Object(r.f)("div",{class:"b-Comments_form"},Object(r.f)(v,{state:i,isLoading:e.isCommentSending,onSubmit:c})):Object(r.f)("div",{class:"b-Comments_btn-add-comment",onClick:s},"Оставить комментарий"),Object(r.f)("div",{class:o(i)},function(t){return n(t)?t.comments.slice(0,t.initialCommentsLimit):t.comments}(i).map((function(t){return Object(r.f)(tt,{state:i,comment:t})}))),n(i)&&Object(r.f)("div",{class:"b-Comments_btn-show-more",onClick:f},"Показать все комментарии"))}}}));function at(t,e){var n=e.props,c=n.objectId,i=n.objectType,a=n.comments,u=a.length>2?2:null,s=Object(o.b)({props:{initialState:{comments:a,objectId:c,objectType:i,initialCommentsLimit:u,currentUser:Env.user}},callbacks:{CALLBACK_AFTER_COMMIT:function(){f.render()}}}),f=Object(r.c)(t[0],(function(){return Object(r.f)(o.a,{store:s},Object(r.f)(it,{state:s.getState()}))}));return f.render(),{disconnect:function(){f.destroy()}}}}}]);
//# sourceMappingURL=sourcemap.common__c-Comments.b7c54236.map