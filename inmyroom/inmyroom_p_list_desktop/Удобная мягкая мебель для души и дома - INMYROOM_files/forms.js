!function(){"use strict";var S3_SERVER="https://personalization-web-stable.mindbox.ru",SERVER="https://personalization-web-stable.mindbox.ru",commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var underscore={exports:{}};!function(e,t){(function(){var n=this,r=n._,i=Array.prototype,o=Object.prototype,a=Function.prototype,s=i.push,c=i.slice,u=o.toString,l=o.hasOwnProperty,d=Array.isArray,f=Object.keys,h=a.bind,p=Object.create,m=function(){},g=function(e){return e instanceof g?e:this instanceof g?void(this._wrapped=e):new g(e)};e.exports&&(t=e.exports=g),t._=g,g.VERSION="1.8.3";var v=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return function(){return e.apply(t,arguments)}},_=function(e,t,n){return null==e?g.identity:g.isFunction(e)?v(e,t,n):g.isObject(e)?g.matcher(e):g.property(e)};g.iteratee=function(e,t){return _(e,t,1/0)};var y=function(e,t){return function(n){var r=arguments,i=arguments.length;if(i<2||null==n)return n;for(var o=1;o<i;o++)for(var a=r[o],s=e(a),c=s.length,u=0;u<c;u++){var l=s[u];t&&void 0!==n[l]||(n[l]=a[l])}return n}},b=function(e){if(!g.isObject(e))return{};if(p)return p(e);m.prototype=e;var t=new m;return m.prototype=null,t},S=function(e){return function(t){return null==t?void 0:t[e]}},w=Math.pow(2,53)-1,I=S("length"),C=function(e){var t=I(e);return"number"==typeof t&&t>=0&&t<=w};function P(e){function t(t,n,r,i,o,a){for(;o>=0&&o<a;o+=e){var s=i?i[o]:o;r=n(r,t[s],s,t)}return r}return function(n,r,i,o){r=v(r,o,4);var a=!C(n)&&g.keys(n),s=(a||n).length,c=e>0?0:s-1;return arguments.length<3&&(i=n[a?a[c]:c],c+=e),t(n,r,i,a,c,s)}}g.each=g.forEach=function(e,t,n){var r,i;if(t=v(t,n),C(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=g.keys(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e},g.map=g.collect=function(e,t,n){t=_(t,n);for(var r=!C(e)&&g.keys(e),i=(r||e).length,o=Array(i),a=0;a<i;a++){var s=r?r[a]:a;o[a]=t(e[s],s,e)}return o},g.reduce=g.foldl=g.inject=P(1),g.reduceRight=g.foldr=P(-1),g.find=g.detect=function(e,t,n){var r;if(void 0!==(r=C(e)?g.findIndex(e,t,n):g.findKey(e,t,n))&&-1!==r)return e[r]},g.filter=g.select=function(e,t,n){var r=[];return t=_(t,n),g.each(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r},g.reject=function(e,t,n){return g.filter(e,g.negate(_(t)),n)},g.every=g.all=function(e,t,n){t=_(t,n);for(var r=!C(e)&&g.keys(e),i=(r||e).length,o=0;o<i;o++){var a=r?r[o]:o;if(!t(e[a],a,e))return!1}return!0},g.some=g.any=function(e,t,n){t=_(t,n);for(var r=!C(e)&&g.keys(e),i=(r||e).length,o=0;o<i;o++){var a=r?r[o]:o;if(t(e[a],a,e))return!0}return!1},g.contains=g.includes=g.include=function(e,t,n,r){return C(e)||(e=g.values(e)),("number"!=typeof n||r)&&(n=0),g.indexOf(e,t,n)>=0},g.invoke=function(e,t){var n=c.call(arguments,2),r=g.isFunction(t);return g.map(e,(function(e){var i=r?t:e[t];return null==i?i:i.apply(e,n)}))},g.pluck=function(e,t){return g.map(e,g.property(t))},g.where=function(e,t){return g.filter(e,g.matcher(t))},g.findWhere=function(e,t){return g.find(e,g.matcher(t))},g.max=function(e,t,n){var r,i,o=-1/0,a=-1/0;if(null==t&&null!=e)for(var s=0,c=(e=C(e)?e:g.values(e)).length;s<c;s++)(r=e[s])>o&&(o=r);else t=_(t,n),g.each(e,(function(e,n,r){((i=t(e,n,r))>a||i===-1/0&&o===-1/0)&&(o=e,a=i)}));return o},g.min=function(e,t,n){var r,i,o=1/0,a=1/0;if(null==t&&null!=e)for(var s=0,c=(e=C(e)?e:g.values(e)).length;s<c;s++)(r=e[s])<o&&(o=r);else t=_(t,n),g.each(e,(function(e,n,r){((i=t(e,n,r))<a||i===1/0&&o===1/0)&&(o=e,a=i)}));return o},g.shuffle=function(e){for(var t,n=C(e)?e:g.values(e),r=n.length,i=Array(r),o=0;o<r;o++)(t=g.random(0,o))!==o&&(i[o]=i[t]),i[t]=n[o];return i},g.sample=function(e,t,n){return null==t||n?(C(e)||(e=g.values(e)),e[g.random(e.length-1)]):g.shuffle(e).slice(0,Math.max(0,t))},g.sortBy=function(e,t,n){return t=_(t,n),g.pluck(g.map(e,(function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}})).sort((function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index})),"value")};var E=function(e){return function(t,n,r){var i={};return n=_(n,r),g.each(t,(function(r,o){var a=n(r,o,t);e(i,r,a)})),i}};g.groupBy=E((function(e,t,n){g.has(e,n)?e[n].push(t):e[n]=[t]})),g.indexBy=E((function(e,t,n){e[n]=t})),g.countBy=E((function(e,t,n){g.has(e,n)?e[n]++:e[n]=1})),g.toArray=function(e){return e?g.isArray(e)?c.call(e):C(e)?g.map(e,g.identity):g.values(e):[]},g.size=function(e){return null==e?0:C(e)?e.length:g.keys(e).length},g.partition=function(e,t,n){t=_(t,n);var r=[],i=[];return g.each(e,(function(e,n,o){(t(e,n,o)?r:i).push(e)})),[r,i]},g.first=g.head=g.take=function(e,t,n){if(null!=e)return null==t||n?e[0]:g.initial(e,e.length-t)},g.initial=function(e,t,n){return c.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},g.last=function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:g.rest(e,Math.max(0,e.length-t))},g.rest=g.tail=g.drop=function(e,t,n){return c.call(e,null==t||n?1:t)},g.compact=function(e){return g.filter(e,g.identity)};var k=function(e,t,n,r){for(var i=[],o=0,a=r||0,s=I(e);a<s;a++){var c=e[a];if(C(c)&&(g.isArray(c)||g.isArguments(c))){t||(c=k(c,t,n));var u=0,l=c.length;for(i.length+=l;u<l;)i[o++]=c[u++]}else n||(i[o++]=c)}return i};function x(e){return function(t,n,r){n=_(n,r);for(var i=I(t),o=e>0?0:i-1;o>=0&&o<i;o+=e)if(n(t[o],o,t))return o;return-1}}function O(e,t,n){return function(r,i,o){var a=0,s=I(r);if("number"==typeof o)e>0?a=o>=0?o:Math.max(o+s,a):s=o>=0?Math.min(o+1,s):o+s+1;else if(n&&o&&s)return r[o=n(r,i)]===i?o:-1;if(i!=i)return(o=t(c.call(r,a,s),g.isNaN))>=0?o+a:-1;for(o=e>0?a:s-1;o>=0&&o<s;o+=e)if(r[o]===i)return o;return-1}}g.flatten=function(e,t){return k(e,t,!1)},g.without=function(e){return g.difference(e,c.call(arguments,1))},g.uniq=g.unique=function(e,t,n,r){g.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=_(n,r));for(var i=[],o=[],a=0,s=I(e);a<s;a++){var c=e[a],u=n?n(c,a,e):c;t?(a&&o===u||i.push(c),o=u):n?g.contains(o,u)||(o.push(u),i.push(c)):g.contains(i,c)||i.push(c)}return i},g.union=function(){return g.uniq(k(arguments,!0,!0))},g.intersection=function(e){for(var t=arguments,n=[],r=arguments.length,i=0,o=I(e);i<o;i++){var a=e[i];if(!g.contains(n,a)){for(var s=1;s<r&&g.contains(t[s],a);s++);s===r&&n.push(a)}}return n},g.difference=function(e){var t=k(arguments,!0,!0,1);return g.filter(e,(function(e){return!g.contains(t,e)}))},g.zip=function(){return g.unzip(arguments)},g.unzip=function(e){for(var t=e&&g.max(e,I).length||0,n=Array(t),r=0;r<t;r++)n[r]=g.pluck(e,r);return n},g.object=function(e,t){for(var n={},r=0,i=I(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},g.findIndex=x(1),g.findLastIndex=x(-1),g.sortedIndex=function(e,t,n,r){for(var i=(n=_(n,r,1))(t),o=0,a=I(e);o<a;){var s=Math.floor((o+a)/2);n(e[s])<i?o=s+1:a=s}return o},g.indexOf=O(1,g.findIndex,g.sortedIndex),g.lastIndexOf=O(-1,g.findLastIndex),g.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),o=0;o<r;o++,e+=n)i[o]=e;return i};var T=function(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var o=b(e.prototype),a=e.apply(o,i);return g.isObject(a)?a:o};g.bind=function(e,t){if(h&&e.bind===h)return h.apply(e,c.call(arguments,1));if(!g.isFunction(e))throw new TypeError("Bind must be called on a function");var n=c.call(arguments,2),r=function(){return T(e,r,t,this,n.concat(c.call(arguments)))};return r},g.partial=function(e){var t=c.call(arguments,1),n=function(){for(var r=arguments,i=0,o=t.length,a=Array(o),s=0;s<o;s++)a[s]=t[s]===g?r[i++]:t[s];for(;i<arguments.length;)a.push(r[i++]);return T(e,n,this,this,a)};return n},g.bindAll=function(e){var t,n,r=arguments,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(t=1;t<i;t++)e[n=r[t]]=g.bind(e[n],e);return e},g.memoize=function(e,t){var n=function(r){var i=n.cache,o=""+(t?t.apply(this,arguments):r);return g.has(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return n.cache={},n},g.delay=function(e,t){var n=c.call(arguments,2);return setTimeout((function(){return e.apply(null,n)}),t)},g.defer=g.partial(g.delay,g,1),g.throttle=function(e,t,n){var r,i,o,a=null,s=0;n||(n={});var c=function(){s=!1===n.leading?0:g.now(),a=null,o=e.apply(r,i),a||(r=i=null)};return function(){var u=g.now();s||!1!==n.leading||(s=u);var l=t-(u-s);return r=this,i=arguments,l<=0||l>t?(a&&(clearTimeout(a),a=null),s=u,o=e.apply(r,i),a||(r=i=null)):a||!1===n.trailing||(a=setTimeout(c,l)),o}},g.debounce=function(e,t,n){var r,i,o,a,s,c=function(){var u=g.now()-a;u<t&&u>=0?r=setTimeout(c,t-u):(r=null,n||(s=e.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,a=g.now();var u=n&&!r;return r||(r=setTimeout(c,t)),u&&(s=e.apply(o,i),o=i=null),s}},g.wrap=function(e,t){return g.partial(t,e)},g.negate=function(e){return function(){return!e.apply(this,arguments)}},g.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},g.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},g.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},g.once=g.partial(g.before,2);var R=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function A(e,t){var n=F.length,r=e.constructor,i=g.isFunction(r)&&r.prototype||o,a="constructor";for(g.has(e,a)&&!g.contains(t,a)&&t.push(a);n--;)(a=F[n])in e&&e[a]!==i[a]&&!g.contains(t,a)&&t.push(a)}g.keys=function(e){if(!g.isObject(e))return[];if(f)return f(e);var t=[];for(var n in e)g.has(e,n)&&t.push(n);return R&&A(e,t),t},g.allKeys=function(e){if(!g.isObject(e))return[];var t=[];for(var n in e)t.push(n);return R&&A(e,t),t},g.values=function(e){for(var t=g.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r},g.mapObject=function(e,t,n){t=_(t,n);for(var r,i=g.keys(e),o=i.length,a={},s=0;s<o;s++)a[r=i[s]]=t(e[r],r,e);return a},g.pairs=function(e){for(var t=g.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},g.invert=function(e){for(var t={},n=g.keys(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},g.functions=g.methods=function(e){var t=[];for(var n in e)g.isFunction(e[n])&&t.push(n);return t.sort()},g.extend=y(g.allKeys),g.extendOwn=g.assign=y(g.keys),g.findKey=function(e,t,n){t=_(t,n);for(var r,i=g.keys(e),o=0,a=i.length;o<a;o++)if(t(e[r=i[o]],r,e))return r},g.pick=function(e,t,n){var r,i,o={},a=e;if(null==a)return o;g.isFunction(t)?(i=g.allKeys(a),r=v(t,n)):(i=k(arguments,!1,!1,1),r=function(e,t,n){return t in n},a=Object(a));for(var s=0,c=i.length;s<c;s++){var u=i[s],l=a[u];r(l,u,a)&&(o[u]=l)}return o},g.omit=function(e,t,n){if(g.isFunction(t))t=g.negate(t);else{var r=g.map(k(arguments,!1,!1,1),String);t=function(e,t){return!g.contains(r,t)}}return g.pick(e,t,n)},g.defaults=y(g.allKeys,!0),g.create=function(e,t){var n=b(e);return t&&g.extendOwn(n,t),n},g.clone=function(e){return g.isObject(e)?g.isArray(e)?e.slice():g.extend({},e):e},g.tap=function(e,t){return t(e),e},g.isMatch=function(e,t){var n=g.keys(t),r=n.length;if(null==e)return!r;for(var i=Object(e),o=0;o<r;o++){var a=n[o];if(t[a]!==i[a]||!(a in i))return!1}return!0};var D=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof g&&(e=e._wrapped),t instanceof g&&(t=t._wrapped);var i=u.call(e);if(i!==u.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t}var o="[object Array]"===i;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,s=t.constructor;if(a!==s&&!(g.isFunction(a)&&a instanceof a&&g.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var c=(n=n||[]).length;c--;)if(n[c]===e)return r[c]===t;if(n.push(e),r.push(t),o){if((c=e.length)!==t.length)return!1;for(;c--;)if(!D(e[c],t[c],n,r))return!1}else{var l,d=g.keys(e);if(c=d.length,g.keys(t).length!==c)return!1;for(;c--;)if(l=d[c],!g.has(t,l)||!D(e[l],t[l],n,r))return!1}return n.pop(),r.pop(),!0};g.isEqual=function(e,t){return D(e,t)},g.isEmpty=function(e){return null==e||(C(e)&&(g.isArray(e)||g.isString(e)||g.isArguments(e))?0===e.length:0===g.keys(e).length)},g.isElement=function(e){return!(!e||1!==e.nodeType)},g.isArray=d||function(e){return"[object Array]"===u.call(e)},g.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},g.each(["Arguments","Function","String","Number","Date","RegExp","Error"],(function(e){g["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}})),g.isArguments(arguments)||(g.isArguments=function(e){return g.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(g.isFunction=function(e){return"function"==typeof e||!1}),g.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},g.isNaN=function(e){return g.isNumber(e)&&e!==+e},g.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===u.call(e)},g.isNull=function(e){return null===e},g.isUndefined=function(e){return void 0===e},g.has=function(e,t){return null!=e&&l.call(e,t)},g.noConflict=function(){return n._=r,this},g.identity=function(e){return e},g.constant=function(e){return function(){return e}},g.noop=function(){},g.property=S,g.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},g.matcher=g.matches=function(e){return e=g.extendOwn({},e),function(t){return g.isMatch(t,e)}},g.times=function(e,t,n){var r=Array(Math.max(0,e));t=v(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},g.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},g.now=Date.now||function(){return(new Date).getTime()};var M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=g.invert(M),$=function(e){var t=function(t){return e[t]},n="(?:"+g.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};g.escape=$(M),g.unescape=$(N),g.result=function(e,t,n){var r=null==e?void 0:e[t];return void 0===r&&(r=n),g.isFunction(r)?r.call(e):r};var B=0;g.uniqueId=function(e){var t=++B+"";return e?e+t:t},g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\u2028|\u2029/g,U=function(e){return"\\"+H[e]};g.template=function(e,t,n){!t&&n&&(t=n),t=g.defaults({},t,g.templateSettings);var r=RegExp([(t.escape||j).source,(t.interpolate||j).source,(t.evaluate||j).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(r,(function(t,n,r,a,s){return o+=e.slice(i,s).replace(L,U),i=s+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),t})),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var s=function(e){return a.call(this,e,g)},c=t.variable||"obj";return s.source="function("+c+"){\n"+o+"}",s},g.chain=function(e){var t=g(e);return t._chain=!0,t};var W=function(e,t){return e._chain?g(t).chain():t};g.mixin=function(e){g.each(g.functions(e),(function(t){var n=g[t]=e[t];g.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),W(this,n.apply(g,e))}}))},g.mixin(g),g.each(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=i[e];g.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],W(this,n)}})),g.each(["concat","join","slice"],(function(e){var t=i[e];g.prototype[e]=function(){return W(this,t.apply(this._wrapped,arguments))}})),g.prototype.value=function(){return this._wrapped},g.prototype.valueOf=g.prototype.toJSON=g.prototype.value,g.prototype.toString=function(){return""+this._wrapped}}).call(commonjsGlobal)}(underscore,underscore.exports);var _=underscore.exports,propMap={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};function attempt(e,t){try{return e(t)}catch(e){return t}}var doc=document,win=window,docEle=doc.documentElement,createElement=doc.createElement.bind(doc),div=createElement("div"),table=createElement("table"),tbody=createElement("tbody"),tr=createElement("tr"),isArray=Array.isArray,ArrayPrototype=Array.prototype,concat=ArrayPrototype.concat,filter=ArrayPrototype.filter,indexOf=ArrayPrototype.indexOf,map$1=ArrayPrototype.map,push=ArrayPrototype.push,slice=ArrayPrototype.slice,some=ArrayPrototype.some,splice=ArrayPrototype.splice,idRe=/^#(?:[\w-]|\\.|[^\x00-\xa0])*$/,classRe=/^\.(?:[\w-]|\\.|[^\x00-\xa0])*$/,htmlRe=/<.+>/,tagRe=/^\w+$/;function find$1(e,t){return e&&(isDocument(t)||isElement$1(t))?classRe.test(e)?t.getElementsByClassName(e.slice(1)):tagRe.test(e)?t.getElementsByTagName(e):t.querySelectorAll(e):[]}var Cash=function(e,t){if(e){if(isCash(e))return e;var n=e;if(isString(e)){var r=(isCash(t)?t[0]:t)||doc;if(!(n=idRe.test(e)?r.getElementById(e.slice(1)):htmlRe.test(e)?parseHTML(e):find$1(e,r)))return}else if(isFunction(e))return this.ready(e);(n.nodeType||n===win)&&(n=[n]),this.length=n.length;for(var i=0,o=this.length;i<o;i++)this[i]=n[i]}};Cash.prototype.init=function(e,t){return new Cash(e,t)};var fn=Cash.prototype,cash=fn.init;cash.fn=cash.prototype=fn,fn.length=0,fn.splice=splice,"function"==typeof Symbol&&(fn[Symbol.iterator]=ArrayPrototype[Symbol.iterator]),fn.map=function(e){return cash(concat.apply([],map$1.call(this,(function(t,n){return e.call(t,n,t)}))))},fn.slice=function(e,t){return cash(slice.call(this,e,t))};var dashAlphaRe=/-([a-z])/g;function camelCase(e){return e.replace(dashAlphaRe,(function(e,t){return t.toUpperCase()}))}function matches(e,t){var n=e&&(e.matches||e.webkitMatchesSelector||e.msMatchesSelector);return!!n&&!!t&&n.call(e,t)}function isCash(e){return e instanceof Cash}function isWindow(e){return!!e&&e===e.window}function isDocument(e){return!!e&&9===e.nodeType}function isElement$1(e){return!!e&&1===e.nodeType}function isBoolean(e){return"boolean"==typeof e}function isFunction(e){return"function"==typeof e}function isString(e){return"string"==typeof e}function isUndefined(e){return void 0===e}function isNull(e){return null===e}function isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}function isPlainObject(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function each(e,t,n){if(n){for(var r=e.length;r--;)if(!1===t.call(e[r],r,e[r]))return e}else if(isPlainObject(e))for(var i=Object.keys(e),o=0,a=i.length;o<a;o++){var s=i[o];if(!1===t.call(e[s],s,e[s]))return e}else for(var c=0,u=e.length;c<u;c++)if(!1===t.call(e[c],c,e[c]))return e;return e}function extend(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var n=!!isBoolean(e[0])&&e.shift(),r=e.shift(),i=e.length;if(!r)return{};if(!i)return extend(n,cash,r);for(var o=0;o<i;o++){var a=e[o];for(var s in a)n&&(isArray(a[s])||isPlainObject(a[s]))?(r[s]&&r[s].constructor===a[s].constructor||(r[s]=new a[s].constructor),extend(n,r[s],a[s])):r[s]=a[s]}return r}function getCompareFunction(e){return isString(e)?function(t,n){return matches(n,e)}:isFunction(e)?e:isCash(e)?function(t,n){return e.is(n)}:e?function(t,n){return n===e}:function(){return!1}}function filtered(e,t){return t?e.filter(t):e}cash.guid=1,cash.isWindow=isWindow,cash.isFunction=isFunction,cash.isArray=isArray,cash.isNumeric=isNumeric,cash.isPlainObject=isPlainObject,fn.get=function(e){return isUndefined(e)?slice.call(this):this[(e=Number(e))<0?e+this.length:e]},fn.eq=function(e){return cash(this.get(e))},fn.first=function(){return this.eq(0)},fn.last=function(){return this.eq(-1)},cash.each=each,fn.each=function(e){return each(this,e)},fn.prop=function(e,t){if(e){if(isString(e))return e=propMap[e]||e,arguments.length<2?this[0]&&this[0][e]:this.each((function(n,r){r[e]=t}));for(var n in e)this.prop(n,e[n]);return this}},fn.removeProp=function(e){return this.each((function(t,n){delete n[propMap[e]||e]}))},cash.extend=extend,fn.extend=function(e){return extend(fn,e)},fn.filter=function(e){var t=getCompareFunction(e);return cash(filter.call(this,(function(e,n){return t.call(e,n,e)})))};var splitValuesRe=/\S+/g;function getSplitValues(e){return isString(e)&&e.match(splitValuesRe)||[]}function attr(e,t){if(e){if(isString(e)){if(arguments.length<2){if(!this[0]||!isElement$1(this[0]))return;var n=this[0].getAttribute(e);return isNull(n)?void 0:n}return isUndefined(t)?this:isNull(t)?this.removeAttr(e):this.each((function(n,r){isElement$1(r)&&r.setAttribute(e,t)}))}for(var r in e)this.attr(r,e[r]);return this}}function pluck(e,t,n,r){for(var i=[],o=isFunction(t),a=r&&getCompareFunction(r),s=0,c=e.length;s<c;s++)if(o){var u=t(e[s]);u.length&&push.apply(i,u)}else for(var l=e[s][t];!(null==l||r&&a(-1,l));)i.push(l),l=n?l[t]:null;return i}function unique(e){return e.length>1?filter.call(e,(function(e,t,n){return indexOf.call(n,e)===t})):e}function computeStyle(e,t,n){if(isElement$1(e)){var r=win.getComputedStyle(e,null);return n?r.getPropertyValue(t)||void 0:r[t]||e.style[t]}}function computeStyleInt(e,t){return parseInt(computeStyle(e,t),10)||0}fn.hasClass=function(e){return!!e&&some.call(this,(function(t){return isElement$1(t)&&t.classList.contains(e)}))},fn.removeAttr=function(e){var t=getSplitValues(e);return this.each((function(e,n){isElement$1(n)&&each(t,(function(e,t){n.removeAttribute(t)}))}))},fn.attr=attr,fn.toggleClass=function(e,t){var n=getSplitValues(e),r=!isUndefined(t);return this.each((function(e,i){isElement$1(i)&&each(n,(function(e,n){r?t?i.classList.add(n):i.classList.remove(n):i.classList.toggle(n)}))}))},fn.addClass=function(e){return this.toggleClass(e,!0)},fn.removeClass=function(e){return arguments.length?this.toggleClass(e,!1):this.attr("class","")},cash.unique=unique,fn.add=function(e,t){return cash(unique(this.get().concat(cash(e,t).get())))};var cssVariableRe=/^--/;function isCSSVariable(e){return cssVariableRe.test(e)}var prefixedProps={},style=div.style,vendorsPrefixes=["webkit","moz","ms"];function getPrefixedProp(e,t){if(void 0===t&&(t=isCSSVariable(e)),t)return e;if(!prefixedProps[e]){var n=camelCase(e),r=""+n[0].toUpperCase()+n.slice(1);each((n+" "+vendorsPrefixes.join(r+" ")+r).split(" "),(function(t,n){if(n in style)return prefixedProps[e]=n,!1}))}return prefixedProps[e]}var numericProps={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function getSuffixedValue(e,t,n){return void 0===n&&(n=isCSSVariable(e)),n||numericProps[e]||!isNumeric(t)?t:t+"px"}function css(e,t){if(isString(e)){var n=isCSSVariable(e);return e=getPrefixedProp(e,n),arguments.length<2?this[0]&&computeStyle(this[0],e,n):e?(t=getSuffixedValue(e,t,n),this.each((function(r,i){isElement$1(i)&&(n?i.style.setProperty(e,t):i.style[e]=t)}))):this}for(var r in e)this.css(r,e[r]);return this}fn.css=css;var JSONStringRe=/^\s+|\s+$/;function getData(e,t){var n=e.dataset[t]||e.dataset[camelCase(t)];return JSONStringRe.test(n)?n:attempt(JSON.parse,n)}function setData(e,t,n){n=attempt(JSON.stringify,n),e.dataset[camelCase(t)]=n}function data$1(e,t){if(!e){if(!this[0])return;var n={};for(var r in this[0].dataset)n[r]=getData(this[0],r);return n}if(isString(e))return arguments.length<2?this[0]&&getData(this[0],e):isUndefined(t)?this:this.each((function(n,r){setData(r,e,t)}));for(var i in e)this.data(i,e[i]);return this}function getDocumentDimension(e,t){var n=e.documentElement;return Math.max(e.body["scroll"+t],n["scroll"+t],e.body["offset"+t],n["offset"+t],n["client"+t])}function getExtraSpace(e,t){return computeStyleInt(e,"border"+(t?"Left":"Top")+"Width")+computeStyleInt(e,"padding"+(t?"Left":"Top"))+computeStyleInt(e,"padding"+(t?"Right":"Bottom"))+computeStyleInt(e,"border"+(t?"Right":"Bottom")+"Width")}fn.data=data$1,each([!0,!1],(function(e,t){each(["Width","Height"],(function(e,n){fn[(t?"outer":"inner")+n]=function(r){if(this[0])return isWindow(this[0])?t?this[0]["inner"+n]:this[0].document.documentElement["client"+n]:isDocument(this[0])?getDocumentDimension(this[0],n):this[0][(t?"offset":"client")+n]+(r&&t?computeStyleInt(this[0],"margin"+(e?"Top":"Left"))+computeStyleInt(this[0],"margin"+(e?"Bottom":"Right")):0)}}))})),each(["Width","Height"],(function(e,t){var n=t.toLowerCase();fn[n]=function(r){if(!this[0])return isUndefined(r)?void 0:this;if(!arguments.length)return isWindow(this[0])?this[0].document.documentElement["client"+t]:isDocument(this[0])?getDocumentDimension(this[0],t):this[0].getBoundingClientRect()[n]-getExtraSpace(this[0],!e);var i=parseInt(r,10);return this.each((function(t,r){if(isElement$1(r)){var o=computeStyle(r,"boxSizing");r.style[n]=getSuffixedValue(n,i+("border-box"===o?getExtraSpace(r,!e):0))}}))}}));var defaultDisplay={};function getDefaultDisplay(e){if(defaultDisplay[e])return defaultDisplay[e];var t=createElement(e);doc.body.insertBefore(t,null);var n=computeStyle(t,"display");return doc.body.removeChild(t),defaultDisplay[e]="none"!==n?n:"block"}function isHidden(e){return"none"===computeStyle(e,"display")}var displayProperty="___cd";function hasNamespaces(e,t){return!t||!some.call(t,(function(t){return e.indexOf(t)<0}))}fn.toggle=function(e){return this.each((function(t,n){isElement$1(n)&&((isUndefined(e)?isHidden(n):e)?(n.style.display=n[displayProperty]||"",isHidden(n)&&(n.style.display=getDefaultDisplay(n.tagName))):(n[displayProperty]=computeStyle(n,"display"),n.style.display="none"))}))},fn.hide=function(){return this.toggle(!1)},fn.show=function(){return this.toggle(!0)};var eventsNamespace="___ce",eventsNamespacesSeparator=".",eventsFocus={focus:"focusin",blur:"focusout"},eventsHover={mouseenter:"mouseover",mouseleave:"mouseout"},eventsMouseRe=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;function getEventNameBubbling(e){return eventsHover[e]||eventsFocus[e]||e}function getEventsCache(e){return e[eventsNamespace]=e[eventsNamespace]||{}}function addEvent(e,t,n,r,i){var o=getEventsCache(e);o[t]=o[t]||[],o[t].push([n,r,i]),e.addEventListener(t,i)}function parseEventName(e){var t=e.split(eventsNamespacesSeparator);return[t[0],t.slice(1).sort()]}function removeEvent(e,t,n,r,i){var o=getEventsCache(e);if(t)o[t]&&(o[t]=o[t].filter((function(o){var a=o[0],s=o[1],c=o[2];if(i&&c.guid!==i.guid||!hasNamespaces(a,n)||r&&r!==s)return!0;e.removeEventListener(t,c)})));else for(t in o)removeEvent(e,t,n,r,i)}function on(e,t,n,r,i){var o=this;if(!isString(e)){for(var a in e)this.on(a,t,n,e[a],i);return this}return isString(t)||(isUndefined(t)||isNull(t)?t="":isUndefined(n)?(n=t,t=""):(r=n,n=t,t="")),isFunction(r)||(r=n,n=void 0),r?(each(getSplitValues(e),(function(e,a){var s=parseEventName(a),c=s[0],u=s[1],l=getEventNameBubbling(c),d=c in eventsHover,f=c in eventsFocus;l&&o.each((function(e,o){if(isElement$1(o)||isDocument(o)||isWindow(o)){var a=function(e){if(e.target["___i"+e.type])return e.stopImmediatePropagation();if((!e.namespace||hasNamespaces(u,e.namespace.split(eventsNamespacesSeparator)))&&(t||!(f&&(e.target!==o||e.___ot===l)||d&&e.relatedTarget&&o.contains(e.relatedTarget)))){var s=o;if(t){for(var c=e.target;!matches(c,t);){if(c===o)return;if(!(c=c.parentNode))return}s=c,e.___cd=!0}e.___cd&&Object.defineProperty(e,"currentTarget",{configurable:!0,get:function(){return s}}),Object.defineProperty(e,"data",{configurable:!0,get:function(){return n}});var h=r.call(s,e,e.___td);i&&removeEvent(o,l,u,t,a),!1===h&&(e.preventDefault(),e.stopPropagation())}};a.guid=r.guid=r.guid||cash.guid++,addEvent(o,l,u,t,a)}}))})),this):this}function one(e,t,n,r){return this.on(e,t,n,r,!0)}function getValue(e){return e.multiple&&e.options?pluck(filter.call(e.options,(function(e){return e.selected&&!e.disabled&&!e.parentNode.disabled})),"value"):e.value||""}fn.off=function(e,t,n){var r=this;if(isUndefined(e))this.each((function(e,t){(isElement$1(t)||isDocument(t)||isWindow(t))&&removeEvent(t)}));else if(isString(e))isFunction(t)&&(n=t,t=""),each(getSplitValues(e),(function(e,i){var o=parseEventName(i),a=o[0],s=o[1],c=getEventNameBubbling(a);r.each((function(e,r){(isElement$1(r)||isDocument(r)||isWindow(r))&&removeEvent(r,c,s,t,n)}))}));else for(var i in e)this.off(i,e[i]);return this},fn.on=on,fn.one=one,fn.ready=function(e){var t=function(){return setTimeout(e,0,cash)};return"loading"!==doc.readyState?t():doc.addEventListener("DOMContentLoaded",t),this},fn.trigger=function(e,t){if(isString(e)){var n=parseEventName(e),r=n[0],i=n[1],o=getEventNameBubbling(r);if(!o)return this;var a=eventsMouseRe.test(o)?"MouseEvents":"HTMLEvents";(e=doc.createEvent(a)).initEvent(o,!0,!0),e.namespace=i.join(eventsNamespacesSeparator),e.___ot=r}e.___td=t;var s=e.___ot in eventsFocus;return this.each((function(t,n){s&&isFunction(n[e.___ot])&&(n["___i"+e.type]=!0,n[e.___ot](),n["___i"+e.type]=!1),n.dispatchEvent(e)}))};var queryEncodeSpaceRe=/%20/g,queryEncodeCRLFRe=/\r?\n/g;function queryEncode(e,t){return"&"+encodeURIComponent(e)+"="+encodeURIComponent(t.replace(queryEncodeCRLFRe,"\r\n")).replace(queryEncodeSpaceRe,"+")}var skippableRe=/file|reset|submit|button|image/i,checkableRe=/radio|checkbox/i;function val(e){return arguments.length?this.each((function(t,n){var r=n.multiple&&n.options;if(r||checkableRe.test(n.type)){var i=isArray(e)?map$1.call(e,String):isNull(e)?[]:[String(e)];r?each(n.options,(function(e,t){t.selected=i.indexOf(t.value)>=0}),!0):n.checked=i.indexOf(n.value)>=0}else n.value=isUndefined(e)||isNull(e)?"":e})):this[0]&&getValue(this[0])}fn.serialize=function(){var e="";return this.each((function(t,n){each(n.elements||[n],(function(t,n){if(!(n.disabled||!n.name||"FIELDSET"===n.tagName||skippableRe.test(n.type)||checkableRe.test(n.type)&&!n.checked)){var r=getValue(n);if(!isUndefined(r))each(isArray(r)?r:[r],(function(t,r){e+=queryEncode(n.name,r)}))}}))})),e.slice(1)},fn.val=val,fn.clone=function(){return this.map((function(e,t){return t.cloneNode(!0)}))},fn.detach=function(e){return filtered(this,e).each((function(e,t){t.parentNode&&t.parentNode.removeChild(t)})),this};var fragmentRe=/^\s*<(\w+)[^>]*>/,singleTagRe=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,containers={"*":div,tr:tbody,td:tr,th:tr,thead:table,tbody:table,tfoot:table};function parseHTML(e){if(!isString(e))return[];if(singleTagRe.test(e))return[createElement(RegExp.$1)];var t=fragmentRe.test(e)&&RegExp.$1,n=containers[t]||containers["*"];return n.innerHTML=e,cash(n.childNodes).detach().get()}function html(e){return arguments.length?isUndefined(e)?this:this.each((function(t,n){isElement$1(n)&&(n.innerHTML=e)})):this[0]&&this[0].innerHTML}function text(e){return isUndefined(e)?this[0]?this[0].textContent:"":this.each((function(t,n){isElement$1(n)&&(n.textContent=e)}))}cash.parseHTML=parseHTML,fn.empty=function(){return this.each((function(e,t){for(;t.firstChild;)t.removeChild(t.firstChild)}))},fn.html=html,fn.remove=function(e){return filtered(this,e).detach().off(),this},fn.text=text,fn.unwrap=function(){return this.parent().each((function(e,t){if("BODY"!==t.tagName){var n=cash(t);n.replaceWith(n.children())}})),this},fn.offset=function(){var e=this[0];if(e){var t=e.getBoundingClientRect();return{top:t.top+win.pageYOffset,left:t.left+win.pageXOffset}}},fn.offsetParent=function(){return this.map((function(e,t){for(var n=t.offsetParent;n&&"static"===computeStyle(n,"position");)n=n.offsetParent;return n||docEle}))},fn.position=function(){var e=this[0];if(e){var t="fixed"===computeStyle(e,"position"),n=t?e.getBoundingClientRect():this.offset();if(!t){for(var r=e.ownerDocument,i=e.offsetParent||r.documentElement;(i===r.body||i===r.documentElement)&&"static"===computeStyle(i,"position");)i=i.parentNode;if(i!==e&&isElement$1(i)){var o=cash(i).offset();n.top-=o.top+computeStyleInt(i,"borderTopWidth"),n.left-=o.left+computeStyleInt(i,"borderLeftWidth")}}return{top:n.top-computeStyleInt(e,"marginTop"),left:n.left-computeStyleInt(e,"marginLeft")}}},fn.children=function(e){return filtered(cash(unique(pluck(this,(function(e){return e.children})))),e)},fn.contents=function(){return cash(unique(pluck(this,(function(e){return"IFRAME"===e.tagName?[e.contentDocument]:"TEMPLATE"===e.tagName?e.content.childNodes:e.childNodes}))))},fn.find=function(e){return cash(unique(pluck(this,(function(t){return find$1(e,t)}))))};var HTMLCDATARe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,scriptTypeRe=/^$|^module$|\/(java|ecma)script/i,scriptAttributes=["type","src","nonce","noModule"];function evalScripts(e,t){var n=cash(e);n.filter("script").add(n.find("script")).each((function(e,n){if(scriptTypeRe.test(n.type)&&docEle.contains(n)){var r=createElement("script");r.text=n.textContent.replace(HTMLCDATARe,""),each(scriptAttributes,(function(e,t){n[t]&&(r[t]=n[t])})),t.head.insertBefore(r,null),t.head.removeChild(r)}}))}function insertElement(e,t,n,r,i){r?e.insertBefore(t,n?e.firstChild:null):e.parentNode.insertBefore(t,n?e:e.nextSibling),i&&evalScripts(t,e.ownerDocument)}function insertSelectors(e,t,n,r,i,o,a,s){return each(e,(function(e,o){each(cash(o),(function(e,o){each(cash(t),(function(t,a){var s=n?a:o,c=n?e:t;insertElement(n?o:a,c?s.cloneNode(!0):s,r,i,!c)}),s)}),a)}),o),t}fn.after=function(){return insertSelectors(arguments,this,!1,!1,!1,!0,!0)},fn.append=function(){return insertSelectors(arguments,this,!1,!1,!0)},fn.appendTo=function(e){return insertSelectors(arguments,this,!0,!1,!0)},fn.before=function(){return insertSelectors(arguments,this,!1,!0)},fn.insertAfter=function(e){return insertSelectors(arguments,this,!0,!1,!1,!1,!1,!0)},fn.insertBefore=function(e){return insertSelectors(arguments,this,!0,!0)},fn.prepend=function(){return insertSelectors(arguments,this,!1,!0,!0,!0,!0)},fn.prependTo=function(e){return insertSelectors(arguments,this,!0,!0,!0,!1,!1,!0)},fn.replaceWith=function(e){return this.before(e).remove()},fn.replaceAll=function(e){return cash(e).replaceWith(this),this},fn.wrapAll=function(e){for(var t=cash(e),n=t[0];n.children.length;)n=n.firstElementChild;return this.first().before(t),this.appendTo(n)},fn.wrap=function(e){return this.each((function(t,n){var r=cash(e)[0];cash(n).wrapAll(t?r.cloneNode(!0):r)}))},fn.wrapInner=function(e){return this.each((function(t,n){var r=cash(n),i=r.contents();i.length?i.wrapAll(e):r.append(e)}))},fn.has=function(e){var t=isString(e)?function(t,n){return find$1(e,n).length}:function(t,n){return n.contains(e)};return this.filter(t)},fn.is=function(e){var t=getCompareFunction(e);return some.call(this,(function(e,n){return t.call(e,n,e)}))},fn.next=function(e,t,n){return filtered(cash(unique(pluck(this,"nextElementSibling",t,n))),e)},fn.nextAll=function(e){return this.next(e,!0)},fn.nextUntil=function(e,t){return this.next(t,!0,e)},fn.not=function(e){var t=getCompareFunction(e);return this.filter((function(n,r){return(!isString(e)||isElement$1(r))&&!t.call(r,n,r)}))},fn.parent=function(e){return filtered(cash(unique(pluck(this,"parentNode"))),e)},fn.index=function(e){var t=e?cash(e)[0]:this[0],n=e?this:cash(t).parent().children();return indexOf.call(n,t)},fn.closest=function(e){var t=this.filter(e);if(t.length)return t;var n=this.parent();return n.length?n.closest(e):t},fn.parents=function(e,t){return filtered(cash(unique(pluck(this,"parentElement",!0,t))),e)},fn.parentsUntil=function(e,t){return this.parents(t,e)},fn.prev=function(e,t,n){return filtered(cash(unique(pluck(this,"previousElementSibling",t,n))),e)},fn.prevAll=function(e){return this.prev(e,!0)},fn.prevUntil=function(e,t){return this.prev(t,!0,e)},fn.siblings=function(e){return filtered(cash(unique(pluck(this,(function(e){return cash(e).parent().children().not(e)})))),e)};var MINDBOXAPI="https://api.mindbox.ru",CONFIG={DATASET_PREFIX:"popmechanic",CSS_PREFIX:"popmechanic-",JS_PREFIX:"popmechanic.",WEB_URL:SERVER+"/web/",GEO_URL:MINDBOXAPI+"/geo/",TS_URL:SERVER+"/web/time/",FORM_TEST_URL:SERVER+"/web/forms/",CONTACTS_URL:SERVER+"/web/contacts/",ANIMATION_SPEED:200};function zeptoAjaxModule(e){var t,n,r=+new Date,i=window.document,o=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,a=/^(?:text|application)\/javascript/i,s=/^(?:text|application)\/xml/i,c=/^\s*$/,u=i.createElement("a");function l(t,n,r,o){if(t.global)return function(t,n,r){var i=e.Event(n);return e(t).trigger(i,r),!i.isDefaultPrevented()}(n||i,r,o)}function d(e,t){var n=t.context;if(!1===t.beforeSend.call(n,e,t)||!1===l(t,n,"ajaxBeforeSend",[e,t]))return!1;l(t,n,"ajaxSend",[e,t])}function f(e,t,n,r){var i=n.context;n.success.call(i,e,"success",t),r&&r.resolveWith(i,[e,"success",t]),l(n,i,"ajaxSuccess",[t,n,e]),p("success",t,n)}function h(e,t,n,r,i){var o=r.context;r.error.call(o,n,t,e),i&&i.rejectWith(o,[n,t,e]),l(r,o,"ajaxError",[n,r,e||t]),p(t,n,r)}function p(t,n,r){var i=r.context;r.complete.call(i,n,t),l(r,i,"ajaxComplete",[n,r]),function(t){t.global&&!--e.active&&l(t,null,"ajaxStop")}(r)}function m(){}function g(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function v(t,n,r,i){return e.isFunction(n)&&(i=r,r=n,n=void 0),e.isFunction(r)||(i=r,r=void 0),{url:t,data:n,success:r,dataType:i}}u.href=window.location.href,e.active=0,e.ajaxJSONP=function(t,n){if(!("type"in t))return e.ajax(t);var o,a,s=t.jsonpCallback,c=(e.isFunction(s)?s():s)||"Zepto"+r++,u=i.createElement("script"),l=window[c],p=function(t){e(u).triggerHandler("error",t||"abort")},m={abort:p};return n&&n.promise(m),e(u).on("load error",(function(r,i){clearTimeout(a),e(u).off().remove(),"error"!=r.type&&o?f(o[0],m,t,n):h(null,i||"error",m,t,n),window[c]=l,o&&e.isFunction(l)&&l(o[0]),l=o=void 0})),!1===d(m,t)?(p("abort"),m):(window[c]=function(){o=arguments},u.src=t.url.replace(/\?(.+)=\?/,"?$1="+c),i.head.appendChild(u),t.timeout>0&&(a=setTimeout((function(){p("timeout")}),t.timeout)),m)},e.ajaxSettings={type:"GET",beforeSend:m,success:m,error:m,complete:m,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,dataFilter:m},e.ajax=function(r){var o,p,v=e.extend({},r||{}),_=e.Deferred&&e.Deferred();for(t in e.ajaxSettings)void 0===v[t]&&(v[t]=e.ajaxSettings[t]);!function(t){t.global&&0==e.active++&&l(t,null,"ajaxStart")}(v),v.crossDomain||((o=i.createElement("a")).href=v.url,o.href=o.href,v.crossDomain=u.protocol+"//"+u.host!=o.protocol+"//"+o.host),v.url||(v.url=window.location.toString()),(p=v.url.indexOf("#"))>-1&&(v.url=v.url.slice(0,p)),function(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()&&"jsonp"!=t.dataType||(t.url=g(t.url,t.data),t.data=void 0)}(v);var y=v.dataType,b=/\?.+=\?/.test(v.url);if(b&&(y="jsonp"),!1!==v.cache&&(r&&!0===r.cache||"script"!=y&&"jsonp"!=y)||(v.url=g(v.url,"_="+Date.now())),"jsonp"==y)return b||(v.url=g(v.url,v.jsonp?v.jsonp+"=?":!1===v.jsonp?"":"callback=?")),e.ajaxJSONP(v,_);var S,w=v.accepts[y],I={},C=function(e,t){I[e.toLowerCase()]=[e,t]},P=/^([\w-]+:)\/\//.test(v.url)?RegExp.$1:window.location.protocol,E=v.xhr(),k=E.setRequestHeader;if(_&&_.promise(E),v.crossDomain||C("X-Requested-With","XMLHttpRequest"),C("Accept",w||"*/*"),(w=v.mimeType||w)&&(w.indexOf(",")>-1&&(w=w.split(",",2)[0]),E.overrideMimeType&&E.overrideMimeType(w)),(v.contentType||!1!==v.contentType&&v.data&&"GET"!=v.type.toUpperCase())&&C("Content-Type",v.contentType||"application/x-www-form-urlencoded"),v.headers)for(n in v.headers)C(n,v.headers[n]);if(E.setRequestHeader=C,E.onreadystatechange=function(){if(4==E.readyState){E.onreadystatechange=m,clearTimeout(S);var t,n=!1;if(E.status>=200&&E.status<300||304==E.status||0==E.status&&"file:"==P){if(y=y||function(e){return e&&(e=e.split(";",2)[0]),e&&("text/html"==e?"html":"application/json"==e?"json":a.test(e)?"script":s.test(e)&&"xml")||"text"}(v.mimeType||E.getResponseHeader("content-type")),"arraybuffer"==E.responseType||"blob"==E.responseType)t=E.response;else{t=E.responseText;try{t=function(e,t,n){if(n.dataFilter==m)return e;var r=n.context;return n.dataFilter.call(r,e,t)}(t,y,v),"script"==y?(0,eval)(t):"xml"==y?t=E.responseXML:"json"==y&&(t=c.test(t)?null:e.parseJSON(t))}catch(e){n=e}if(n)return h(n,"parsererror",E,v,_)}f(t,E,v,_)}else h(E.statusText||null,E.status?"error":"abort",E,v,_)}},!1===d(E,v))return E.abort(),h(null,"abort",E,v,_),E;var x=!("async"in v)||v.async;if(E.open(v.type,v.url,x,v.username,v.password),v.xhrFields)for(n in v.xhrFields)E[n]=v.xhrFields[n];for(n in I)k.apply(E,I[n]);return v.timeout>0&&(S=setTimeout((function(){E.onreadystatechange=m,E.abort(),h(null,"timeout",E,v,_)}),v.timeout)),E.send(v.data?v.data:null),E},e.get=function(){return e.ajax(v.apply(null,arguments))},e.post=function(){var t=v.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=v.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,r){if(!this.length)return this;var i,a=this,s=t.split(/\s/),c=v(t,n,r),u=c.success;return s.length>1&&(c.url=s[0],i=s[1]),c.success=function(t){a.html(i?e("<div>").html(t.replace(o,"")).find(i):t),u&&u.apply(a,arguments)},e.ajax(c),this};var _=encodeURIComponent;e.param=function(t,n){var r=[];return r.add=function(t,n){e.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(_(t)+"="+_(n))},function t(n,r,i,o){var a,s=e.isArray(r),c=e.isPlainObject(r);e.each(r,(function(r,u){a=e.type(u),o&&(r=i?o:o+"["+(c||"object"==a||"array"==a?r:"")+"]"),!o&&s?n.add(u.name,u.value):"array"==a||!i&&"object"==a?t(n,u,i,r):n.add(r,u)}))}(r,t,n),r.join("&").replace(/%20/g,"+")}}function zeptoEventModule(e){var t=1,n=Array.prototype.slice,r=e.isFunction,i=function(e){return"string"==typeof e},o={},a={},s="onfocusin"in window,c={focus:"focusin",blur:"focusout"},u={mouseenter:"mouseover",mouseleave:"mouseout"};function l(e){return e._zid||(e._zid=t++)}function d(e,t,n,r){if((t=f(t)).ns)var i=(a=t.ns,new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)"));var a;return(o[l(e)]||[]).filter((function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||i.test(e.ns))&&(!n||l(e.fn)===l(n))&&(!r||e.sel==r)}))}function f(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function h(e,t){return e.del&&!s&&e.e in c||!!t}function p(e){return u[e]||s&&c[e]||e}function m(t,n,r,i,a,s,c){var d=l(t),m=o[d]||(o[d]=[]);n.split(/\s/).forEach((function(n){if("ready"==n)return e(document).ready(r);var o=f(n);o.fn=r,o.sel=a,o.e in u&&(r=function(t){var n=t.relatedTarget;if(!n||n!==this&&!e.contains(this,n))return o.fn.apply(this,arguments)}),o.del=s;var l=s||r;o.proxy=function(e){if((e=S(e)).isImmediatePropagationStopped&&!e.isImmediatePropagationStopped()){e.data=i;var n=l.apply(t,null==e._args?[e]:[e].concat(e._args));return!1===n&&(e.preventDefault(),e.stopPropagation()),n}},o.i=m.length,m.push(o),"addEventListener"in t&&t.addEventListener(p(o.e),o.proxy,h(o,c))}))}function g(e,t,n,r,i){var a=l(e);(t||"").split(/\s/).forEach((function(t){d(e,t,n,r).forEach((function(t){delete o[a][t.i],"removeEventListener"in e&&e.removeEventListener(p(t.e),t.proxy,h(t,i))}))}))}a.click=a.mousedown=a.mouseup=a.mousemove="MouseEvents",e.event={add:m,remove:g},e.proxy=function(t,o){var a=2 in arguments&&n.call(arguments,2);if(r(t)){var s=function(){return t.apply(o,a?a.concat(n.call(arguments)):arguments)};return s._zid=l(t),s}if(i(o))return a?(a.unshift(t[o],t),e.proxy.apply(null,a)):e.proxy(t[o],t);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,r){return this.on(e,t,n,r,1)};var v=function(){return!0},_=function(){return!1},y=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,b={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function S(t,n){if(n||!t.isDefaultPrevented){n||(n=t),e.each(b,(function(e,r){var i=n[e];t[e]=function(){return this[r]=v,i&&i.apply(n,arguments)},t[r]=_}));try{t.timeStamp||(t.timeStamp=Date.now())}catch(e){}(void 0!==n.defaultPrevented?n.defaultPrevented:"returnValue"in n?!1===n.returnValue:n.getPreventDefault&&n.getPreventDefault())&&(t.isDefaultPrevented=v)}return t}function w(e){var t,n={originalEvent:e};for(t in e)y.test(t)||void 0===e[t]||(n[t]=e[t]);return S(n,e)}e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,o,a,s,c){var u,l,d=this;return t&&!i(t)?(e.each(t,(function(e,t){d.on(e,o,a,t,c)})),d):(i(o)||r(s)||!1===s||(s=a,a=o,o=void 0),void 0!==s&&!1!==a||(s=a,a=void 0),!1===s&&(s=_),d.each((function(r,i){c&&(u=function(e){return g(i,e.type,s),s.apply(this,arguments)}),o&&(l=function(t){var r,a=e(t.target).closest(o,i).get(0);if(a&&a!==i)return r=e.extend(w(t),{currentTarget:a,liveFired:i}),(u||s).apply(a,[r].concat(n.call(arguments,1)))}),m(i,t,s,a,o,l||u)})))},e.fn.off=function(t,n,o){var a=this;return t&&!i(t)?(e.each(t,(function(e,t){a.off(e,n,t)})),a):(i(n)||r(o)||!1===o||(o=n,n=void 0),!1===o&&(o=_),a.each((function(){g(this,t,o,n)})))},e.fn.trigger=function(t,n){return(t=i(t)||e.isPlainObject(t)?e.Event(t):S(t))._args=n,this.each((function(){t.type in c&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)}))},e.fn.triggerHandler=function(t,n){var r,o;return this.each((function(a,s){(r=w(i(t)?e.Event(t):t))._args=n,r.target=s,e.each(d(s,t.type||t),(function(e,t){if(o=t.proxy(r),r.isImmediatePropagationStopped())return!1}))})),o},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach((function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}})),e.Event=function(e,t){i(e)||(e=(t=e).type);var n=document.createEvent(a[e]||"Events"),r=!0;if(t)for(var o in t)"bubbles"==o?r=!!t[o]:n[o]=t[o];return n.initEvent(e,r,!0),S(n)}}cash.parseJSON=JSON?JSON.parse:function(){},cash.inArray=function(e,t,n){return[].indexOf.call(t,e,n)};var class2type={};cash.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),(function(e,t){class2type["[object "+t+"]"]=t.toLowerCase()})),cash.type=function(e){return null==e?String(e):class2type[toString.call(e)]||"object"},cash.contains=document.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},cash.fn.filterVisible=function(){return this.filter((function(e,t){var n=cash(t).css("visibility"),r=cash(t).css("display"),i=parseInt(cash(t).css("opacity"),10);return"hidden"!==n&&"none"!==r&&i>0}))},cash.fn.animate=function(e,t){var n=this;return n.addClass("popmechanic-transition"),n.css(e),setTimeout((function(){n.removeClass("popmechanic-transition"),"function"==typeof t&&t.call(n)}),CONFIG.ANIMATION_SPEED),n},cash.data=function(e,t,n){return cash(e).data(t,n)},cash.noop=function(){},zeptoEventModule(cash),zeptoAjaxModule(cash),function(e){var t=function(){}.toString().indexOf("_")>-1,n=function(){},r=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=!0,o={toString:""};for(var a in o)o.hasOwnProperty(a)&&(i=!1);var s=i?["toString","valueOf"]:null;function c(n,r,o){var a=!1;if(i){var c=[];e.each(s,(function(){o.hasOwnProperty(this)&&(a=!0)&&c.push({name:this,val:o[this]})})),a&&(e.each(o,(function(e){c.push({name:e,val:this})})),o=c)}e.each(o,(function(i,o){if(a&&(i=o.name,o=o.val),e.isFunction(o)&&(!t||o.toString().indexOf(".__base")>-1)){var s=n[i]||function(){};r[i]=function(){var e=this.__base;this.__base=s;var t=o.apply(this,arguments);return this.__base=e,t}}else r[i]=o}))}e.inherit=function(){var t=arguments,i=e.isFunction(t[0]),o=i?t[0]:n,a=t[i?1:0]||{},s=t[i?2:1],u=a.__constructor||i&&o.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:function(){};if(!i)return u.prototype=a,u.prototype.__self=u.prototype.constructor=u,e.extend(u,s);e.extend(u,o);var l=o.prototype,d=u.prototype=r(l);return d.__self=d.constructor=u,c(l,d,a),s&&c(o,u,s),u},e.inheritSelf=function(e,t,n){var r=e.prototype;return c(r,r,t),n&&c(e,e,n),e}}(cash);var inherit=cash.inherit,device,previousDevice,addClass,documentElement,find,handleOrientation,hasClass,orientationEvent,removeClass,userAgent;previousDevice=window.device,device={},window.device=device,documentElement=window.document.documentElement,userAgent=window.navigator.userAgent.toLowerCase(),device.ios=function(){return device.iphone()||device.ipod()||device.ipad()},device.iphone=function(){return!device.windows()&&find("iphone")},device.ipod=function(){return find("ipod")},device.ipad=function(){return find("ipad")||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},device.android=function(){return!device.windows()&&find("android")},device.androidPhone=function(){return device.android()&&find("mobile")},device.androidTablet=function(){return device.android()&&!find("mobile")},device.blackberry=function(){return find("blackberry")||find("bb10")||find("rim")},device.blackberryPhone=function(){return device.blackberry()&&!find("tablet")},device.blackberryTablet=function(){return device.blackberry()&&find("tablet")},device.windows=function(){return find("windows")},device.macosx=function(){return find("mac os x")},device.linux=function(){return find("linux")},device.windowsPhone=function(){return device.windows()&&find("phone")},device.windowsTablet=function(){return device.windows()&&find("touch")&&!device.windowsPhone()},device.fxos=function(){return(find("(mobile;")||find("(tablet;"))&&find("; rv:")},device.fxosPhone=function(){return device.fxos()&&find("mobile")},device.fxosTablet=function(){return device.fxos()&&find("tablet")},device.meego=function(){return find("meego")},device.cordova=function(){return window.cordova&&"file:"===location.protocol},device.nodeWebkit=function(){return"object"==typeof window.process},device.mobile=function(){return device.androidPhone()||device.iphone()||device.ipod()||device.windowsPhone()||device.blackberryPhone()||device.fxosPhone()||device.meego()},device.tablet=function(){return!device.mobile()&&(device.ipad()||device.androidTablet()||device.blackberryTablet()||device.windowsTablet()||device.fxosTablet())},device.desktop=function(){return!device.tablet()&&!device.mobile()},device.television=function(){var e,t;for(t=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","roku","pov_tv","hbbtv","ce-html"],e=0;e<t.length;){if(find(t[e]))return!0;e++}return!1},device.portrait=function(){return window.innerHeight/window.innerWidth>1},device.landscape=function(){return window.innerHeight/window.innerWidth<1},device.noConflict=function(){return window.device=previousDevice,this},find=function(e){return-1!==userAgent.indexOf(e)},hasClass=function(e){var t;return t=new RegExp(e,"i"),documentElement.className.match(t)},addClass=function(e){var t,n;n=e.split(/\s+/).map((function(e){return CONFIG.CSS_PREFIX+e})).filter((function(e){return!hasClass(e)})).join(" "),t=documentElement.className.replace(/^\s+|\s+$/g,""),documentElement.className=t+" "+n},removeClass=function(e){var t=CONFIG.CSS_PREFIX+e;hasClass(t)&&(documentElement.className=documentElement.className.replace(" "+t,""))},device.ios()?device.ipad()?addClass("ios ipad tablet"):device.iphone()?addClass("ios iphone mobile"):device.ipod()&&addClass("ios ipod mobile"):device.android()?device.androidTablet()?addClass("android tablet"):addClass("android mobile"):device.blackberry()?device.blackberryTablet()?addClass("blackberry tablet"):addClass("blackberry mobile"):device.windows()?device.windowsTablet()?addClass("windows tablet"):device.windowsPhone()?addClass("windows mobile"):addClass("desktop"):device.fxos()?device.fxosTablet()?addClass("fxos tablet"):addClass("fxos mobile"):device.meego()?addClass("meego mobile"):device.nodeWebkit()?addClass("node-webkit"):device.television()?addClass("television"):device.desktop()&&addClass("desktop"),device.cordova()&&addClass("cordova"),handleOrientation=function(){device.landscape()?(removeClass("portrait"),addClass("landscape")):(removeClass("landscape"),addClass("portrait"))},orientationEvent=Object.prototype.hasOwnProperty.call(window,"onorientationchange")?"orientationchange":"resize",window.addEventListener?window.addEventListener(orientationEvent,handleOrientation,!1):window.attachEvent?window.attachEvent(orientationEvent,handleOrientation):window[orientationEvent]=handleOrientation,handleOrientation();var device$1=device,$snippet,$builtInSnippetElement=cash("#"+CONFIG.CSS_PREFIX+"snippet");function disableScroll(){var e=cash("body");e.addClass("popmechanic-disable-scroll"),cash("html").addClass("popmechanic-disable-scroll"),device$1.ios()&&e.addClass("popmechanic-ios-scroll-fix")}function enableScroll(){var e=cash("body");e.removeClass("popmechanic-disable-scroll"),cash("html").removeClass("popmechanic-disable-scroll"),device$1.ios()&&e.removeClass("popmechanic-ios-scroll-fix")}function setDeviceClasses(e){device$1.mobile()&&e.addClass(CONFIG.CSS_PREFIX+"mobile"),device$1.tablet()&&e.addClass(CONFIG.CSS_PREFIX+"tablet"),device$1.desktop()&&e.addClass(CONFIG.CSS_PREFIX+"desktop")}function getContainerId(e){return CONFIG.CSS_PREFIX+"container-"+e}function getFormId(e){return CONFIG.CSS_PREFIX+"form-"+e}function getContainerMarkup(e){var t=getContainerId(e),n=cash('<div class="'+CONFIG.CSS_PREFIX+'js-container" id="'+t+'"></div>');return setDeviceClasses(n),n}function getContainer(e){var t=getContainerId(e),n=$snippet.find("#"+t);return 0!==n.length||(n=getContainerMarkup(e)).appendTo($snippet),n}function snippetHasForm(e){return 0!==$snippet.find("#"+CONFIG.CSS_PREFIX+"form-"+e).length}function getCssReset(e){return _.template(resetTemplate)({wrapperId:"#"+getFormId(e)})}$builtInSnippetElement.length>0?$snippet=$builtInSnippetElement:($snippet=cash('<div id="'+CONFIG.CSS_PREFIX+'snippet" style="height: 0; min-height: 0;"></div>'),$snippet.prependTo("body"));var resetTemplate="<%= wrapperId %> * {  margin: 0;  padding: 0;  border: 0;  font-size: 100%;  font: inherit;  color: inherit;  line-height: normal;  vertical-align: baseline;  background: none;  pointer-events: all;  position: static;}<%= wrapperId %> *:before,<%= wrapperId %> *:after {  content: '';  content: none;}";function containerizeCss(e,t){var n="#"+getContainerId(t);return e.replace(/\/\*.*?\*\//gm,"").replace(/(#popmechanic-(?:form|button))(\s|\.|:|{|,)/g," $1-"+t+"$2").replace(selectorRegex,(function(e,t,r){for(var i=r.split(","),o=0;o<i.length;o++)i[o].match(stateRegex)?i[o]=i[o].replace(stateRegex,n+"$&"):i[o]=n+" "+i[o];return t+i.join(",")}))}var selectorRegex=/((?:^|})[\s\n]*)((?:(?:(?:[.#][_a-zA-Z0-9-.:]+)|\*|\+|~|>)[^{]*)+{)/gm,stateRegex=/\.popmechanic-(?:success|error|pending|submitted|desktop|tablet|mobile)(\s|\.|#)/g;function containerizeHtml(e,t,n){return(n?'<div id="'+getContainerId(t)+'">':"")+e.replace(/id=["']popmechanic-(form|button)["']/g,'id="'+CONFIG.CSS_PREFIX+"$1-"+t+'"')+(n?"</div>":"")}window.PopMechanic.getContainer=getContainer,window.PopMechanic.getContainerId=getContainerId;var Session={},getItem,setItem,history,idArrayChanged,getIdArray,currentLocation;try{localStorage.setItem("popmechanic.localstorage",1)}catch(e){throw new Error("Private browsing not supported")}idArrayChanged=function(e,t){var n=(e||[]).map((function(e){return e.id}));return n.sort(),n.join()!=(t||[]).sort().join()},getIdArray=function(e){return e.map((function(e){return e.id}))},getItem=function(e,t){var n=localStorage.getItem(CONFIG.JS_PREFIX+e);if(n)try{return JSON.parse(n)}catch(e){return t}return t},setItem=function(e,t){localStorage.setItem(CONFIG.JS_PREFIX+e,JSON.stringify(t))},Session.setHostReported=function(){setItem("host-reported",1)},Session.isHostReported=function(){return getItem("host-reported")},Session.setForm=function(e,t){setItem("form-"+e,t)},Session.getForm=function(e){return getItem("form-"+e)},Session.formsChanged=function(e,t){return idArrayChanged(t,getItem("forms-"+e))},Session.setForms=function(e,t){setItem("forms-"+e,getIdArray(t))},Session.conditionsSplitsChanged=function(e,t){return idArrayChanged(t,getItem("conditions-splits-"+e))},Session.getConditionsSplit=function(e){return getItem("conditions-split-"+e)},Session.setConditionsSplit=function(e,t){setItem("conditions-split-"+e,t)},Session.setConditionsSplits=function(e,t){setItem("conditions-splits-"+e,getIdArray(t))},Session.settingsSplitsChanged=function(e,t){return idArrayChanged(t,getItem("settings-splits-"+e))},Session.getSettingsSplit=function(e){return getItem("settings-split-"+e)},Session.setSettingsSplit=function(e,t){setItem("settings-split-"+e,t)},Session.setSettingsSplits=function(e,t){setItem("settings-splits-"+e,getIdArray(t))},Session.setContactsSent=function(e){setItem("contacts-sent-"+(e=e||"lead"),"1")},Session.isContactsSent=function(e){return"lead"==(e=e||"lead")?"1"===getItem("contacts-sent")||getItem("contacts-sent-lead"):"1"===getItem("contacts-sent-"+e)},Session.setLastShownWithId=function(e){setItem("last-shown-"+e,(new Date).valueOf())},Session.setLastShown=function(e){Session.setLastShownWithId(e),setItem("last-shown",(new Date).valueOf())},Session.getLastShown=function(e){var t;return null===(t=getItem(e?"last-shown-"+e:"last-shown",null))?null:new Date(+t||0)},Session.isShown=function(e){return e?!!getItem("last-shown-"+e):!!getItem("last-shown")},Session.setCompleted=function(e){var t=(new Date).valueOf();setItem("completed-"+e,t),setItem("completed",t)},Session.getCompleted=function(e){var t;return null===(t=getItem(e?"completed-"+e:"completed",null))?null:new Date(+t||0)},Session.setUncompleted=function(e){var t=(new Date).valueOf();setItem("uncompleted-"+e,t),setItem("uncompleted",t)},Session.getUncompleted=function(e){var t;return null===(t=getItem(e?"uncompleted-"+e:"uncompleted",null))?null:new Date(+t||0)},Session.set=function(e,t){setItem(e,t)},Session.get=function(e){return getItem(e)},history=getItem("history",[]),history.push(location.href),history.splice(0,Math.max(history.length-10,0)),setItem("history",history),Session.history=history,Session.addToHistory=function(e){(history=getItem("history",[])).push(e),history.splice(0,Math.max(history.length-10,0)),setItem("history",history),Session.history=history},currentLocation=location.href,setInterval((function(){location.href!==currentLocation&&(currentLocation=location.href,Session.addToHistory(currentLocation))}),1e3);var sourcebuster={exports:{}};!function(e,t){e.exports=function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof commonjsRequire&&commonjsRequire;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,(function(e){var n=t[a][1][e];return i(n||e)}),l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof commonjsRequire&&commonjsRequire,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){var r=e("./init"),i={init:function(e){this.get=r(e),e&&e.callback&&"function"==typeof e.callback&&e.callback(this.get)}};t.exports=i},{"./init":7}],2:[function(e,t,n){var r=e("./terms"),i=e("./helpers/utils"),o={containers:{current:"sbjs_current",current_extra:"sbjs_current_add",first:"sbjs_first",first_extra:"sbjs_first_add",session:"sbjs_session",udata:"sbjs_udata",promocode:"sbjs_promo"},service:{migrations:"sbjs_migrations"},delimiter:"|||",aliases:{main:{type:"typ",source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},extra:{fire_date:"fd",entrance_point:"ep",referer:"rf"},session:{pages_seen:"pgs",current_page:"cpg"},udata:{visits:"vst",ip:"uip",agent:"uag"},promo:"code"},pack:{main:function(e){return o.aliases.main.type+"="+e.type+o.delimiter+o.aliases.main.source+"="+e.source+o.delimiter+o.aliases.main.medium+"="+e.medium+o.delimiter+o.aliases.main.campaign+"="+e.campaign+o.delimiter+o.aliases.main.content+"="+e.content+o.delimiter+o.aliases.main.term+"="+e.term},extra:function(e){return o.aliases.extra.fire_date+"="+i.setDate(new Date,e)+o.delimiter+o.aliases.extra.entrance_point+"="+document.location.href+o.delimiter+o.aliases.extra.referer+"="+(document.referrer||r.none)},user:function(e,t){return o.aliases.udata.visits+"="+e+o.delimiter+o.aliases.udata.ip+"="+t+o.delimiter+o.aliases.udata.agent+"="+navigator.userAgent},session:function(e){return o.aliases.session.pages_seen+"="+e+o.delimiter+o.aliases.session.current_page+"="+document.location.href},promo:function(e){return o.aliases.promo+"="+i.setLeadingZeroToInt(i.randomInt(e.min,e.max),e.max.toString().length)}}};t.exports=o},{"./helpers/utils":6,"./terms":10}],3:[function(e,t,n){var r=e("../data").delimiter,i="";t.exports={setPrefix:function(e){i=e},getPrefix:function(){return i},encodeData:function(e){return i+encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(e){try{return decodeURIComponent(e.replace(new RegExp("^"+i),"")).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(t){try{return unescape(e)}catch(e){return""}}},set:function(e,t,n,r,i){var o,a;if(n){var s=new Date;s.setTime(s.getTime()+60*n*1e3),o="; expires="+s.toGMTString()}else o="";a=r&&!i?";domain=."+r:"",document.cookie=this.encodeData(e)+"="+this.encodeData(t)+o+a+"; path=/"},get:function(e){for(var t=this.encodeData(e)+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return this.decodeData(i.substring(t.length,i.length))}return null},destroy:function(e,t,n){this.set(e,"",-1,t,n)},parse:function(e){var t=[],n={};if("string"==typeof e)t.push(e);else for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);for(var o=0;o<t.length;o++){var a;n[this.unsbjs(t[o])]={},a=this.get(t[o])?this.get(t[o]).split(r):[];for(var s=0;s<a.length;s++){var c=a[s].split("="),u=c.splice(0,1);u.push(c.join("=")),n[this.unsbjs(t[o])][u[0]]=this.decodeData(u[1])}}return n},unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":2}],4:[function(e,t,n){var r="",i=e("../data").delimiter;t.exports={setPrefix:function(e){r=e},getPrefix:function(){return r},encodeData:function(e){return r+encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(e){try{return decodeURIComponent(e.replace(new RegExp("^"+r),"")).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(t){try{return unescape(e)}catch(e){return""}}},set:function(e,t,n){var r;if(n){var i=new Date;i.setTime(i.getTime()+60*n*1e3),r=i.valueOf()}else r="";localStorage.setItem(this.encodeData(e),JSON.stringify({value:t,expires:r}))},get:function(e){var t=this.encodeData(e),n=localStorage.getItem(t);return n?(n=JSON.parse(n)).expires&&parseInt(n.expires)<(new Date).valueOf()?(n=null,localStorage.removeItem(t),null):n.value:null},parse:function(e){var t=[],n={};if("string"==typeof e)t.push(e);else for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);for(var o=0;o<t.length;o++){var a;n[this.unsbjs(t[o])]={},a=this.get(t[o])?this.get(t[o]).split(i):[];for(var s=0;s<a.length;s++){var c=a[s].split("="),u=c.splice(0,1);u.push(c.join("=")),n[this.unsbjs(t[o])][u[0]]=this.decodeData(u[1])}}return n},destroy:function(e){localStorage.removeItem(this.encodeData(e))},unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":2}],5:[function(e,t,n){t.exports={parse:function(e){for(var t=this.parseOptions,n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;i--;)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,(function(e,n,i){n&&(r[t.q.name][n]=i)})),r},parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:function(e){for(var t={},n=(e||window.location.search.substring(1)).split("&"),r=0;r<n.length;r++){var i=n[r].split("=");if(void 0===t[i[0]])t[i[0]]=i[1];else if("string"==typeof t[i[0]]){var o=[t[i[0]],i[1]];t[i[0]]=o}else t[i[0]].push(i[1])}return t},getHost:function(e){return this.parse(e).host.replace("www.","")}}},{}],6:[function(e,t,n){t.exports={escapeRegexp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},setDate:function(e,t){var n=e.getTimezoneOffset()/60,r=e.getHours(),i=t||0===t?t:-n;return e.setHours(r+n+i),e.getFullYear()+"-"+this.setLeadingZeroToInt(e.getMonth()+1,2)+"-"+this.setLeadingZeroToInt(e.getDate(),2)+" "+this.setLeadingZeroToInt(e.getHours(),2)+":"+this.setLeadingZeroToInt(e.getMinutes(),2)+":"+this.setLeadingZeroToInt(e.getSeconds(),2)},setLeadingZeroToInt:function(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n},randomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}}},{}],7:[function(e,t,n){var r=e("./data"),i=e("./terms"),o=e("./helpers/localStorage"),a=e("./helpers/uri"),s=e("./helpers/utils"),c=e("./params"),u=e("./migrations");t.exports=function(e){var t,n,l,d,f,h,p,m,g,v=c.fetch(e),_=a.getParam(),y=v.domain.host,b=v.domain.isolate,S=v.lifetime;function w(e){switch(e){case i.traffic.utm:t=i.traffic.utm,n=void 0!==_.utm_source?_.utm_source:void 0!==_.gclid?"google":void 0!==_.yclid?"yandex":i.none,l=void 0!==_.utm_medium?_.utm_medium:void 0!==_.gclid||void 0!==_.yclid?"cpc":i.none,d=void 0!==_.utm_campaign?_.utm_campaign:void 0!==_[v.campaign_param]?_[v.campaign_param]:void 0!==_.gclid?"google_cpc":void 0!==_.yclid?"yandex_cpc":i.none,f=_.utm_content||i.none,h=function(){var e=document.referrer;if(_.utm_term)return _.utm_term;if(!(e&&a.parse(e).host&&a.parse(e).host.match(/^(?:.*\.)?yandex\..{2,9}$/i)))return!1;try{return a.getParam(a.parse(document.referrer).query).text}catch(e){return!1}}()||i.none;break;case i.traffic.organic:t=i.traffic.organic,n=n||a.getHost(document.referrer),l=i.referer.organic,d=i.none,f=i.none,h=i.none;break;case i.traffic.referral:t=i.traffic.referral,n=n||a.getHost(document.referrer),l=l||i.referer.referral,d=i.none,f=a.parse(document.referrer).path,h=i.none;break;case i.traffic.typein:t=i.traffic.typein,n=v.typein_attributes.source,l=v.typein_attributes.medium,d=i.none,f=i.none,h=i.none;break;default:t=i.oops,n=i.oops,l=i.oops,d=i.oops,f=i.oops,h=i.oops}var o={type:t,source:n,medium:l,campaign:d,content:f,term:h};return r.pack.main(o)}function I(e){var t=document.referrer;switch(e){case i.traffic.organic:return!!t&&C(t)&&function(e){var t=new RegExp("^https://yandex\\.[a-zA-Z0-9]{2}/$"),r=new RegExp("^(?:.*\\.)?"+s.escapeRegexp("yandex")+"\\..{2,9}$"),i=new RegExp(".*"+s.escapeRegexp("text")+"=.*"),o=new RegExp("^(?:www\\.)?"+s.escapeRegexp("google")+"\\..{2,9}$");if(a.parse(e).query&&a.parse(e).host.match(r)&&a.parse(e).query.match(i)||e.match(t))return n="yandex",!0;if(a.parse(e).host.match(o))return n="google",!0;if(!a.parse(e).query)return!1;for(var c=0;c<v.organics.length;c++){if(a.parse(e).host.match(new RegExp("^(?:.*\\.)?"+s.escapeRegexp(v.organics[c].host)+"$","i"))&&a.parse(e).query.match(new RegExp(".*"+s.escapeRegexp(v.organics[c].param)+"=.*","i")))return n=v.organics[c].display||v.organics[c].host,!0;if(c+1===v.organics.length)return!1}}(t);case i.traffic.referral:return!!t&&C(t)&&function(e){if(!(v.referrals.length>0))return n=a.getHost(e),!0;for(var t=0;t<v.referrals.length;t++){if(a.parse(e).host.match(new RegExp("^(?:.*\\.)?"+s.escapeRegexp(v.referrals[t].host)+"$","i")))return n=v.referrals[t].display||v.referrals[t].host,l=v.referrals[t].medium||i.referer.referral,!0;if(t+1===v.referrals.length)return n=a.getHost(e),!0}}(t);default:return!1}}function C(e){if(v.domain){if(b)return a.getHost(e)!==a.getHost(y);var t=new RegExp("^(?:.*\\.)?"+s.escapeRegexp(y)+"$","i");return!a.getHost(e).match(t)}return a.getHost(e)!==a.getHost(document.location.href)}function P(){o.set(r.containers.current_extra,r.pack.extra(v.timezone_offset),S,y,b),o.get(r.containers.first_extra)||o.set(r.containers.first_extra,r.pack.extra(v.timezone_offset),S,y,b)}return o.setPrefix(v.prefix),u.go(S,y,b),o.set(r.containers.current,function(){var e;if(void 0!==_.utm_source||void 0!==_.utm_medium||void 0!==_.utm_campaign||void 0!==_.utm_content||void 0!==_.utm_term||void 0!==_.gclid||void 0!==_.yclid||void 0!==_[v.campaign_param])P(),e=w(i.traffic.utm);else if(I(i.traffic.organic))P(),e=w(i.traffic.organic);else if(!o.get(r.containers.session)&&I(i.traffic.referral))P(),e=w(i.traffic.referral);else{if(o.get(r.containers.first)||o.get(r.containers.current))return o.get(r.containers.current);P(),e=w(i.traffic.typein)}return e}(),S,y,b),o.get(r.containers.first)||o.set(r.containers.first,o.get(r.containers.current),S,y,b),o.get(r.containers.udata)?(p=parseInt(o.parse(r.containers.udata)[o.unsbjs(r.containers.udata)][r.aliases.udata.visits])||1,p=o.get(r.containers.session)?p:p+1,m=r.pack.user(p,v.user_ip)):(p=1,m=r.pack.user(p,v.user_ip)),o.set(r.containers.udata,m,S,y,b),o.get(r.containers.session)?(g=parseInt(o.parse(r.containers.session)[o.unsbjs(r.containers.session)][r.aliases.session.pages_seen])||1,g+=1):g=1,o.set(r.containers.session,r.pack.session(g),v.session_length,y,b),v.promocode&&!o.get(r.containers.promocode)&&o.set(r.containers.promocode,r.pack.promo(v.promocode),S,y,b),o.parse(r.containers)}},{"./data":2,"./helpers/localStorage":4,"./helpers/uri":5,"./helpers/utils":6,"./migrations":8,"./params":9,"./terms":10}],8:[function(e,t,n){var r=e("./data"),i=e("./helpers/cookies"),o=e("./helpers/localStorage");t.exports={go:function(e,t,n){var a,s=this.migrations,c={l:e,d:t,i:n},u=[],l="";if(i.setPrefix(o.getPrefix()),i.get(r.containers.first)||i.get(r.service.migrations))if(i.get(r.service.migrations)){for(u=i.get(r.service.migrations).split(r.delimiter),a=0;a<s.length;a++)-1===u.indexOf(s[a].id+"=1")&&(console.log("migrating: "+s[a]),s[a].go(s[a].id,c));for(u=[],a=0;a<s.length;a++)u.push(s[a].id);for(l="",a=0;a<u.length;a++)l+=u[a]+"=1",a<u.length-1&&(l+=r.delimiter);i.set(r.service.migrations,l,c.l,c.d,c.i)}else for(a=0;a<s.length;a++)s[a].go(s[a].id,c);else{for(a=0;a<s.length;a++)u.push(s[a].id);for(l="",a=0;a<u.length;a++)l+=u[a]+"=1",a<u.length-1&&(l+=r.delimiter);i.set(r.service.migrations,l,c.l,c.d,c.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta",go:function(e,t){var n=e+"=1",o=e+"=0",a=function(e,t,n){return t||n?e:r.delimiter};try{var s=[];for(var c in r.containers)r.containers.hasOwnProperty(c)&&s.push(r.containers[c]);for(var u=0;u<s.length;u++)if(i.get(s[u])){var l=i.get(s[u]).replace(/(\|)?\|(\|)?/g,a);i.destroy(s[u],t.d,t.i),i.destroy(s[u],t.d,!t.i),i.set(s[u],l,t.l,t.d,t.i)}i.get(r.containers.session)&&i.set(r.containers.session,r.pack.session(0),t.l,t.d,t.i),i.set(r.service.migrations,n,t.l,t.d,t.i)}catch(e){i.set(r.service.migrations,o,t.l,t.d,t.i)}}},{id:"1471519752600",version:"1.0.5",go:function(e,t){var n=e+"=1",o=e+"=0",a=i.getPrefix();try{i.setPrefix("");var s=[];for(var c in r.containers)r.containers.hasOwnProperty(c)&&s.push(r.containers[c]);for(var u=0;u<s.length;u++)if(i.setPrefix(""),i.get(s[u])){var l=i.get(s[u]);i.setPrefix(a),i.set(s[u],l,t.l,t.d,t.i)}i.setPrefix(""),i.get(r.containers.session)&&(i.setPrefix(a),i.set(r.containers.session,r.pack.session(0),t.l,t.d,t.i)),i.setPrefix(a),i.set(r.service.migrations,n,t.l,t.d,t.i)}catch(e){i.set(r.service.migrations,o,t.l,t.d,t.i)}}},{id:"1471519752605",version:"1.1.0",go:function(e,t){for(var n in r.containers)if(r.containers.hasOwnProperty(n)){var a=i.get(r.containers[n]);o.set(r.containers[n],a,t.l),i.destroy(r.containers[n])}}}]}},{"./data":2,"./helpers/cookies":3,"./helpers/localStorage":4}],9:[function(e,t,n){var r=e("./terms"),i=e("./helpers/uri");t.exports={fetch:function(e){var t=e||{},n={};if(n.prefix=this.validate.isString(t.prefix)?t.prefix:"",n.lifetime=this.validate.checkFloat(t.lifetime)||6,n.lifetime=parseInt(30*n.lifetime*24*60),n.session_length=this.validate.checkInt(t.session_length)||30,n.timezone_offset=this.validate.checkInt(t.timezone_offset),n.campaign_param=t.campaign_param||!1,n.user_ip=t.user_ip||r.none,t.promocode?(n.promocode={},n.promocode.min=parseInt(t.promocode.min)||1e5,n.promocode.max=parseInt(t.promocode.max)||999999):n.promocode=!1,t.typein_attributes&&t.typein_attributes.source&&t.typein_attributes.medium?(n.typein_attributes={},n.typein_attributes.source=t.typein_attributes.source,n.typein_attributes.medium=t.typein_attributes.medium):n.typein_attributes={source:"(direct)",medium:"(none)"},t.domain&&this.validate.isString(t.domain)?n.domain={host:t.domain,isolate:!1}:t.domain&&t.domain.host?n.domain=t.domain:n.domain={host:i.getHost(document.location.hostname),isolate:!1},n.referrals=[],t.referrals&&t.referrals.length>0)for(var o=0;o<t.referrals.length;o++)t.referrals[o].host&&n.referrals.push(t.referrals[o]);if(n.organics=[],t.organics&&t.organics.length>0)for(var a=0;a<t.organics.length;a++)t.organics[a].host&&t.organics[a].param&&n.organics.push(t.organics[a]);return n.organics.push({host:"bing.com",param:"q",display:"bing"}),n.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),n.organics.push({host:"about.com",param:"q",display:"about"}),n.organics.push({host:"aol.com",param:"q",display:"aol"}),n.organics.push({host:"ask.com",param:"q",display:"ask"}),n.organics.push({host:"globososo.com",param:"q",display:"globo"}),n.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),n.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),n.organics.push({host:"tut.by",param:"query",display:"tut.by"}),n.referrals.push({host:"t.co",display:"twitter.com"}),n.referrals.push({host:"plus.url.google.com",display:"plus.google.com"}),n},validate:{checkFloat:function(e){return!(!e||!this.isNumeric(parseFloat(e)))&&parseFloat(e)},checkInt:function(e){return!(!e||!this.isNumeric(parseInt(e)))&&parseInt(e)},isNumeric:function(e){return!isNaN(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)}}}},{"./helpers/uri":5,"./terms":10}],10:[function(e,t,n){t.exports={traffic:{utm:"utm",organic:"organic",referral:"referral",typein:"typein"},referer:{referral:"referral",organic:"organic",social:"social"},none:"(none)",oops:"(Houston, we have a problem)"}},{}]},{},[1])(1)}(sourcebuster);var sbjs=sourcebuster.exports,storageKey=CONFIG.CSS_PREFIX+"-init-at";function getCachedVisitStartTs(){var e=getVisit();if(sbjs.get.current_add.fb&&"string"==typeof sbjs.get.current_add.fb){var t=new Date(sbjs.get.current_add.fb.replace(" ","T")).valueOf();return localStorage[storageKey]=e+":"+t,t}if(localStorage[storageKey]){var n=localStorage[storageKey].split(":"),r=n[0],i=n[1];if(parseInt(r,10)===e)return parseInt(i,10)}return localStorage[storageKey]=e+":"+window.PopMechanic.initStartedAt,window.PopMechanic.initStartedAt}var updateCachedVisitStartTs=getCachedVisitStartTs;function getVisit(){var e=sbjs.get.udata.vst;try{return parseInt(e)}catch(e){return 0}}var hasExtension=!1;function isDebugging(){try{return!!hasExtension||(!!window.PopMechanic.isTesting||(-1!==location.toString().indexOf("pm-test-form")||(-1!==location.hash.indexOf("pm-debug")||!!localStorage["pm-debug"])))}catch(e){return!1}}function log(){if(isDebugging()){var e=_.toArray(arguments);console.log.apply(console,["PopMechanic:"].concat(e))}}window.addEventListener("message",(function(e){e.source===window&&e.data&&"popmechanic-extension"===e.data.source&&(hasExtension=!0)}));var defaultDebug={isDebugging:isDebugging,log:log},DB_VERSION=10,DB_NAME="db",HISTORY_STORE_ID="h",EVENT_STORE_ID="e",PRODUCT_SEGMENTATION_STORE_ID="ps",FORM_STORE_ID="f",PERSIST_FOR_MONTHS=6,PRUNE_COOLDOWN_MS=864e5,PRUNE_UP_TO=1e3,indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,IDBKeyRange$1=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,db=null,requestQueue=[];function openDb(){var e=indexedDB.open(CONFIG.JS_PREFIX+DB_NAME,DB_VERSION);e.onerror=function(e){console.error("Error opening indexedDB"),callRequestQueue()},e.onsuccess=function(e){(db=e.target.result).onversionchange=function(){db.close(),db=null},db.onclose=function(){db=null},db.onerror=function(e){console.error("PopMechanic IDB error "+e.target.errorCode)};var t=parseInt(localStorage[CONFIG.JS_PREFIX+"pruned-at"]);if(!t||Date.now()-1e3*t>PRUNE_COOLDOWN_MS){localStorage[CONFIG.JS_PREFIX+"pruned-at"]=Math.floor(Date.now()/1e3);var n=new Date;n.setMonth(n.getMonth()-PERSIST_FOR_MONTHS);var r=n.valueOf();pruneRecords(HISTORY_STORE_ID,r),pruneRecords(EVENT_STORE_ID,r),pruneRecords(PRODUCT_SEGMENTATION_STORE_ID,r),pruneRecords(FORM_STORE_ID,r)}callRequestQueue()},e.onupgradeneeded=function(t){var n,r=t.target.result;if(t.oldVersion<1){var i=r.createObjectStore(HISTORY_STORE_ID,{autoIncrement:!0});i.createIndex("url","url",{unique:!1}),i.createIndex("vst","vst",{unique:!1})}if(t.oldVersion<2&&((n=r.createObjectStore(EVENT_STORE_ID,{autoIncrement:!0})).createIndex("type","type",{unique:!1}),n.createIndex("vst","vst",{unique:!1}),n.createIndex("form","form",{unique:!1})),t.oldVersion<4&&((n=e.transaction.objectStore(EVENT_STORE_ID)).indexNames.contains("ts")||n.createIndex("ts","ts",{unique:!1})),t.oldVersion<5&&((i=e.transaction.objectStore(HISTORY_STORE_ID)).indexNames.contains("pagetype")||i.createIndex("pagetype","pagetype",{unique:!1})),6===t.oldVersion&&r.deleteObjectStore(PRODUCT_SEGMENTATION_STORE_ID),t.oldVersion<7){var o=r.createObjectStore(PRODUCT_SEGMENTATION_STORE_ID,{autoIncrement:!0});o.createIndex("productIds","productIds",{unique:!1}),o.createIndex("segmentationId","segmentationId",{unique:!1}),o.createIndex("segmentId","segmentId",{unique:!1}),o.createIndex("ts","ts",{unique:!1})}(t.oldVersion<8&&((i=e.transaction.objectStore(HISTORY_STORE_ID)).indexNames.contains("productIds")||i.createIndex("productIds","productIds",{unique:!1}),i.indexNames.contains("categoryIds")||i.createIndex("categoryIds","categoryIds",{unique:!1})),t.oldVersion<9)&&(e.transaction.objectStore(HISTORY_STORE_ID).createIndex("productItem","productItem",{unique:!1}),e.transaction.objectStore(PRODUCT_SEGMENTATION_STORE_ID).createIndex("productItem","productItem",{unique:!1}));t.oldVersion<10&&((n=r.createObjectStore(FORM_STORE_ID,{autoIncrement:!0})).createIndex("id","id",{unique:!0}),n.createIndex("form","form",{unique:!1}))}}function pruneRecords(e,t){var n;defaultDebug.isDebugging()&&(n=Date.now(),defaultDebug.log("store "+e+" prune started @",n));var r=db.transaction(e,"readwrite"),i=0;r.objectStore(e).openCursor().onsuccess=function(e){var n=e.target.result;n&&((!n.value.ts||n.value.ts<t)&&(n.delete(),i+=1),i<PRUNE_UP_TO&&n.continue())},defaultDebug.isDebugging()&&(r.oncomplete=function(){var t=Date.now();defaultDebug.log("store "+e+" prune complete @",t,"total: ",t-n)})}function callRequestQueue(){requestQueue.forEach((function(e){e()})),requestQueue.push=function(e){"function"==typeof e&&e()}}function enqueued(e){if("function"==typeof e)return function(){var t=this,n=arguments;return new Promise((function(r,i){requestQueue.push((function(){e.apply(t,n).then(r,i)}))}))}}function pushVisit(e){return db?new Promise((function(t,n){var r=db.transaction([HISTORY_STORE_ID],"readwrite").objectStore(HISTORY_STORE_ID).add(e);r.addEventListener("success",(function(){t(r.result)})),r.addEventListener("error",(function(){n(r.error)}))})):Promise.resolve()}function enrichVisit(e,t){return db?new Promise((function(n,r){var i=db.transaction([HISTORY_STORE_ID],"readwrite").objectStore(HISTORY_STORE_ID),o=i.get(e);o.addEventListener("success",(function(){var a=_.extend({},o.result,t),s=i.put(a,e);s.addEventListener("success",n),s.addEventListener("error",r)})),o.addEventListener("error",(function(){n()}))})):Promise.resolve()}function pushEvent(e){if(!db)return Promise.resolve();if(!e||!e.type)return Promise.resolve();var t=_.clone(e);return"number"!=typeof e.vst&&(t.vst=getVisit()),"number"!=typeof e.ts&&(t.ts=Date.now()),db.transaction(EVENT_STORE_ID,"readwrite").objectStore(EVENT_STORE_ID).add(t),Promise.resolve()}function getLastEvent$1(e,t){return db?new Promise((function(n){var r=db.transaction(EVENT_STORE_ID).objectStore(EVENT_STORE_ID).index(e.form?"form":"type"),i=e.form?IDBKeyRange$1.only(e.form):e.type?IDBKeyRange$1.only(e.type):null,o=null;r.openCursor(i,["prev"]).onsuccess=function(r){var i=r.target.result;if(i){if(e.form&&i.value.form!==e.form)return i.continue();if(e.type&&i.value.type!==e.type)return i.continue();if("function"==typeof t&&!t(i.value))return i.continue();(!o||o&&o.ts<i.value.ts)&&(o=i.value),i.continue()}else n(o)}})):Promise.reject()}function alwaysTrue(){return!0}function forEachEvents(e,t,n){if(!db)return Promise.reject();var r=db.transaction(EVENT_STORE_ID),i=e?r.objectStore(EVENT_STORE_ID).index(e):r.objectStore(EVENT_STORE_ID);return new Promise((function(e){i.openCursor(t||null).onsuccess=function(t){var r=t.target.result;r?(n(r.value),r.continue()):e()}}))}function countVisits(e,t,n){return db?(void 0===e&&(e=alwaysTrue),void 0===t&&(t=0),new Promise((function(r){var i=[],o=db.transaction(HISTORY_STORE_ID).objectStore(HISTORY_STORE_ID).index(n?"vst":"url"),a=n?IDBKeyRange$1.only(n):null;n||"string"!=typeof e||(a=IDBKeyRange$1.only(e)),o.openCursor(a).onsuccess=function(n){var o=n.target.result;if(o){if(o.value.ts>=t){var a=Promise.resolve("string"==typeof e?e===o.value.url:e(o.value));i.push(a)}o.continue()}else Promise.all(i).then((function(e){var t=_.filter(e,_.identity).length;r(t)}))}}))):Promise.reject()}function findVisit(e,t,n){return db?(void 0===e&&(e=alwaysTrue),void 0===t&&(t=0),new Promise((function(r){var i=[],o=db.transaction(HISTORY_STORE_ID).objectStore(HISTORY_STORE_ID).index(n?"vst":"url"),a=n?IDBKeyRange$1.only(n):null;n||"string"!=typeof e||(a=IDBKeyRange$1.only(e)),o.openCursor(a,["prev"]).onsuccess=function(n){var o=n.target.result;if(o){if(o.value.ts>=t){var a=Promise.resolve("string"==typeof e?e===o.value.url:e(o.value));i.push(a)}o.continue()}else Promise.all(i).then((function(e){var t=_.filter(e,_.identity)[0];r(t||null)}))}}))):Promise.reject()}function pushProductItemSegmentation(e){return db?new Promise((function(t,n){var r=db.transaction([PRODUCT_SEGMENTATION_STORE_ID],"readwrite"),i=r.objectStore(PRODUCT_SEGMENTATION_STORE_ID);e.forEach((function(e){i.add(e)})),r.oncomplete=function(){t("OK")},r.onerror=function(e){n(e)}})):Promise.resolve()}function findProductItemSegmentation(e,t){return db?(void 0===e&&(e=alwaysTrue),void 0===t&&(t=0),new Promise((function(n){db.transaction(PRODUCT_SEGMENTATION_STORE_ID).objectStore(PRODUCT_SEGMENTATION_STORE_ID).openCursor().onsuccess=function(r){var i=r.target.result;i?(t<i.value.ts||n(null),e(i.value)?n(i.value):i.continue()):n(null)}}))):Promise.reject()}function removeProductItemSegmentation(e){return db?(void 0===e&&(e=alwaysTrue),new Promise((function(t){db.transaction(PRODUCT_SEGMENTATION_STORE_ID,"readwrite").objectStore(PRODUCT_SEGMENTATION_STORE_ID).openCursor().onsuccess=function(n){var r=n.target.result;r?(e(r.value)&&r.delete(),r.continue()):t("OK")}}))):Promise.reject()}function filterProductItemSegmentations(e,t){return db?(void 0===e&&(e=alwaysTrue),void 0===t&&(t=0),new Promise((function(n){var r=[];db.transaction(PRODUCT_SEGMENTATION_STORE_ID).objectStore(PRODUCT_SEGMENTATION_STORE_ID).openCursor(null,["prev"]).onsuccess=function(i){var o=i.target.result;o?(t<o.value.ts||n(r),("string"==typeof e?e===o.value.url:e(o.value))&&r.push(o.value),o.continue()):n(r)}}))):Promise.reject()}function addForm(e){var t=e.id,n=e.form;return db?new Promise((function(e,r){var i=db.transaction([FORM_STORE_ID],"readwrite").objectStore(FORM_STORE_ID).put(n,t);i.addEventListener("success",e),i.addEventListener("error",r)})):Promise.resolve()}function getFormById(e){return db?new Promise((function(t,n){var r=db.transaction(FORM_STORE_ID).objectStore(FORM_STORE_ID).get(e);r.addEventListener("success",(function(e){return t(e.target.result)})),r.addEventListener("error",(function(){return n(null)}))})):Promise.reject(null)}indexedDB||callRequestQueue(),openDb();var visit={push:enqueued(pushVisit),enrich:enqueued(enrichVisit),count:enqueued(countVisits),find:enqueued(findVisit)},event={push:enqueued(pushEvent),getLast:enqueued(getLastEvent$1),forEach:enqueued(forEachEvents)},productItemSegmentation={push:enqueued(pushProductItemSegmentation),remove:enqueued(removeProductItemSegmentation),find:enqueued(findProductItemSegmentation),filter:enqueued(filterProductItemSegmentations)},form={add:enqueued(addForm),getById:enqueued(getFormById)},Dispatcher={on:function(e,t){$snippet.on(e,t)},off:function(e,t){$snippet.off(e,t)},trigger:function(e,t){$snippet.trigger(e,t)}};function getAlwaysFalseChecker(){return function(e){e({result:!1,final:!0})}}function getAlwaysTrueChecker(){return function(e){e({result:!0,final:!0})}}function alwaysFalse(){return!1}function doNothing(){}function isFinalAndTrue(e){return e.final&&e.result}function isFinalAndFalse(e){return e.final&&!e.result}var stringOperators=["$any","$contains","$exclude","$startsWith","$endsWith","$eq","$neq","$regexp","$not_regexp"],stringArrayOperators=stringOperators.concat(["$any","$none","$in","$nin","$in_contains","$in_startsWith","$in_endsWith","$in_regexp"]),booleanOperators=["$any","$eq","$neq"],numberOperators=["$any","$eq","$neq","$lt","$gt","$lte","$gte","$between"],arrayOperators=["$any","$none","$in","$nin"],domElementOperators=["$exists","$not_exists"],formEventsOperators=["$after"],allowedOperators={day_of_week:arrayOperators,city:arrayOperators,region:arrayOperators,country:arrayOperators,source:arrayOperators,device:arrayOperators,operating_system:arrayOperators,push_request_unavailable:booleanOperators,page:stringArrayOperators,referrer:stringOperators,utm_source:stringOperators,utm_medium:stringOperators,utm_campaign:stringOperators,utm_content:stringOperators,utm_term:stringOperators,visit:numberOperators,form_completed:formEventsOperators,form_uncompleted:formEventsOperators,form_seen:formEventsOperators,dom_element:domElementOperators,cart:numberOperators,time:numberOperators,time_utc:numberOperators,datetime:numberOperators,datetime_utc:numberOperators,google_optimize:arrayOperators,visited_url:numberOperators,productId:stringArrayOperators,productName:stringArrayOperators,productCategoryId:stringArrayOperators,productBrandName:stringArrayOperators,productPrice:numberOperators,productPriceWithDiscount:numberOperators,productDiscount:numberOperators,categoryId:stringArrayOperators,time_passed:["$eq","$between","$any"],url:stringArrayOperators,js:["$exec"],mindboxProductSegment:["$exists","$not_exists"]},tsResult=null,tsPromise=null;function cloneDate(e){return new Date(e)}function getServerTs(){return tsPromise?tsPromise.then(cloneDate):tsPromise=(tsPromise=new Promise((function(e,t){cash.ajax({type:"GET",url:CONFIG.TS_URL,dataType:"json",success:e,error:t})}))).then((function(e){return tsResult=new Date(e.timestamp)})).catch((function(){return window.PopMechanic.initAt}))}function getServerTsSync(){return tsResult?new Date(tsResult):new Date(window.PopMechanic.initAt)}var serverTsProvider={get:getServerTs,getSync:getServerTsSync},util={checkPatterns:function(e,t){return t.some((function(t){return util.checkPattern(e,t)}))},checkPattern:function(e,t){var n="^"+t.replace(/\*/g,"(.*)")+"$";return"!"===n.charAt(0)?!new RegExp(n.substr(1),"i").test(e):new RegExp(n,"i").test(e)},validate:function(e,t){var n;return"email"===e?/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t):"phone"===e?(n=t.replace(/[+\s\.\-\(\)]/g,""),/[0-9]{5,13}/im.test(n)):!!t.length},propertyByPath:function(e,t){for(var n=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),r=0,i=n.length;r<i;++r){var o=n[r];if(!(o in e))return;e=e[o]}return e},hasNonAsciiCharacters:function(e){return!e.match(/^[\u0000-\u007f]*$/)}},punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(e){throw new RangeError(errors[e])}function map(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function mapDomain(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+map((e=e.replace(regexSeparators,".")).split("."),t).join(".")}function ucs2decode(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function ucs2encode(e){return map(e,(function(e){var t="";return e>65535&&(t+=stringFromCharCode((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=stringFromCharCode(e)})).join("")}function basicToDigit(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:base}function digitToBasic(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function adapt(e,t,n){var r=0;for(e=n?floor(e/damp):e>>1,e+=floor(e/t);e>baseMinusTMin*tMax>>1;r+=base)e=floor(e/baseMinusTMin);return floor(r+(baseMinusTMin+1)*e/(e+skew))}function decode(e){var t,n,r,i,o,a,s,c,u,l,d=[],f=e.length,h=0,p=initialN,m=initialBias;for((n=e.lastIndexOf(delimiter))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&error("not-basic"),d.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<f;){for(o=h,a=1,s=base;i>=f&&error("invalid-input"),((c=basicToDigit(e.charCodeAt(i++)))>=base||c>floor((maxInt-h)/a))&&error("overflow"),h+=c*a,!(c<(u=s<=m?tMin:s>=m+tMax?tMax:s-m));s+=base)a>floor(maxInt/(l=base-u))&&error("overflow"),a*=l;m=adapt(h-o,t=d.length+1,0==o),floor(h/t)>maxInt-p&&error("overflow"),p+=floor(h/t),h%=t,d.splice(h++,0,p)}return ucs2encode(d)}function encode(e){var t,n,r,i,o,a,s,c,u,l,d,f,h,p,m,g=[];for(f=(e=ucs2decode(e)).length,t=initialN,n=0,o=initialBias,a=0;a<f;++a)(d=e[a])<128&&g.push(stringFromCharCode(d));for(r=i=g.length,i&&g.push(delimiter);r<f;){for(s=maxInt,a=0;a<f;++a)(d=e[a])>=t&&d<s&&(s=d);for(s-t>floor((maxInt-n)/(h=r+1))&&error("overflow"),n+=(s-t)*h,t=s,a=0;a<f;++a)if((d=e[a])<t&&++n>maxInt&&error("overflow"),d==t){for(c=n,u=base;!(c<(l=u<=o?tMin:u>=o+tMax?tMax:u-o));u+=base)m=c-l,p=base-l,g.push(stringFromCharCode(digitToBasic(l+m%p,0))),c=floor(m/p);g.push(stringFromCharCode(digitToBasic(c,0))),o=adapt(n,h,r==i),n=0,++r}++n,++t}return g.join("")}function toUnicode(e){return mapDomain(e,(function(e){return regexPunycode.test(e)?decode(e.slice(4).toLowerCase()):e}))}function toASCII(e){return mapDomain(e,(function(e){return regexNonASCII.test(e)?"xn--"+encode(e):e}))}punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};var punycode$1=punycode,geoPromise=null,geoResolve=null;function getGeo(){if(geoPromise)return geoPromise;var e=new Promise((function(e){geoResolve=e})),t=new Promise((function(e,t){cash.ajax({type:"GET",url:CONFIG.GEO_URL,data:{domain:location.hostname},dataType:"json",success:e,error:t})}));return geoPromise=Promise.race([t,e]).catch((function(){return{}}))}function getGeoSync(){return{}}function setGeo(e){geoResolve(e)}var geoProvider={getGeo:getGeo,getGeoSync:getGeoSync,setGeo:setGeo};function getIntegrationPromise(e,t,n,r,i){void 0===t&&(t=void 0),void 0===n&&(n=500),void 0===r&&(r=2e3),void 0===i&&(i=15);var o=null;return new Promise((function(a){!function n(s,c){void 0===window[e]||void 0!==t&&window[e]!==t||(o=window[e],a(o)),c>=i&&a(null),setTimeout((function(){var e=2*s;n(e>r?r:e,c+1)}),s)}(n,0)}))}var pageDataPromise=getIntegrationPromise("PopMechanicPageData"),getPopmechanicCart=function(){return getIntegrationPromise("PopMechanicCartData")};function pad(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}var fieldValues={device:function(){return device$1.desktop()?"pc":device$1.tablet()?"tablet":"mobile"},operating_system:function(){return device$1.windows()?"windows":device$1.ios()?"ios":device$1.macosx()?"macos":device$1.android()?"android":device$1.linux()?"linux":"other"},source:function(){return sbjs.get.current.typ},time:function(){return serverTsProvider.get()},time_utc:function(){return serverTsProvider.get()},day_of_week:function(){return serverTsProvider.get().then((function(e){return e.getDay()}))},datetime:function(){return serverTsProvider.get()},datetime_utc:function(){return serverTsProvider.get()},page:function(e){return util.hasNonAsciiCharacters(e.value)?location.href.replace(location.host,punycode$1.toUnicode(location.host)):location.href.replace(location.host,punycode$1.toASCII(location.host))},country:function(){return geoProvider.getGeo().then((function(e){return e.country_id}))},region:function(){return geoProvider.getGeo().then((function(e){return e.region_id}))},city:function(){return geoProvider.getGeo().then((function(e){return e.city_id}))},utm_source:function(){return sbjs.get.current.src},utm_medium:function(){return sbjs.get.current.mdm},utm_campaign:function(){return sbjs.get.current.cmp},utm_content:function(){return sbjs.get.current.cnt},utm_term:function(){return sbjs.get.current.trm},visit:function(){return parseInt(sbjs.get.udata.vst,10)},referrer:function(){return document.referrer},google_optimize:function(e){return new Promise((function(t){var n=e.value.expId;!function e(r){try{var i=document.cookie.split(n)[1].split(";")[0].split(".")[2].split("!")[0];i=parseInt(i,10),t(i)}catch(n){r<500?setTimeout((function(){e(2*r)}),r):t(void 0)}}(100)}))},visited_url:function(e){var t,n,r;return fieldOperators.hasOwnProperty(e.value.operator)&&(t=function(t){return fieldOperators[e.value.operator](e.value.pattern,t&&t.url)}),"number"==typeof e.value.interval&&(n=Date.now()-1e3*e.value.interval),"$session"===e.value.interval&&(r=sbjs.get.udata.vst),visit.count(t,n,r).then((function(e){return e}))},push_request_unavailable:function(){return!(window.PushManager&&"default"===Notification.permission)},productId:function(){return pageDataPromise.then((function(e){return e&&e.product&&e.product.id}))},productName:function(){return pageDataPromise.then((function(e){return e&&e.product&&e.product.name}))},productCategoryId:function(){return pageDataPromise.then((function(e){return e&&e.product&&e.product.categoryId}))},productBrandName:function(){return pageDataPromise.then((function(e){return e&&e.product&&e.product.brand}))},productPrice:function(){return pageDataPromise.then((function(e){return e&&e.product&&e.product.price}))},productPriceWithDiscount:function(){return pageDataPromise.then((function(e){return e&&e.product&&e.product.priceWithDiscount}))},productDiscount:function(){return pageDataPromise.then((function(e){return e&&e.product?e.product.price>e.product.priceWithDiscount?100*(e.product.price-e.product.priceWithDiscount)/e.product.price:0:NaN}))},categoryId:function(){return pageDataPromise.then((function(e){return e&&e.category&&e.category.id}))}},conditionMappers={time:function(e){var t=e.match(/(\d\d)\:(\d\d)\:(\d\d)/);return serverTsProvider.get().then((function(e){var n=new Date(e);return n.setHours(t[1],t[2],t[3]),n}))},time_utc:function(e){var t=e.match(/(\d\d)\:(\d\d)\:(\d\d)([+-])(\d\d)\:(\d\d)/);return serverTsProvider.get().then((function(e){var n=new Date(e);return t[5]&&t[6]?"+"===t[4]?(n.setUTCHours(t[1]-t[5],t[2]-t[6],t[3]),n):(n.setUTCHours(t[1]+t[5],t[2]+t[6],t[3]),n):(n.setUTCHours(t[1],t[2],t[3]),n)}))},datetime:function(e){var t=(new Date).getTimezoneOffset(),n=t<0?"+":"-",r=pad(Math.abs(t)%60,2),i=pad(Math.floor(Math.abs(t)/60),2),o=e.replace(/([+-]\d\d:\d\d|Z)$/,n+i+":"+r);return new Date(o)},datetime_utc:function(e){return new Date(e)},google_optimize:function(e){return e.variation},visited_url:function(e){return parseInt(e.visits,10)}};function arrayOperator(e){return function(t,n){return _.isArray(t)?_.some(t,(function(t){return e(t,n)})):e(t,n)}}var fieldOperators={$in:function(e,t){return _.contains(e,t)},$nin:function(e,t){return!_.contains(e,t)},$in_contains:function(e,t){return arrayOperator(fieldOperators.$contains)(e,t)},$in_startsWith:function(e,t){return arrayOperator(fieldOperators.$startsWith)(e,t)},$in_endsWith:function(e,t){return arrayOperator(fieldOperators.$endsWith)(e,t)},$in_regexp:function(e,t){return arrayOperator(fieldOperators.$regexp)(e,t)},$contains:function(e,t){var n=""+e;return 0===n.length||-1!==(""+t).indexOf(n)},$exclude:function(e,t){return!fieldOperators.$contains(e,t)},$startsWith:function(e,t){var n=""+e;return 0===n.length||0===(""+t).indexOf(n)},$endsWith:function(e,t){var n=""+t,r=""+e;return 0===r.length||n.length>=r.length&&n.indexOf(r)===n.length-r.length},$regexp:function(e,t){return new RegExp(e).test(t)},$not_regexp:function(e,t){return!new RegExp(e).test(t)},$any:function(e,t){return!_.isArray(t)||!_.isEmpty(t)},$none:function(e,t){return _.isArray(t)&&_.isEmpty(t)},$after:function(e,t){return Date.now()-t>=1e3*e.interval},$eq:function(e,t){return e===t},$neq:function(e,t){return e!==t},$gt:function(e,t){return t>e},$lt:function(e,t){return t<e},$gte:function(e,t){return t>=e},$lte:function(e,t){return t<=e},$between:function(e,t){var n=null===e.min?-1/0:e.min,r=null===e.max?1/0:e.max;return t>=n&&t<=r}};function defaultChecker(e,t,n){return void 0===n&&(n=conditionMappers),t[e.field]&&_.contains(allowedOperators[e.field],e.operator)?function(r){var i=n[e.field]?n[e.field](e.value):e.value,o=t[e.field](e);r({result:(0,fieldOperators[e.operator])(i,o),final:!0})}:getAlwaysFalseChecker()}function getAggregatedConditionFilter(e,t,n){if(!e)return n;if(!e.field){if(e.nodes){return getGroupFilter(e,(function(e){return getAggregatedConditionFilter(e,t,n)}))}return n}var r=fieldOperators[e.operator],i=e.value,o=t[e.field];return o?function(e){return r(i,o(e))}:alwaysFalse}function getGroupFilter(e,t){var n=e.nodes.map(t);switch(e.operator){case"$and":return function(e){return _.every(n,(function(t){return t(e)}))};case"$or":return function(e){return _.some(n,(function(t){return t(e)}))};default:return getAlwaysFalseChecker()}}var cartHandlersQueue=[];Dispatcher.on("destroy",(function(){cartHandlersQueue=[]})),window.PopMechanicAddToCart=function(){cartHandlersQueue.forEach((function(e){e()}))};var aggregators={$count:function(e){return function(t){return t.reduce((function(t,n){return e(n)?t+(n.quantity||1):t}),0)}},$countDistinct:function(e){return function(t){for(var n=0,r={},i=0;i<t.length;i++){var o=t[i];e(o)&&!r[o.id]&&(r[o.id]=!0,n++)}return n}},$countNot:function(e){return function(t){return t.reduce((function(t,n){return e(n)?t:t+1}),0)}},$priceSum:function(e){return function(t){return t.reduce((function(t,n){return e(n)?t+(n.priceWithDiscount||n.price)*(n.quantity||1):t}),0)}},$anyOf:function(e){return function(t){return _.some(t,e)}},$noneOf:function(e){return function(t){return!_.some(t,e)}},$every:function(e){return function(t){return _.every(t,e)}}};function baseFilter(e){return!!e&&_.isObject(e)&&_.isFinite(e.price)&&!!e.id}var productFieldValues={productPrice:_.property("price"),productPriceWithDiscount:_.property("priceWithDiscount"),productDiscount:function(e){return e.price>e.priceWithDiscount?(e.price-e.priceWithDiscount)/e.price:0},productId:function(e){return e&&e.id?e.id.toString():""},productName:_.property("name"),productCategoryId:function(e){return e&&e.categoryId?e.categoryId.toString():""},productBrandName:_.property("brand")};function cartChecker(e){if("cart"!==e.field)return getAlwaysFalseChecker();var t=fieldOperators[e.operator]||alwaysFalse;return aggregators[e.aggregator]?function(n){var r=getAggregatedConditionFilter(e.filter,productFieldValues,baseFilter),i=aggregators[e.aggregator](r);function o(){var n=window.PopMechanicCartData;if(!n)return null;var r=i(n.products);return"boolean"==typeof r?r:t(e.value,r)}var a=setInterval((function(){var e=o();null!==e&&(clearInterval(a),n({result:e,final:!1}))}));return cartHandlersQueue.push((function(){setTimeout((function(){var e=o();null!==e&&n({result:e,final:!1})}),1e3)})),function(){clearInterval(a)}}:getAlwaysFalseChecker()}function timedChecker(e,t,n){return void 0===n&&(n=conditionMappers),t[e.field]&&_.contains(allowedOperators[e.field],e.operator)?function(r){var i=t[e.field](e),o=n[e.field]?n[e.field](e.value):e.value,a=fieldOperators[e.operator];function s(){var n=t[e.field](e);Promise.all([Promise.resolve(o),Promise.resolve(n)]).then((function(e){var t=a(e[0],e[1]);r({result:t,final:!1})}))}var c=setInterval(s,3e5);return"object"==typeof o&&"function"==typeof o.then||"object"==typeof i&&"function"==typeof i.then?(s(),null):function(){clearInterval(c)}}:getAlwaysFalseChecker()}function domElementChecker(e){if("$exists"!==e.operator&&"$not_exists"!==e.operator)return getAlwaysFalseChecker();var t=-1!==(""+e.value).indexOf(":visible"),n=(""+e.value).replace(/:visible/g,"");return function(r){var i=setInterval((function(){var i=cash(n);t&&(i=i.filterVisible()),"$exists"===e.operator&&r({result:i.length>0,final:!1}),"$not_exists"===e.operator&&r({result:0===i.length,final:!1})}),1e3),o=function(){clearInterval(i),Dispatcher.off("destroy",o)};return Dispatcher.on("destroy",o),o}}function jsChecker(e){if(!_.contains(allowedOperators[e.field],e.operator))return getAlwaysFalseChecker();try{var t=new Function(e.value)}catch(e){return getAlwaysFalseChecker()}return function(e){var n=null;try{n=t()}catch(t){return console.error("$exec error",t),void e({result:!1,final:!0})}Promise.resolve(n).then((function(t){e({result:t,final:!0})})).catch((function(){e({result:!1,final:!0})}))}}var sessionFunctions={form_seen:Session.getLastShown,form_completed:Session.getCompleted,form_uncompleted:Session.getUncompleted};function isTrueOrNull(e){return e||null===e}function getAnyValue(e){var t=(0,sessionFunctions[e.field])();return"$never"===e.operator?null===t:"form_seen"===e.field&&null===t||null!==t&&Date.now()-t>=1e3*e.value.interval}function getArrayValue(e){var t=sessionFunctions[e.field],n=e.value.forms,r=1e3*e.value.interval,i=Date.now(),o=_.chain(n).map(t).map((function(e){return null===e?null:i-e>=r})).value();return"$never"===e.operator?_.every(o,_.isNull):"form_seen"===e.field?_.every(o,isTrueOrNull):0!==o.length&&_.every(o)}function formEventsChecker(e){if(!sessionFunctions.hasOwnProperty(e.field))return getAlwaysFalseChecker();if("$after"!==e.operator&&"$never"!==e.operator)return getAlwaysFalseChecker();var t=e.value.forms;return"$any"===t?function(t){var n=setInterval((function(){var n=getAnyValue(e);t({result:n,final:!1})}),1e3);return function(){clearInterval(n)}}:_.isArray(t)?function(t){var n=setInterval((function(){var n=getArrayValue(e);t({result:n,final:!1})}),1e3);return function(){clearInterval(n)}}:getAlwaysFalseChecker()}var SPEEDTEST="https://personalization-speedtest-stable.mindbox.ru";function trackerStub(){}function reportMindboxError(e,t,n){var r=window.PopMechanic.client;(new Image).src=SPEEDTEST+"/mb-error?client="+r+"&form="+e+"&op="+t+"&status="+n+"&_="+ +Date.now()}function getErrorReporter(e,t){return function(n){reportMindboxError(e,t,n.statusCode||0)}}var mindboxPromise=getIntegrationPromise("mindbox",void 0,100,2e3,4),mindboxInitializedPromise=getIntegrationPromise("mindboxInitialized",!0),mindboxBatchedModulesInitializedPromise=getIntegrationPromise("mindboxBatchedModulesInitialized",!0),mindboxTrackerPromiseOrNull=Promise.all([mindboxPromise,mindboxInitializedPromise,mindboxBatchedModulesInitializedPromise]).then((function(e){return e[0]})),mindboxTrackerPromise=Promise.all([mindboxPromise,mindboxInitializedPromise,mindboxBatchedModulesInitializedPromise]).then((function(e){var t=e[0];return"function"!=typeof t?trackerStub:t})).catch((function(){return trackerStub})),NO_MINDBOX_TRACKER_TYPE="NoMindboxTracker",onPageDataChange=function(e){mindboxTrackerPromiseOrNull.then((function(){if(!window.mindbox)return{type:NO_MINDBOX_TRACKER_TYPE};window.mindbox("personalization.invokeWithPageData",e),window.mindbox("personalization.registerOnPageChangeCallback",e)}))},getMindboxPageDataPromise=function(){return new Promise((function(e,t){onPageDataChange((function(n){n&&(n.type===NO_MINDBOX_TRACKER_TYPE&&t(n),e(n))}))}))},getCart=function(){return getMindboxPageDataPromise().then((function(e){return e.cart||[]})).catch((function(){return[]}))},getMindboxKnownPageDataPromise=function(){return new Promise((function(e,t){onPageDataChange((function(n){n&&(n.type===NO_MINDBOX_TRACKER_TYPE&&t(n),"unknown"!==n.type&&e(n))}))}))},getMindboxKnownPageDataPromiseOrNull=function(){return new Promise((function(e){getMindboxKnownPageDataPromise().then(e).catch((function(){e(null)}))}))};function getMindboxIdsExternalSystemName(e){return _.keys(e)[0]||null}function getMindboxIdsExternalId(e){var t=getMindboxIdsExternalSystemName(e);return t?e[t].toString():""}function mindboxIdsIsEqual(e,t){return _.chain(e).keys().some((function(n){return(t[n]&&t[n].toString())===e[n].toString()})).value()}function productItemIsEqual(e,t){return e.product&&t.product?mindboxIdsIsEqual(e.product.ids,t.product.ids):!(!e.productGroup||!t.productGroup)&&mindboxIdsIsEqual(e.productGroup.ids,t.productGroup.ids)}function getIdsFromProductItem(e){return e.product?e.product.ids:e.productGroup?e.productGroup.ids:null}var isValidProductItem=function(e){if(!e)return!1;var t=e.product||e.productGroup;return!!t&&!(!t||!t.ids||_.isEmpty(t.ids))};function getProductItemFromPageData(e){if(!e)return null;var t=e.product?_.pick(e,"product"):e.productGroup?_.pick(e,"productGroup"):null;return isValidProductItem(t)?t:null}function Batch(e){this._successHandlers=[],this._errorHandlers=[],this._runningTimeout=500,this._fetchData=e,this.items=[],this.isRunning=!1}function Batcher(e){this._batchRunningTimeout=500,this._fetchData=e,this._batches=[]}function mbClientSegmentationsSync(e){return new Promise((function(t,n){mindboxTrackerPromiseOrNull.then((function(){window.mindbox||n({type:"NoMindboxTracker"});var r=_.chain(e).map(_.property("segmentationId")).uniq().map((function(e){return{ids:{externalId:e}}})).value();r.length?window.mindbox("sync",{operation:e[0].operation,data:{segmentations:r},onSuccess:function(e){t({checkedSegmentations:r,resultSegmentations:e.customerSegmentations})},onError:n}):t({checkedSegmentations:[],resultSegmentations:[]})}))}))}Batch.prototype.addItem=function(e){var t=this;return new Promise((function(n,r){var i=t;i.items.push(e),i._successHandlers.push(n),i._errorHandlers.push(r)}))},Batch.prototype.removeItem=function(e){this.items=_.filter(this.items,(function(t){return t.id!==e}))},Batch.prototype.run=function(){var e=this;return e.isRunning=!0,e._fetchData(e.items).then((function(t){e.isRunning=!1,_.forEach(e._successHandlers,(function(e){return e(t)}))})).catch((function(t){e.isRunning=!1,_.forEach(e._errorHandlers,(function(e){return e(t)}))}))},Batcher.prototype.addItem=function(e){var t=this,n=t._getIsNotRunningBatch();return n||(n=new Batch(t._fetchData),t._batches.push(n),setTimeout((function(){n&&n.run().then((function(){t._removeBatch(n)}))}),t._batchRunningTimeout)),n.addItem(e)},Batcher.prototype._getIsNotRunningBatch=function(){return _.find(this._batches,(function(e){return!e.isRunning}))},Batcher.prototype._removeBatch=function(e){this._batches=_.filter(this._batches,(function(t){return e!==t}))},Batcher.prototype.removeItem=function(e){this._batches=_.forEach(this._batches,(function(t){t.removeItem(e)}))},Batcher.prototype.removeItems=function(e){this._batches=_.forEach(this._batches,(function(t){_.forEach(e,(function(e){return t.removeItem(e)}))}))};var mbClientSegmentationBatcher=new Batcher(mbClientSegmentationsSync);function mbClientSegmentationFetch(e){var t=null;return{promise:new Promise((function(n,r){return t=n,mbClientSegmentationBatcher.addItem({id:e.id,segmentationId:e.segmentationId,operation:e.operation}).then((function(t){return{hasActuallyBeenRequested:_.any(t.checkedSegmentations,(function(t){return t.ids.externalId===e.segmentationId})),customerSegmentation:_.find(t.resultSegmentations,(function(t){return t.segmentation.ids.externalId===e.segmentationId}))}})).then(n).catch(r)})),cancel:function(){t&&t({hasActuallyBeenRequested:!1}),mbClientSegmentationBatcher.removeItem(e.id)}}}var PageStorage=function(e){var t=this;void 0===e&&(e=Dispatcher),this._cache={},e.on("destroy",(function(){t._clear()}))};PageStorage.prototype._clear=function(){this._cache={}},PageStorage.prototype.getItem=function(e){return this._cache[e]},PageStorage.prototype.setItem=function(e,t){this._cache[e]=t};var pageStorage=new PageStorage,cacheForMs=3e5;function mindboxSegmentChecker(e){return"mindbox_segment"!==e.field||"$check"!==e.operator||"object"!=typeof e.value?getAlwaysFalseChecker():function(t,n){var r=n.id,i=e.value.operation,o="string"==typeof e.value.segmentation?e.value.segmentation:e.value.segmentation.externalId,a=e.value.inSegment,s=e.value.inSegmentByDefault,c="popmechanic-mindbox."+o;if(pageStorage.getItem(c))try{var u=pageStorage.getItem(c);if(Date.now()-u.ts<cacheForMs){if(a)return t({result:u.inSegmentation,final:!0});if(u.inSegmentation)return t({result:!1,final:!0})}}catch(e){}var l=mbClientSegmentationFetch({id:r+"."+e.id,segmentationId:o,operation:i});return l.promise.then((function(e){var n=!(!e.customerSegmentation||!e.customerSegmentation.segment);e.hasActuallyBeenRequested&&pageStorage.setItem(c,{ts:Date.now(),inSegmentation:n}),t({result:n===a,final:!0})})).catch((function(e){"NoMindboxTracker"!==e.type&&reportMindboxError(r,i,e.status),t({result:s===a,final:!0})})),Dispatcher.on("destroy",(function(){l.cancel()})),window.PopMechanic.customs.mindboxDeviceUUID||t({result:s===a,final:!1}),function(){l.cancel()}}}function promiseChecker(e,t,n){return void 0===n&&(n=conditionMappers),t[e.field]&&_.contains(allowedOperators[e.field],e.operator)?function(r){var i=Promise.resolve(n[e.field]?n[e.field](e.value):e.value),o=Promise.resolve(t[e.field](e)),a=fieldOperators[e.operator];return Promise.all([i,o]).then((function(e){return a(e[0],e[1])})).catch(alwaysFalse).then((function(e){r({result:e,final:!0})})),null}:getAlwaysFalseChecker()}var queueMicrotask$1=window.queueMicrotask;function conditionNotification(e,t,n){if(window.PopMechanic.debugMode)try{window.postMessage({source:CONFIG.CSS_PREFIX+"script",type:"NEW_TARGETING_CONDITION_VALUE_CHANGED",data:{clientId:window.PopMechanic.client,form:e&&e.id,condition:t.source?JSON.parse(t.source):t.id,value:n.result,isFinal:n.final}},"*")}catch(e){}}function stateWrapper(e,t,n){var r={result:!1,final:!1},i=doNothing;function o(i){null===i&&(i={result:!1,final:!1}),"boolean"==typeof i&&(i={result:i,final:!1}),r.final||r.result===i.result&&r.final===i.final||(r.result=i.result,r.final=i.final,queueMicrotask$1((function(){conditionNotification(t,e,r),n(r.result)})))}try{var a=e(o,t);i="function"==typeof a?a:doNothing}catch(e){console.error(e),o({result:!1,final:!0})}return{id:e.id,getValue:function(){return r},cancel:i}}function everyTrue(e){return _.every(e,(function(e){return!!e.result}))}function anyTrue(e){return _.any(e,(function(e){return!!e.result}))}function groupChecker(e,t,n,r,i,o){if(!_.isArray(e.nodes)||"$or"!==e.operator&&"$and"!==e.operator)return getAlwaysFalseChecker();if(0===e.nodes.length)return getAlwaysTrueChecker();var a="$or"===e.operator?anyTrue:everyTrue;return function(s,c){var u=!1,l=e.nodes.map((function(d){return stateWrapper(getFieldChecker(d,t,n,r,i,o),c,(function(){u||(u=!0,queueMicrotask$1((function(){var t=function(){var t=l.map((function(e){return e.getValue()}));if("$or"===e.operator&&_.any(t,isFinalAndTrue))return f(),{result:!0,final:!0};if("$and"===e.operator&&_.any(t,isFinalAndFalse))return f(),{result:!1,final:!0};return{result:a(t),final:_.every(t,"final")}}();s(t),u=!1})))}))})),d=!1;function f(){d||(queueMicrotask$1((function(){d=!1,l.forEach((function(e){e.cancel()}))})),d=!0)}return f}}"function"!=typeof queueMicrotask$1&&(queueMicrotask$1=function(e){Promise.resolve().then(e).catch((function(e){return setTimeout((function(){throw e}))}))});var operatorsMap={$any:"$any",$none:"$none",$in:"$eq",$nin:"$neq",$in_contains:"$contains",$in_startsWith:"$startsWith",$in_endsWith:"$endsWith",$in_regexp:"$regexp"},groupOperatorsMap={$any:"$or",$none:"$or",$in:"$or",$nin:"$and",$in_contains:"$or",$in_startsWith:"$or",$in_endsWith:"$or",$in_regexp:"$or"};function allowArraysInCondition(e){return function(t,n,r){var i;return _.contains(allowedOperators[t.field],t.operator)?_.isArray(t.value)?(i=_.map(t.value,(function(e,n){return{id:t.id+"["+n+"]",field:t.field,value:e,operator:operatorsMap[t.operator]}})),groupChecker({id:t.id,name:"pageCondition#"+t.id,operator:groupOperatorsMap[t.operator],nodes:i},n,r)):e(t,n,r):getAlwaysFalseChecker()}}var operators={$exists:function(e,t){var n=e.segment;return"$any"===n?!!t:"$none"===n?!t:n.externalId===t},$not_exists:function(e,t){var n=e.segment;return"$any"===n?!t:"$none"===n?!!t:n.externalId!==t}};function getMindboxProductItemSegmentChecker(e){return function(t,n,r,i){return operators[t.operator]?function(n,r){var o=e(t.id+"."+r.id,i,t.value.segmentation.externalId);return o.promise.then((function(e){return operators[t.operator](t.value,e)})).catch(alwaysFalse).then((function(e){n({result:e,final:!0})})),function(){o.cancel&&o.cancel()}}:getAlwaysFalseChecker()}}var productItemSegmentsCache={_segments:[],get:function(e,t){return _.find(this._segments,(function(n){return n.segmentationId===t&&productItemIsEqual(n.productItem,e)}))},set:function(e){var t=e.productItem,n=e.segmentationId,r=e.segmentId,i=e.ts,o=_.filter(this._segments,(function(e){return!(e.segmentationId===n&&productItemIsEqual(e.productItem,t))}));o.push({productItem:t,segmentationId:n,segmentId:r,ts:i}),this._segments=o},clear:function(){this._segments=[]}};function normalizeRequestProductItem(e){return _.mapObject(e,(function(e){return{ids:_.mapObject(e.ids,(function(e){return _.isNull(e)||_.isUndefined(e)?e:e.toString()}))}}))}Dispatcher.on("destroy",(function(){productItemSegmentsCache.clear()}));var productItemSegmentationsBatcher={_initDelay:200,_interval:2e3,_items:[],_batches:[],_isRunning:!1,addItem:function(e){productItemSegmentationsBatcher._items.push(e),productItemSegmentationsBatcher._isRunning||(productItemSegmentationsBatcher._isRunning=!0,setTimeout((function(){productItemSegmentationsBatcher._run()}),productItemSegmentationsBatcher._initDelay))},cancelItem:function(e){productItemSegmentationsBatcher._items=_.filter(productItemSegmentationsBatcher._items,(function(t){return t.id!==e}))},_hasNotProcessedProductItemSegmentation:function(e){return!_.some(productItemSegmentationsBatcher._batches,(function(t){return _.some(t,(function(t){return productItemSegmentationIsEqual(e,t)}))}))},_getNotProcessedItems:function(){return _.filter(productItemSegmentationsBatcher._items,(function(e){return productItemSegmentationsBatcher._hasNotProcessedProductItemSegmentation(e.productItemSegmentation)}))},_hasNotProcessedItems:function(){return _.some(productItemSegmentationsBatcher._items,(function(e){return productItemSegmentationsBatcher._hasNotProcessedProductItemSegmentation(e.productItemSegmentation)}))},_run:function(){productItemSegmentationsBatcher._isRunning=!0;var e=[],t=[],n=[];if(_.forEach(productItemSegmentationsBatcher._getNotProcessedItems(),(function(r){var i=_.find(e,(function(e){return productItemIsEqual(e,r.productItemSegmentation.productItem)})),o=_.find(t,(function(e){return e.ids.externalId==r.productItemSegmentation.segmentationId})),a=!i&&e.length<50,s=!o&&t.length<10;(a||i)&&(s||o)&&(a&&e.push(normalizeRequestProductItem(r.productItemSegmentation.productItem)),s&&t.push({ids:{externalId:r.productItemSegmentation.segmentationId}}),n.push(r.productItemSegmentation))})),n.length){var r=[],i=[];_.forEach(e,(function(e){e.product&&r.push(e.product),e.productGroup&&i.push(e.productGroup)})),productItemSegmentationsBatcher._batches.push(n),window.mindbox("helpers.checkProductSegments",{products:r,productGroups:i,segmentations:t,onSuccess:function(r){var i=buildResponse(e,t,r);productItemSegmentation.remove((function(e){return!e.productItem||!!_.find(i,(function(t){return productItemSegmentationIsEqual(e,t)}))})).then((function(){return productItemSegmentation.push(i)}),(function(){return productItemSegmentation.push(i)})),_.forEach(n,(function(e,t){for(var n=productItemSegmentationsBatcher._items.length-1,r=function(){var r=productItemSegmentationsBatcher._items[n];if(productItemSegmentationIsEqual(e,r.productItemSegmentation)){var o=_.find(i,(function(e){return productItemSegmentationIsEqual(e,r.productItemSegmentation)}));r.onSuccess(o),productItemSegmentationsBatcher._items.splice(n,1)}productItemSegmentationsBatcher._batches.splice(t,1),n-=1};n>=0;)r()})),productItemSegmentationsBatcher._batches=_.filter(productItemSegmentationsBatcher._batches,(function(e){return!!e.length}))}})}productItemSegmentationsBatcher._hasNotProcessedItems()?setTimeout((function(){productItemSegmentationsBatcher._run()}),productItemSegmentationsBatcher._interval):productItemSegmentationsBatcher._isRunning=!1}};function buildResponse(e,t,n){var r=+Date.now();return e.reduce((function(e,i){var o=n.find((function(e){return productItemIsEqual(e,i)}))||{productItem:i,segmentations:[]};return t.forEach((function(t){var n=o.segmentations.find((function(e){return e.ids.externalId===t.ids.externalId}));e.push({productItem:i,segmentationId:t.ids.externalId,segmentId:n&&n.segment&&(n.segment.externalId||n.segment.ids&&n.segment.ids.externalId)||null,ts:r})})),e}),[])}function productItemSegmentationIsEqual(e,t){return productItemIsEqual(e.productItem,t.productItem)&&e.segmentationId===t.segmentationId}var mbProductItemSegmentationsFetch=function(e){var t=_.map(e.productItemSegmentations,(function(t,n){var r=null,i=new Promise((function(e){r=e}));return{id:e.id+"["+n+"]",productItemSegmentation:t,onSuccess:r,promise:i}}));return{promise:new Promise((function(e){_.forEach(t,(function(e){return productItemSegmentationsBatcher.addItem(e)})),Promise.all(_.map(t,(function(e){return e.promise}))).then(e)})),cancel:function(){_.forEach(t,(function(e,t){productItemSegmentationsBatcher.cancelItem(e.id+"["+t+"]")}))}}},PRODUCT_SEGMENT_CACHE_EXPIRY_TIMEOUT=864e5,getSegmentId$1=function(e,t,n){var r={promise:Promise.resolve(null),cancel:null},i=productItemSegmentsCache.get(t,n);return void 0!==i&&+Date.now()-i.ts<PRODUCT_SEGMENT_CACHE_EXPIRY_TIMEOUT?(r.promise=Promise.resolve(i.segmentId),r):(r.promise=productItemSegmentation.find((function(e){return productItemIsEqual(e.productItem,t)&&e.segmentationId===n}),+Date.now()-PRODUCT_SEGMENT_CACHE_EXPIRY_TIMEOUT).then((function(i){if(i)return i.segmentId;var o=mbProductItemSegmentationsFetch({id:e,productItemSegmentations:[{productItem:t,segmentationId:n}]});return r.cancel=o.cancel,o.promise.then((function(e){var r=e[0],i=r?r.segmentId:null;return productItemSegmentsCache.set({productItem:t,segmentationId:n,segmentId:i,ts:r.ts}),i}))})),r)},mindboxProductAggregatedCondition$1={aggregators:{$exists:function(e,t){getMindboxKnownPageDataPromise().then((function(n){var r=getProductItemFromPageData(n);if(r)return t(r).then(e);e({result:!1,final:!0})})).catch((function(t){"NoMindboxTracker"===t.type&&e({result:!1,final:!0})}))},$not_exists:function(e,t){getMindboxKnownPageDataPromise().then((function(n){var r=getProductItemFromPageData(n);if(r)return t(r).then((function(t){e({result:!t.result,final:t.final})}));e({result:!0,final:!0})})).catch((function(t){"NoMindboxTracker"===t.type&&e({result:!1,final:!0})}))}},getFieldValues:function(e){return{productId:function(){var t=getIdsFromProductItem(e);return t&&getMindboxIdsExternalId(t)||""}}},fieldCheckers:{mindboxProductSegment:getMindboxProductItemSegmentChecker(getSegmentId$1)}},setPopMechanicVisitIsCompleted,popMechanicVisitIsCompletedPromise=new Promise((function(e){setPopMechanicVisitIsCompleted=e})),setMindboxVisitIsCompleted,mindboxVisitIsCompletedPromise=new Promise((function(e){setMindboxVisitIsCompleted=e}));function reportVisit(e){visit.push(e).then((function(e){if(!e)return Promise.reject();pageDataPromise.then((function(t){return t?visit.enrich(e,{pagetype:t.type,product:t.product,category:t.category}):Promise.reject()})).then((function(){return setPopMechanicVisitIsCompleted()}),(function(){return setPopMechanicVisitIsCompleted()})),getMindboxKnownPageDataPromiseOrNull().then((function(t){return t?visit.enrich(e,{productItem:getProductItemFromPageData(t),categoryIds:t.category?t.category.ids:null}):Promise.reject()})).then((function(){return setMindboxVisitIsCompleted()}),(function(){return setMindboxVisitIsCompleted()}))})).catch((function(e){setPopMechanicVisitIsCompleted(),setMindboxVisitIsCompleted(),defaultDebug.log(e)}))}function waitPromisesOrDelay(e,t){void 0===e&&(e=[]),void 0===t&&(t=2e3);var n=new Promise((function(e){setTimeout(e,t)}));return Promise.race([Promise.all(e),n])}function getProductItemFromVisit_LEGACY(e){var t=e.productItem||e.productIds&&{product:{ids:e.productIds}}||e.mindboxPageData&&e.mindboxPageData.product&&{product:{ids:e.mindboxPageData.product.ids}}||null;return isValidProductItem(t)?t:null}var getNLatestProductItemsNotQueued=function(e){return void 0===e&&(e=10),db?new Promise((function(t){var n=[];db.transaction(HISTORY_STORE_ID).objectStore(HISTORY_STORE_ID).openCursor(null,["prev"]).onsuccess=function(r){var i=r.target.result;if(i){var o=getProductItemFromVisit_LEGACY(i.value);if(o)!_.find(n,(function(e){return productItemIsEqual(o,e)}))&&n.push(o);n.length>=e&&t(n),i.continue()}else t(n)}})):Promise.reject()},getNLatestProductItems=enqueued(getNLatestProductItemsNotQueued),visitIsCompletedPromise=waitPromisesOrDelay([getMindboxKnownPageDataPromiseOrNull()]),lastProductItemsCache={isInitialized:!1,items:[]},PRODUCT_ITEM_SEGMENT_CACHE_EXPIRY_TIMEOUT=864e5;Dispatcher.on("destroy",(function(){lastProductItemsCache={isInitialized:!1,items:[]}}));var cacheProductItemSegmentations=function(e){underscore.exports.forEach(e,(function(e){productItemSegmentsCache.set({productItem:e.productItem,segmentationId:e.segmentationId,segmentId:e.segmentId,ts:e.ts})}))},getUncachedProductItems=function(e,t){return underscore.exports.filter(e,(function(e){var n=productItemSegmentsCache.get(e,t);return!(n&&+Date.now()-n.ts<PRODUCT_ITEM_SEGMENT_CACHE_EXPIRY_TIMEOUT)}))},updateLastProductItemsCache=function(){return lastProductItemsCache.isInitialized?Promise.resolve(null):getNLatestProductItems(10).then((function(e){lastProductItemsCache.items=e}))},updateProductItemSegmentationCache=function(e,t,n){var r={promise:Promise.resolve(),cancel:null};return t.length&&(r.promise=productItemSegmentation.filter((function(e){return e.segmentationId===n&&!!underscore.exports.find(t,(function(t){return productItemIsEqual(e.productItem,t)}))}),+Date.now()-PRODUCT_ITEM_SEGMENT_CACHE_EXPIRY_TIMEOUT).then((function(i){var o=underscore.exports.filter(t,(function(e){return!underscore.exports.find(i,(function(t){return productItemIsEqual(e,t.productItem)}))}));if(cacheProductItemSegmentations(i),o.length){var a=mbProductItemSegmentationsFetch({id:e,productItemSegmentations:underscore.exports.map(o,(function(e){return{productItem:e,segmentationId:n}}))});return r.cancel=a.cancel,a.promise.then(cacheProductItemSegmentations)}return Promise.resolve(null)}))),r},getSegmentId=function(e,t,n){var r={promise:Promise.resolve(null),cancel:null};return r.promise=visitIsCompletedPromise.then(updateLastProductItemsCache).then((function(){var i=getUncachedProductItems(lastProductItemsCache.items,n);if(i.length){var o=updateProductItemSegmentationCache(e,i,n);return r.cancel=o.cancel,o.promise.then((function(){return productItemSegmentsCache.get(t,n).segmentId}))}return productItemSegmentsCache.get(t,n).segmentId})),r},mindboxProductAggregatedCondition={aggregators:{$exists:function(e,t,n,r){var i=getProductItemFromVisit_LEGACY(r);i?t(i).then(e):e({result:!1,final:!0})},$not_exists:function(e,t,n,r){var i=getProductItemFromVisit_LEGACY(r);i?t(i).then((function(t){e({result:!t.result,final:t.final})})):e({result:!0,final:!0})}},getFieldValues:function(e){return{productId:function(){var t=getIdsFromProductItem(e);return t&&getMindboxIdsExternalId(t)||""}}},fieldCheckers:{mindboxProductSegment:getMindboxProductItemSegmentChecker(getSegmentId)}};function mindboxCategoryIdChecker(e,t,n,r){return r&&"$in"===e.operator?function(t){return t({result:_.some(e.value,(function(e){var t={};return t[e.externalSystemName]=e.externalId,mindboxIdsIsEqual(t,r)})),final:!0}),null}:getAlwaysFalseChecker()}var mindboxCategoryAggregatedCondition$1={aggregators:{$exists:function(e,t,n,r){var i=r.categoryIds||r.mindboxPageData&&r.mindboxPageData.category&&r.mindboxPageData.category.ids;i?t(i).then(e):e({result:!1,final:!0})},$not_exists:function(e,t,n,r){var i=r.categoryIds||r.mindboxPageData&&r.mindboxPageData.category&&r.mindboxPageData.category.ids;i?t(i).then((function(t){e({result:!t.result,final:t.final})})):e({result:!0,final:!0})}},fieldCheckers:{mindboxCategoryId:mindboxCategoryIdChecker},getFieldValues:function(e){return{categoryId:function(){return getMindboxIdsExternalId(e)||""}}}},visitIsCompleted=function(){return waitPromisesOrDelay([popMechanicVisitIsCompletedPromise,mindboxVisitIsCompletedPromise])},visitedPagesAggregatedCondition={aggregators:{$count:function(e,t,n){visitIsCompleted().then((function(){return visit.count((function(e){return t(e).then(_.property("result"))})).catch((function(){return _.constant(0)})).then((function(t){var r=fieldOperators[n.operator]||alwaysFalse;e({result:r(n.value,t),final:!0})}))}))},$anyOf:function(e,t){visitIsCompleted().then((function(){return visit.find((function(e){return t(e).then(_.property("result"))})).catch(_.constant(null)).then((function(t){e({result:!!t,final:!0})}))}))},$noneOf:function(e,t){visitIsCompleted().then((function(){return visit.find((function(e){return t(e).then((function(e){return e.result}))})).catch(_.constant(null)).then((function(t){e({result:!t,final:!0})}))}))}},getFieldValues:function(e){return{url:function(){return e.url},productId:function(){return e.product&&e.product.id?e.product.id.toString():""},productName:function(){return e.product&&e.product.name},productCategoryId:function(){return e.product&&e.product.categoryId?e.product.categoryId.toString():""},productBrandName:function(){return e.product&&e.product.brand},productPrice:function(){return e.product&&e.product.price},productPriceWithDiscount:function(){return e.product&&e.product.priceWithDiscount},productDiscount:function(){return e.product&&e.product.price>e.product.priceWithDiscount?100*(e.product.price-e.product.priceWithDiscount)/e.product.price:0},categoryId:function(){return e.category&&e.category.id?e.category.id.toString():""},time_passed:function(t){if("$current_session"===t.value)return e.vst;var n=Date.now();return Math.floor((n-e.ts)/1e3)}}},conditionMappers:{productId:function(e){return e?e.toString():""},productCategoryId:function(e){return e?e.toString():""},categoryId:function(e){return e?e.toString():""},url:function(e){return"$current_url"===e?location.href:e},time_passed:function(e){return"$current_session"===e?sbjs.get.udata.vst:e}},aggregatedConditions:{mindboxProduct:mindboxProductAggregatedCondition,mindboxCategory:mindboxCategoryAggregatedCondition$1}},mindboxCategoryAggregatedCondition={aggregators:{$exists:function(e,t){return getMindboxKnownPageDataPromise().then((function(n){n&&n.category?t(n.category.ids).then(e):e({result:!1,final:!0})}))},$not_exists:function(e,t){return getMindboxKnownPageDataPromise().then((function(n){n&&n.category?t(n.category.ids).then((function(t){e({result:!t.result,final:t.final})})):e({result:!0,final:!0})}))}},fieldCheckers:{mindboxCategoryId:mindboxCategoryIdChecker},getFieldValues:function(e){return{categoryId:function(){return getMindboxIdsExternalId(e)||""}}}};function getProductItem(e){return e.product?_.pick(e,"product"):e.productGroup?_.pick(e,"productGroup"):null}var onCartChange=function(e,t,n){var r=null,i=_.debounce((function(i){var o=_.uniqueId(e);r=o;t(i,(function(e){r===o&&n(e)}))}),2e3);onPageDataChange((function(e){e&&(e.type===NO_MINDBOX_TRACKER_TYPE&&i(null),e.cart&&i(e.cart))}))};function groupHasCondition(e){return _.some(e.nodes,(function(e){return!!e.field||groupHasCondition(e)}))}var mindboxCartAggregatedCondition={aggregators:{$count:function(e,t,n){onCartChange(n.id,(function(e,r){e||r({result:!1,final:!1});var i=fieldOperators[n.operator]||alwaysFalse;if(groupHasCondition(n.filter)){var o=0,a=[];_.forEach(e,(function(e){a.push(t(getProductItem(e)).then((function(t){t.result&&(o+=e.count)})))})),Promise.all(a).then((function(){r({result:i(n.value,o),final:!1})}))}else{var s=_.reduce(e,(function(e,t){return e+t.count}),0);r({result:i(n.value,s),final:!1})}}),e)},$countDistinct:function(e,t,n){onCartChange(n.id,(function(e,r){e||r({result:!1,final:!1});var i=fieldOperators[n.operator]||alwaysFalse;if(groupHasCondition(n.filter)){var o=0,a=[];_.forEach(e,(function(e){a.push(t(getProductItem(e)).then((function(e){e.result&&o++})))})),Promise.all(a).then((function(){r({result:i(n.value,o),final:!1})}))}else{var s=_.reduce(e,(function(e){return e+1}),0);r({result:i(n.value,s),final:!1})}}),e)},$priceSum:function(e,t,n){onCartChange(n.id,(function(e,r){e||r({result:!1,final:!1});var i=fieldOperators[n.operator]||alwaysFalse;if(groupHasCondition(n.filter)){var o=0,a=[];_.forEach(e,(function(e){a.push(t(getProductItem(e)).then((function(t){t.result&&(o+=e.priceOfLine||e.pricePerItem*e.count||0)})))})),Promise.all(a).then((function(){r({result:i(n.value,o),final:!1})}))}else{var s=_.reduce(e,(function(e,t){return e+=t.priceOfLine||t.pricePerItem*t.count||0}),0);r({result:i(n.value,s),final:!1})}}),e)},$anyOf:function(e,t,n){onCartChange(n.id,(function(e,r){if(e||r({result:!1,final:!1}),!groupHasCondition(n.filter)&&e.length)r({result:!0,final:!1});else{var i=[];_.forEach(e,(function(e){i.push(t(getProductItem(e)).then((function(e){return e.result?Promise.reject():Promise.resolve()})))})),Promise.all(i).then((function(){r({result:!1,final:!1})})).catch((function(){r({result:!0,final:!1})}))}}),e)},$noneOf:function(e,t,n){onCartChange(n.id,(function(e,r){if(e||r({result:!1,final:!1}),groupHasCondition(n.filter)||e.length){var i=[];_.forEach(e,(function(e){return i.push(t(getProductItem(e)).then((function(e){return e.result?Promise.reject():Promise.resolve()})))})),Promise.all(i).then((function(){r({result:!0,final:!1})})).catch((function(){r({result:!1,final:!1})}))}else r({result:!0,final:!1})}),e)},$every:function(e,t,n){onCartChange(n.id,(function(e,r){if(e||r({result:!1,final:!1}),groupHasCondition(n.filter)){var i=[];_.forEach(e,(function(e){i.push(t(getProductItem(e)).then((function(e){return e.result?Promise.resolve():Promise.reject()})))})),Promise.all(i).then((function(){r({result:!0,final:!1})})).catch((function(){r({result:!1,final:!1})}))}else r({result:!!e.length,final:!1})}),e)}},fieldCheckers:{mindboxProductSegment:getMindboxProductItemSegmentChecker(getSegmentId$1)}},aggregatedConditions={mindboxProduct:mindboxProductAggregatedCondition$1,mindboxCategory:mindboxCategoryAggregatedCondition,visited_pages:visitedPagesAggregatedCondition,"visited-pages":visitedPagesAggregatedCondition,mindboxCart:mindboxCartAggregatedCondition};function aggregatedConditionChecker(e,t,n){return void 0===t&&(t=aggregatedConditions),function(r,i){var o=t[e.field],a=o.aggregatedConditions;return o.aggregators[e.aggregator]((function(e){queueMicrotask$1((function(){r(e)}))}),(function(t){return new Promise((function(n){var r=stateWrapper(getFieldChecker(e.filter,o.getFieldValues&&o.getFieldValues(t),underscore.exports.extend({},conditionMappers,o.conditionMappers||{}),a,t,o.fieldCheckers),i,(function(){n(r())})).getValue}))}),e,n),null}}var defaultFieldCheckers={default:defaultChecker,cart:cartChecker,datetime:timedChecker,datetime_utc:timedChecker,day_of_week:timedChecker,time:timedChecker,time_utc:timedChecker,dom_element:domElementChecker,js:jsChecker,form_completed:formEventsChecker,form_seen:formEventsChecker,form_uncompleted:formEventsChecker,mindbox_segment:mindboxSegmentChecker,google_optimize:promiseChecker,visited_url:promiseChecker,country:promiseChecker,region:promiseChecker,city:promiseChecker,page:allowArraysInCondition(defaultChecker),productId:allowArraysInCondition(promiseChecker),productName:allowArraysInCondition(promiseChecker),productCategoryId:allowArraysInCondition(promiseChecker),productBrandName:allowArraysInCondition(promiseChecker),productPrice:promiseChecker,productPriceWithDiscount:promiseChecker,productDiscount:promiseChecker,categoryId:allowArraysInCondition(promiseChecker),time_passed:promiseChecker,url:allowArraysInCondition(defaultChecker)};function getFieldChecker(e,t,n,r,i,o){void 0===t&&(t=fieldValues),void 0===n&&(n=conditionMappers),void 0===r&&(r=aggregatedConditions),void 0===i&&(i=void 0),void 0===o&&(o=defaultFieldCheckers);var a=null;return(a=e.hasOwnProperty("nodes")?groupChecker(e,t,n,r,i,o):e.hasOwnProperty("filter")&&underscore.exports.includes(underscore.exports.keys(r),e.field)?aggregatedConditionChecker(e,r,i):o.hasOwnProperty(e.field)?o[e.field](e,t,n,i):defaultFieldCheckers.default(e,t,n,i)).id=e.id,window.PopMechanic.debugMode||(a.source=JSON.stringify(e)),a}function initTargeting(e,t,n){return new Promise((function(r){e||r((function(){return"function"==typeof n&&queueMicrotask((function(){n(!0)})),{result:!0,final:!0}}));var i=stateWrapper(getFieldChecker(e),t,(function(e){"function"==typeof n&&n(e),r(i)})).getValue}))}var promiseCache={};function checkTargeting$1(e,t,n){if(promiseCache.hasOwnProperty(t.id))return promiseCache[t.id];var r=Promise.resolve(initTargeting(e,t,n)).then((function(e){return e().result})).catch((function(e){throw console.error("checkTargeting error:",e),e}));return promiseCache[t.id]=r,r}Dispatcher.on("destroy",(function(){promiseCache={}}));var NewTargeting={init:initTargeting,check:checkTargeting$1};function check(e,t){return e.isEmbedded()||e.isStatic()?checkTargeting(e,t):e.isAlways()?Promise.resolve(!0):checkTargeting(e,t)}function checkTargeting(e,t){return NewTargeting.check(e&&e.newTargeting&&e.newTargeting.filter,e,t)}var Targeting={check:check},AbstractBehavior$1=inherit({__constructor:function(e,t){this.formId=e.form.id,this.onBeforeRenderRejectIsDebuggable=!0,this._dependencies=t,this._device=device$1.mobile()?"mobile":device$1.tablet()?"tablet":"desktop",this._getDeviceSettings=this._getDeviceSettings.bind(this)},_dependencies:{},_device:null,_getContainer:function(e){return e.filter("."+CONFIG.CSS_PREFIX+"js-container")},_getForm:function(e){return this._getContainer(e).find("#"+CONFIG.CSS_PREFIX+"form-"+this.formId)},_filterForm:function(e){return e.filter("#"+CONFIG.CSS_PREFIX+"form-"+this.formId)},_runAnimation:function(e,t,n){e.addClass(CONFIG.CSS_PREFIX+t).addClass(CONFIG.CSS_PREFIX+"animated").addClass(CONFIG.CSS_PREFIX+"fastest"),setTimeout((function(){return e.removeClass(CONFIG.CSS_PREFIX+"animated").removeClass(CONFIG.CSS_PREFIX+"fastest").removeClass(CONFIG.CSS_PREFIX+t),"function"==typeof n&&n()}),CONFIG.ANIMATION_SPEED)},_getDeviceSettings:function(e){return e[this._device]?e[this._device]:e.desktop?e.desktop:e||{}},getSettings:function(){},onTargetingReady:function(){},onBeforeRender:function(){},onRender:function(){},onShow:function(){},onBeforeClose:function(){},onClose:function(){},onSuccess:function(){},onFail:function(){},onInit:function(e){}}),AlwaysBehavior=inherit(AbstractBehavior$1,{}),AbstractConditionedBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e),this.initAt=window.PopMechanic.initAt},onInit:function(e){var t=e.form;cash("body").on("click","[data-"+CONFIG.CSS_PREFIX+'call-form="'+t.id+'"]',(function(){("ignore_targeting"===t.conditions.conditions.only_forced||t.inTargeting)&&e.show(!0)}))},onTargetingReady:function(e){var t=this,n=e.form;n.checkConditions().then((function(n){n&&t.initAt===window.PopMechanic.initAt&&e.show()})).catch((function(e){console.error("conditions error in form#"+n.id,e)}))}}),overlayForms=[],addOverlay=function(e,t){overlayForms=_.union(overlayForms,[{id:e,allowOverlay:t}])},removeOverlay=function(e){var t=overlayForms.find((function(t){return t.id===e}));overlayForms=_.without(overlayForms,t)},isOverlayPresent=function(){return overlayForms.length>0},isOverlayBlocked=function(){return overlayForms.some((function(e){return!e.allowOverlay}))},getRejectMessage=function(e){return"Cannot display form "+e+" because forms: "+overlayForms.map((function(e){return e.id}))+" are already visible"},defaultAnimationsIn$1={top:"fadeInUp",bottom:"fadeInDown",left:"fadeInLeft",right:"fadeInRight"},defaultAnimationsOut$1={top:"fadeOutUp",bottom:"fadeOutDown",left:"fadeOutLeft",right:"fadeOutRight"};function getStyles(e){return"top"===e.position?{top:0,left:0,right:0,"margin-top":e.offset}:"bottom"===e.position?{bottom:0,left:0,right:0,"margin-bottom":e.offset}:"left"===e.position?{left:0,top:0,bottom:0,"margin-left":e.offset}:"right"===e.position?{right:0,top:0,bottom:0,"margin-right":e.offset}:{}}var BannerBehavior=inherit(AbstractConditionedBehavior,{__constructor:function(e){this.__base(e),this.settings=_.defaults({},e.form.settings.behavior_settings.banner,{position:"bottom",allow_overlay:!0,offset:0}),this.settings.animation_in||(this.settings.animation_in=defaultAnimationsIn$1[this.settings.direction]),this.settings.animation_out||(this.settings.animation_out=defaultAnimationsOut$1[this.settings.direction]),this.staticStyles=getStyles(this.settings)},onRender:function(e,t,n){var r=this;return new Promise((function(t,i){if(isOverlayBlocked()||isOverlayPresent()&&!r.settings.allow_overlay)return i(getRejectMessage(r.formId));addOverlay(r.formId,r.settings.allow_overlay);var o=r._filterForm(e),a=cash('<div class="'+CONFIG.CSS_PREFIX+'js-wrapper"></div>');r._$formWrapper=a,n.append(a);var s={display:"block","z-index":100000002,position:"fixed","text-align":"left"};_.extend(s,r.staticStyles),a.css(s),o.css({position:"relative",width:"100%",height:"100%"}),t("OK")}))},onShow:function(e,t){var n=this._getForm(e);this._$formWrapper.append(n),this._runAnimation(n,this.settings.animation_in),n.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))}))},onClose:function(e){var t=this;removeOverlay(t.formId);var n=this._getForm(e);return new Promise((function(r){t._runAnimation(n,t.settings.animation_out,(function(){e.css({position:"static",height:0,"min-height":0}),r()}))}))},onSuccess:function(){},onFail:function(){}}),defaultSettings={on:!1,positions:{mobile:{},tablet:{},desktop:{}},show_before:!0},ButtonBehavior=inherit(AbstractBehavior$1,{onInit:function(e){var t=null,n=null,r=e.form.button_template,i=cash.extend({},e.form.settings.settings,e.form.settings.button_settings),o=e.form.id+".button-hidden",a=_.defaults({},e.form.settings.behavior_settings.button,defaultSettings),s=cash.extend({},i,{desktop:device$1.desktop(),tablet:device$1.tablet(),mobile:device$1.mobile()});if(this.behavior_settings=a,this.form=e.form,a.on){e.form.settings.button_html&&(r.html=e.form.settings.button_html),e.form.settings.button_css&&(r.css=e.form.settings.button_css);try{t=cash(containerizeHtml(_.template(r.html)(s),e.form.id))}catch(e){return}try{n=cash("<style>"+containerizeCss(_.template(r.css)(s),e.form.id)+"</style>")}catch(e){return}var c=_.defaults({zIndex:100000002},this._getDeviceSettings(a.positions));if(t.css(c),t.css({position:"fixed"}),t.hide(),this._$button=t,this._$style=n,this._$button.show=function(){this[0].style.display=""},!Session.get(o))"always"===this.behavior_settings.conditions&&t.show(),getContainer(e.form.id).append(t).append(n),t.on("click",(function(){e.form.report("click"),e.show(!0)})),t.find("[data-popmechanic-close-button]").on("click",(function(e){t.hide(),Session.set(o,!0),e.stopPropagation()}))}},onTargetingReady:function(){var e=this;e.behavior_settings.on&&"targeting"===e.behavior_settings.conditions&&(e.form.inTargeting?e._$button.show():e.form.ignoresTargeting()&&e.form.onTargetingChange((function(t){t?e._$button.show():e._$button.hide()})))},onShow:function(){this.behavior_settings.on&&this._$button.hide()},onClose:function(){this.behavior_settings.on&&this._$button.show()},onSuccess:function(){this.behavior_settings.on&&(this._$button.detach(),this._$style.detach())}}),CopyCodeBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e),this.successText="!"},onShow:function(e,t){try{var n=this;this.$elem=e;var r=e[0].querySelectorAll("[data-"+CONFIG.CSS_PREFIX+"copy]");_.forEach(r,(function(e){e.addEventListener("click",n._getHandleCopy(t))}))}catch(e){}},_getHandleCopy:function(e){var t=this,n=t.successText;return function(r){r.preventDefault();var i=this;try{var o=this.dataset[CONFIG.DATASET_PREFIX+"Copy"],a=t.$elem.find("[data-"+CONFIG.CSS_PREFIX+'copy-source="'+o+'"]').text()||"";if(a=a.trim(),navigator.clipboard)navigator.clipboard.writeText(a.trim()).then((function(){i.innerHTML=n,Dispatcher.trigger("copyCode",{form:e.form})}));else{var s=document.createElement("textarea");s.value=a,s.setAttribute("readonly",""),s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s),s.select(),s.setSelectionRange(0,a.length+1),document.execCommand("copy"),document.body.removeChild(s),i.innerHTML=n,Dispatcher.trigger("copyCode",{form:e.form})}}catch(e){}}}}),embedElement=function(e){var t=e.$element,n=e.$target,r=e.placement,i="#"+t[0].id;switch(r){case"before":var o=n.prev();o&&cash(o).is(i)&&o.remove(),n.before(t);break;case"after":var a=n.next();a&&cash(a).is(i)&&a.remove(),n.after(t);break;case"start":var s=n.children()[0];s&&cash(s).is(i)&&s.remove(),n.prepend(t);break;default:case"end":var c=n.children(),u=n.children()[c.length-1];u&&cash(u).is(i)&&u.remove(),n.append(t)}},EmbeddedBehavior$1=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e);var t=e.form.settings.behavior_settings.embedded||{},n=this._getDeviceSettings(t);this.settings=_.defaults({},n,t,{animation_out:"fadeOut"})},onShow:function(e,t,n){var r=this._getForm(e);embedElement({$element:e,$target:n,placement:t.placement}),r.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))}))},onClose:function(e){var t=this,n=t._getForm(e);return new Promise((function(e){t._runAnimation(n,t.settings.animation_out,(function(){e()}))}))},onSuccess:function(){},onFail:function(){}}),FacebookBehavior=inherit(AbstractBehavior$1,{onRender:function(e,t){return new Promise((function(e){var t=null;t=setInterval((function(){window.FB&&(e(),clearInterval(t))}),100)}))},onShow:function(e,t){var n=e.find("#popmechanic-form-"+t.form.id)[0],r=function(e,n){t.form.report("social-like"),t.success({social:!0,type:t.form.settings.behavior_settings.social.type}),Session.setContactsSent(),FB.Event.unsubscribe("edge.create",r)};FB.XFBML.parse(n),FB.Event.subscribe("edge.create",r)}}),childrenTargetingHandlers={},initListenerOnce,initListener=function(){function e(e,t){var n=t.form;childrenTargetingHandlers[n.id]&&n.inTargeting&&childrenTargetingHandlers[n.id](n)}Dispatcher.on("targeting",e),Dispatcher.on("destroy",(function(){initListenerOnce=_.once(initListener),Dispatcher.off("targeting",e)}))};initListenerOnce=_.once(initListener);var FormContainerBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){var t=this;this.__base(e);var n=this;n.form=e,this.childrenDisplayQueue=[],this.childForms=e.form.childForms;try{this._onChildReady=new Function("form","child","children",e.form.template.on_child_ready)}catch(e){console.error(e),this._onChildReady=_.identity}this.children=this.childForms.map(window.PopMechanic.getModel).filter(_.identity),this.children.filter((function(e){return e.inTargeting})).forEach((function(e){n.childrenDisplayQueue.push((function(){n.onChildReady(e)}))}));for(var r=function(e){var r=t.children[e],i=r.id;childrenTargetingHandlers[i]=function(){n.childrenDisplayQueue.push((function(){n.onChildReady(r)}))}},i=0;i<t.children.length;i++)r(i);initListenerOnce()},onChildReady:function(e){var t=window.PopMechanic.getView(e.id),n=this.children.filter((function(e){return e.inTargeting})).map((function(e){var t=e.id;return window.PopMechanic.getView(t)}));try{this._onChildReady(this.form,t,n)}catch(e){console.error(e)}},onShow:function(){var e=this;setTimeout((function(){for(;e.childrenDisplayQueue.length;){e.childrenDisplayQueue.shift()()}e.childrenDisplayQueue.push=function(e){e()}}),100)}}),FullscreenBehavior=inherit(AbstractConditionedBehavior,{__constructor:function(e){this.__base(e);var t=_.defaults({},e.form.settings.behavior_settings.fullscreen||{show_legal:!0},{allow_overlay:!0});this.showLegal=t.show_legal&&"0"!==t.show_legal,this.allowOverlay=t.allow_overlay},_prepareAnimation:function(e){var t={};t["margin-top"]=-Math.max(window.innerWidth,window.innerHeight),e.css(t)},_runAnimation:function(e,t){var n={"margin-top":0};e.animate(n,t)},onRender:function(e,t){var n=this;return new Promise((function(t,r){if(isOverlayBlocked()||isOverlayPresent()&&!n.allowOverlay)return r(getRejectMessage(n.formId));addOverlay(n.formId,n.allowOverlay);var i=n._filterForm(e);i.css({display:"block","z-index":100000002,position:"absolute",margin:"0",top:0,left:0,bottom:0,right:0}),n._prepareAnimation(i),t("OK")}))},onShow:function(e,t){var n=this._getForm(e),r=this._getContainer(e),i=this;disableScroll(),setTimeout((function(){r.css({position:"fixed",top:0,left:0,right:0,bottom:0,"text-align":"center",height:"auto",overflow:"auto","z-index":1e8}),i.showLegal&&n.find(".js-popmechanic-legal-aux").css({position:"absolute",bottom:"15px",left:"0",right:"0",color:"white",textAlign:"center",display:"block"}),i._runAnimation(n,(function(){n.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))})),cash(document).on("keyup",(function(e){27==e.keyCode&&t.close()}))}))}),10)},onClose:function(e){removeOverlay(this.formId);var t=this._getContainer(e);e.animate({top:"-50%"},(function(){t.css({position:"static",height:0,"min-height":0}),enableScroll()}))},onSuccess:function(){},onFail:function(){}}),HumbleBehavior=inherit(AbstractBehavior$1,{onShow:function(e,t){e.find("[data-"+CONFIG.CSS_PREFIX+"stop]").on("click",(function(){t.form.report("stop"),t.close()}))}}),InfoBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e)},onShow:function(e,t){var n=this,r="#zuck-modal-slider-popmechanic-form-"+t.form.id+"-zuck-container",i="[data-"+CONFIG.CSS_PREFIX+"submit]",o="[data-"+CONFIG.CSS_PREFIX+"link]";cash("body").on("click",r+" "+i+","+r+" "+o,(function(){n._onClick(t)})),e.find(i+", "+o).on("click",(function(){n._onClick(t)}))},_onClick:function(e){e.form.report("follow"),Session.setCompleted(e.form.id),Dispatcher.trigger("lead",{form:e.form,lead:{form:e.form.id}})},onBeforeClose:function(e,t,n){n.showSuccess||(Dispatcher.trigger("cancel",{form:t.form.id}),event.push({type:"info-cancel",form:t.form.id}),Session.setUncompleted(t.form.id))}});function report(e){event.push({type:e.type,vst:getVisit(),ts:Date.now(),form:e.form})}function getDelayCPS(e){if(e.delay)return function(t){setTimeout(t,1e3*parseInt(e.delay,10),!0)}}var STORAGE_KEY=CONFIG.JS_PREFIX+"la",LAST_UPDATE,timeouts=[],lastUpdate={set:function(e){LAST_UPDATE=e;try{sessionStorage[STORAGE_KEY]=e}catch(e){}},get:function(){try{return parseInt(sessionStorage[STORAGE_KEY],10)}catch(e){}return LAST_UPDATE}},handleActivity=_.throttle((function(){lastUpdate.set(Date.now())}),500);function setIdleTimeout(e,t,n){var r={handler:e,delay:t,args:n};return timeouts.push(r),r}function clearIdleTimeout(e){e.handler=_.identity}function handleDestroy(){timeouts=[]}setInterval((function(){if(timeouts.length){var e=Date.now()-lastUpdate.get(),t=timeouts.filter((function(t){return t.delay<=e}));timeouts=timeouts.filter((function(t){return t.delay>e})),t.forEach((function(e){setTimeout((function(){e.handler.apply(this,e.args)}),0)}))}}),500),document.addEventListener("mousemove",handleActivity,!1),document.addEventListener("mousedown",handleActivity,!1),document.addEventListener("keydown",handleActivity,!1),document.addEventListener("touchmove",handleActivity,!1),document.addEventListener("touchstart",handleActivity,!1),document.addEventListener("scroll",handleActivity,!1),handleActivity(),Dispatcher.on("destroy",handleDestroy);var idleTime={setTimeout:setIdleTimeout,clearTimeout:clearIdleTimeout};function getInactiveCPS(e){if(e.inactive)return function(t){try{idleTime.setTimeout(t,1e3*parseInt(e.inactive,10),[!0])}catch(e){console.log(e)}}}function getPagesCPS(e){if(e.pages){var t=parseInt(e.pages,10);return Session.history.length>=t?always(!0):function(e){var n=setInterval((function(){Session.history.length>=t&&(clearInterval(n),e(!0))}),1e3)}}}function getPagesSessionCPS(e){if(e.pages_session){var t=parseInt(e.pages_session,10);return sbjs.get.session.pgs>=t?always(!0):function(e){var n=setInterval((function(){sbjs.get.session.pgs>=t&&(clearInterval(n),e(!0))}),1e3)}}}function getSessionTimeCPS(e){if(e.session_time){var t;try{t=parseInt(sessionStorage[CONFIG.JS_PREFIX+"session-start"],10)}catch(e){}t||(t=Date.now()),sessionStorage[CONFIG.JS_PREFIX+"session-start"]=t;var n=1e3*parseInt(e.session_time,10)-(Date.now()-t);return function(e){setTimeout(e,Math.max(n,0),!0)}}}function getMouseleaveCPS(e){if(e.mouseleave&&"0"!==e.mouseleave)return function(e){var t=_.debounce((function(){e(!1)}),100);cash(document).on("mouseout",(function(t){t.relatedTarget||"INPUT"===t.target.nodeName||e(!0)})),cash(document).on("mouseenter",t),cash(document).on("mousemove",t)}}function getReadCPS(e){if(e.read){var t=parseInt(e.read,10);return function(e){var n=_.debounce((function(){var n=window.pageYOffset,r=cash(document).height()-window.innerHeight;(0===r||n/r*100>t)&&e(!0)}),100);cash(window).scroll(n),cash(document).height()-window.innerHeight>0?window.pageYOffset/cash(document).height()*100>=t&&e(!0):e(!0)}}}function getReturnedCPS(e){if(e.returned&&"0"!==e.returned)return function(e){return sbjs.get.udata.vst>1?e(!0):e(!1)}}function always(e){return function(t){t(e)}}var conditionCPS=[getDelayCPS,getInactiveCPS,getMouseleaveCPS,getPagesCPS,getPagesSessionCPS,getReadCPS,getReturnedCPS,getSessionTimeCPS];function orCombinator(e){return function(t){var n=e.map((function(){return!1})),r=_.any(n);e.forEach((function(e,i){e((function(e){n[i]=e;var o=_.any(n);o!==r&&t(r=o)}))}))}}function andCombinator(e){return function(t){var n=e.map((function(){return!1})),r=_.every(n);e.forEach((function(e,i){e((function(e){n[i]=e;var o=_.every(n);o!==r&&t(r=o)}))}))}}function getConditionsCPS(e,t){if(void 0===e&&(e={}),void 0===t&&(t="or"),e.only_forced)return always(!1);if(e.immediate)return always(!0);var n=conditionCPS.map((function(t){return t(e)})).filter(_.identity);return 0===n.length?always(!0):"and"===t?andCombinator(n):"or"===t?orCombinator(n):void 0}function getConditionsPromise(e,t){var n=getConditionsCPS(e,t),r=!1;return new Promise((function(e){n((function(t){(r=r||t)&&e()}))}))}function getFormContainerId(e){var t=window.PopMechanic.getModel(e);return t?Promise.resolve(t.containerId||null):form.getById(e).then((function(e){return e?e.containerId:null}))}var getLastEvent=event.getLast;function hasInvalidAccountFrequencyBehavior(e){return _.some(e,(function(e){return _.includes(["embedded"],e)}))}function checkForm(e,t){return _.isEmpty(e)||_.every(e,(function(e){return!1===e||null===e}))?Promise.resolve(!0):Promise.resolve().then((function(){return getLastEvent({form:t,type:"show_start"})})).then((function(n){var r,i=getVisit();return r=n?n.ts:+Session.getLastShown(t),(!e.once_lifetime||!n)&&((!e.once_session||!n||n.vst!==i)&&!(e.minimal_timeout&&Date.now()-r<1e3*e.minimal_timeout))})).catch((function(){var n=+Session.getLastShown(t),r=Date.now();return(!e.once_lifetime||!n)&&(!(e.once_session&&r-n<18e5)&&!(e.minimal_timeout&&r-n<1e3*e.minimal_timeout))}))}function accountMinimalTimeoutLastEventFilter(e){return!e.behaviors||!hasInvalidAccountFrequencyBehavior(e.behaviors)}function checkAccountMinimalTimeout(e){return Promise.resolve().then((function(){return getLastEvent({type:"show_start"},accountMinimalTimeoutLastEventFilter)})).then((function(t){var n=t?t.ts:+Session.getLastShown();return Date.now()-n>=e}))}function checkAccount(e,t){return _.isEmpty(e)||_.every(e,_.isNull)?Promise.resolve(!0):getFormContainerId(t).then((function(n){if(n)return!0;var r=getVisit(),i=Date.now(),o=i-864e5,a=i-6048e5,s=i-2592e6,c={day:0,week:0,month:0,session:0},u=[];return event.forEach("ts",IDBKeyRange.lowerBound(s),(function(e){if(!("show_start"!==e.type||e.behaviors&&hasInvalidAccountFrequencyBehavior(e.behaviors))){var t=getFormContainerId(e.form).then((function(t){t||(e.ts>o&&(c.day+=1),e.ts>a&&(c.week+=1),e.ts>s&&(c.month+=1),e.vst===r&&(c.session+=1))}));u.push(t)}})).then((function(){return Promise.all(u)})).then((function(){return!(e.session&&c.session>=e.session)&&(!(e.day&&c.day>=e.day)&&(!(e.week&&c.week>=e.week)&&(!(e.month&&c.month>=e.month)&&(!e.minimal_timeout||checkAccountMinimalTimeout(1e3*e.minimal_timeout)))))})).catch((function(){var n=+Session.getLastShown(t),r=864e5,i=Date.now()-n;return!(e.session&&n&&i<18e5)&&(!(e.day&&n&&i<r)&&(!(e.week&&n&&i<6048e5)&&(!(e.month&&n&&i<2592e6)&&!(e.minimal_timeout&&i<1e3*e.minimal_timeout))))}))}))}var Frequency={checkForm:checkForm,checkAccount:checkAccount},AbstractBehavior=inherit({__constructor:function(e){this.form=e},getTargetElement:null,terminate:function(){}}),EmbeddedBehavior=inherit(AbstractBehavior,{__constructor:function(e){this.__base(e),this.getTargetElement=this.getTargetElement.bind(this),this._getDivSelector=this._getDivSelector.bind(this),this._getSelector=this._getSelector.bind(this),this.terminate=this.terminate.bind(this)},_initialTargetElementInterval:1e3,_initialTargetElementIntervalId:null,_getDivSelector:function(){return"[data-popmechanic-embed='"+this.form.id+"']"},_getSelector:function(){return this.form.embed_selector&&this.form.selector||this._getDivSelector()},getTargetElement:function(e){var t=this;return new Promise((function(n){t._initialTargetElementIntervalId=setInterval((function(){var r=cash(e||t._getSelector());r.length&&(clearInterval(t._initialTargetElementIntervalId),n(r))}),t._initialTargetElementInterval)}))},terminate:function(){this._initialTargetElementIntervalId&&clearInterval(this._initialTargetElementIntervalId)}}),behaviorMap$1={embedded:EmbeddedBehavior};function getInstances$1(e,t){return _.reduce(e,(function(e,n){return behaviorMap$1[n]&&(e[n]=new behaviorMap$1[n](t)),e}),{})}var BehaviorFactory$1={getInstances:getInstances$1},sha256={exports:{}};function getModulusHash(e,t){try{var n=e.toString().toUpperCase()+t.toUpperCase(),r=sha256.exports.sha256.digest(n);return((r[28]<<24|r[29]<<16|r[30]<<8|r[31])>>>0)%100}catch(e){throw new Error("Couldn't calculate modulus hash for A/B test")}}function hashMatchesInterval(e,t,n,r){if(n<0||r>100)throw new Error("[modulusLower, modulusUpper) should be within [0, 100).");if(n>=r)throw new Error("Modulus lower bound can't be more or equal to modulus upper bound.");var i=getModulusHash(e,t);return n<=i&&i<r}
/**
	 * [js-sha256]{@link https://github.com/emn178/js-sha256}
	 *
	 * @version 0.9.0
	 * @author Chen, Yi-Cyuan [emn178@gmail.com]
	 * @copyright Chen, Yi-Cyuan 2014-2017
	 * @license MIT
	 */
!function(module){!function(){var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=commonjsGlobal:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&module.exports,ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e,t){return function(n){return new Sha256(t,!0).update(n)[e]()}},createMethod=function(e){var t=createOutputMethod("hex",e);NODE_JS&&(t=nodeWrap(t,e)),t.create=function(){return new Sha256(e)},t.update=function(e){return t.create().update(e)};for(var n=0;n<OUTPUT_TYPES.length;++n){var r=OUTPUT_TYPES[n];t[r]=createOutputMethod(r,e)}return t},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(e){if("string"==typeof e)return crypto.createHash(algorithm).update(e,"utf8").digest("hex");if(null==e)throw new Error(ERROR);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod},createHmacOutputMethod=function(e,t){return function(n,r){return new HmacSha256(n,t,!0).update(r)[e]()}},createHmacMethod=function(e){var t=createHmacOutputMethod("hex",e);t.create=function(t){return new HmacSha256(t,e)},t.update=function(e,n){return t.create(e).update(n)};for(var n=0;n<OUTPUT_TYPES.length;++n){var r=OUTPUT_TYPES[n];t[r]=createHmacOutputMethod(r,e)}return t};function Sha256(e,t){t?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function HmacSha256(e,t,n){var r,i=typeof e;if("string"===i){var o,a=[],s=e.length,c=0;for(r=0;r<s;++r)(o=e.charCodeAt(r))<128?a[c++]=o:o<2048?(a[c++]=192|o>>6,a[c++]=128|63&o):o<55296||o>=57344?(a[c++]=224|o>>12,a[c++]=128|o>>6&63,a[c++]=128|63&o):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++r)),a[c++]=240|o>>18,a[c++]=128|o>>12&63,a[c++]=128|o>>6&63,a[c++]=128|63&o);e=a}else{if("object"!==i)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR)}e.length>64&&(e=new Sha256(t,!0).update(e).array());var u=[],l=[];for(r=0;r<64;++r){var d=e[r]||0;u[r]=92^d,l[r]=54^d}Sha256.call(this,t,n),this.update(l),this.oKeyPad=u,this.inner=!0,this.sharedMemory=n}Sha256.prototype.update=function(e){if(!this.finalized){var t,n=typeof e;if("string"!==n){if("object"!==n)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR);t=!0}for(var r,i,o=0,a=e.length,s=this.blocks;o<a;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)for(i=this.start;o<a&&i<64;++o)s[i>>2]|=e[o]<<SHIFT[3&i++];else for(i=this.start;o<a&&i<64;++o)(r=e.charCodeAt(o))<128?s[i>>2]|=r<<SHIFT[3&i++]:r<2048?(s[i>>2]|=(192|r>>6)<<SHIFT[3&i++],s[i>>2]|=(128|63&r)<<SHIFT[3&i++]):r<55296||r>=57344?(s[i>>2]|=(224|r>>12)<<SHIFT[3&i++],s[i>>2]|=(128|r>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&r)<<SHIFT[3&i++]):(r=65536+((1023&r)<<10|1023&e.charCodeAt(++o)),s[i>>2]|=(240|r>>18)<<SHIFT[3&i++],s[i>>2]|=(128|r>>12&63)<<SHIFT[3&i++],s[i>>2]|=(128|r>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&r)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=s[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var e,t,n,r,i,o,a,s,c,u=this.h0,l=this.h1,d=this.h2,f=this.h3,h=this.h4,p=this.h5,m=this.h6,g=this.h7,v=this.blocks;for(e=16;e<64;++e)t=((i=v[e-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,n=((i=v[e-2])>>>17|i<<15)^(i>>>19|i<<13)^i>>>10,v[e]=v[e-16]+t+v[e-7]+n<<0;for(c=l&d,e=0;e<64;e+=4)this.first?(this.is224?(o=300032,g=(i=v[0]-1413257819)-150054599<<0,f=i+24177077<<0):(o=704751109,g=(i=v[0]-210244248)-1521486534<<0,f=i+143694565<<0),this.first=!1):(t=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),r=(o=u&l)^u&d^c,g=f+(i=g+(n=(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&p^~h&m)+K[e]+v[e])<<0,f=i+(t+r)<<0),t=(f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),r=(a=f&u)^f&l^o,m=d+(i=m+(n=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&h^~g&p)+K[e+1]+v[e+1])<<0,t=((d=i+(t+r)<<0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),r=(s=d&f)^d&u^a,p=l+(i=p+(n=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&g^~m&h)+K[e+2]+v[e+2])<<0,t=((l=i+(t+r)<<0)>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),r=(c=l&d)^l&f^s,h=u+(i=h+(n=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&m^~p&g)+K[e+3]+v[e+3])<<0,u=i+(t+r)<<0;this.h0=this.h0+u<<0,this.h1=this.h1+l<<0,this.h2=this.h2+d<<0,this.h3=this.h3+f<<0,this.h4=this.h4+h<<0,this.h5=this.h5+p<<0,this.h6=this.h6+m<<0,this.h7=this.h7+g<<0},Sha256.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,i=this.h4,o=this.h5,a=this.h6,s=this.h7,c=HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]+HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a];return this.is224||(c+=HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]),c},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,i=this.h4,o=this.h5,a=this.h6,s=this.h7,c=[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24&255,i>>16&255,i>>8&255,255&i,o>>24&255,o>>16&255,o>>8&255,255&o,a>>24&255,a>>16&255,a>>8&255,255&a];return this.is224||c.push(s>>24&255,s>>16&255,s>>8&255,255&s),c},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224)}()}(sha256);var AbstractIntegration=inherit({__constructor:function(e){this.data=e,this.filters=e.filter,this.filterType=e.filter_type,this.form=e.form},canRun:function(e){if(this.form&&this.form!==e.form)return!1;if(this.filters){var t=this.filterType||"all",n=Object.keys(this.filters);for(var r in n){if("all"===t&&e.customs[n[r]]!==this.filters[n[r]])return!1;if("any"===t&&e.customs[n[r]]===this.filters[n[r]])return!0}}return!0},shouldSkipForm:function(e){},onTargetingReady:function(e,t){},onRender:function(e){},onShow:function(e,t){},onClose:function(e,t){},onContactsSent:function(e,t){},canBeUsedWithForm:function(e){return!e.isControlGroup},_interpolate:function(e,t){var n=t.form,r=t.lead,i=e;return i=(i=(i=(i=(i=(i=(i=i.replace("%url%",location.href)).replace("%domain%",location.host)).replace("%utm_source%",sbjs.get.current.src)).replace("%utm_medium%",sbjs.get.current.mdm)).replace("%utm_campaign%",sbjs.get.current.cmp)).replace("%utm_term%",sbjs.get.current.trm)).replace("%utm_content%",sbjs.get.current.cnt),n&&(i=(i=i.replace("%form_id%",n.id)).replace("%form_name%",n.name)),r&&(Object.keys(r).forEach((function(e){"customs"===e?Object.keys(r.customs).forEach((function(e){i=i.replace(new RegExp("%customs."+e+"%","g"),r.customs[e])})):i=i.replace(new RegExp("%"+e+"%","g"),r[e])})),i=i.replace(new RegExp("%name%","g"),[r.first_name," ",r.last_name].join(" "))),i}}),CarrotQuestIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.carrotquest=window.carrotquest,this.fields=e.fields,this.open_event=e.open_event,this.close_event=e.close_event,this.lead_event=e.lead_event},onShow:function(e,t){this.open_event&&this.carrotquest&&this.carrotquest.track&&this.carrotquest.track(this._interpolate(this.open_event,{form:t.form}))},onClose:function(e,t){this.close_event&&this.carrotquest&&this.carrotquest.track&&this.carrotquest.track(this._interpolate(this.close_event,{form:t.form}))},onContactsSent:function(e,t){var n=t.form,r=t.lead,i={},o=this;r.phone&&(i.$phone=r.phone),r.name&&(i.$name=r.name),r.email&&(i.$email=r.email),Object.keys(this.fields).forEach((function(e){i[e]=o._interpolate(o.fields[e],{form:n,lead:r})})),this.lead_event&&this.carrotquest&&this.carrotquest.track&&this.carrotquest.track(this.lead_event),this.carrotquest.identify(i)}}),GoogleAnalyticsIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),window._gaq?this.mode="gaq":window.ga&&(this.mode="ga"),this.mode||console.log("PopMechanic Google Analytics integration failed - no GA found"),this.category=this.data.event_category,this.open_action=this.data.open_action,this.close_action=this.data.close_action,this.lead_action=this.data.lead_action,this.event_label=this.data.event_label||void 0,this.event_value=this.data.event_value||void 0,this.tracker_name=this.data.tracker_name||"t0",0===this.tracker_name.indexOf("UA-")&&(this.tracker_name=("popmechanic"+this.data.tracker_name).replace(/-/g,""),this._create(this.data.tracker_name,this.tracker_name))},_create:function(e,t){"gaq"===this.mode&&(_gat._getTrackerByName(t)||_gat._createTracker(e,t)),"ga"===this.mode&&(ga.getByName(t)||ga("create",e,"auto",t))},_push:function(e,t){"gaq"===this.mode&&_gaq.push([this.tracker_name+"._trackEvent",e,t,this.event_label,this.event_value]),"ga"===this.mode&&ga(this.tracker_name+".send","event",e,t,this.event_label,this.event_value)},onShow:function(e,t){this.open_action&&this._push(this._interpolate(this.category,t.form),this._interpolate(this.open_action,{form:t.form}))},onClose:function(e,t){this.close_action&&this._push(this._interpolate(this.category,t.form),this._interpolate(this.close_action,{form:t.form}))},onContactsSent:function(e,t){this.lead_action&&this._push(this._interpolate(this.category,{form:t.form,lead:t.lead}),this._interpolate(this.lead_action,{form:t.form,lead:t.lead}))}}),variables=[{key:"product_id",fetch:function(){return getMindboxKnownPageDataPromise().then((function(e){return e.product?e.product.ids:e.productGroup?e.productGroup.ids:null}))}},{key:"product_id_value",fetch:function(){return getMindboxKnownPageDataPromise().then((function(e){return e.product?getMindboxIdsExternalId(e.product.ids):e.productGroup?getMindboxIdsExternalId(e.productGroup.ids):null}))}},{key:"category_id",fetch:function(){return getMindboxKnownPageDataPromise().then((function(e){return e.category?e.category.ids:null}))}},{key:"category_id_value",fetch:function(){return getMindboxKnownPageDataPromise().then((function(e){return e.category?getMindboxIdsExternalId(e.category.ids):null}))}},{key:"cart_sum",fetch:function(){return getCart().then((function(e){return _.reduce(e,(function(e,t){return e+=t.priceOfLine||t.pricePerItem*t.count||0}),0)}))}},{key:"cart_products",fetch:getCart}],JavaScriptIntegration=inherit(AbstractIntegration,{_variables:variables,_methodHasVariable:function(e,t){return-1!==e.indexOf("%"+t+"%")},_getRequiredVariables:function(e){var t=this;return this._variables.filter((function(n){var r=n.key;return t._methodHasVariable(e,r)}))},_getVariablesValues:function(e){var t=this._getRequiredVariables(e),n=t.map((function(e){return Promise.resolve(e.fetch())}));return Promise.all(n).then((function(e){return _.reduce(t,(function(t,n,r){return t[n.key]=e[r],t}),{})}))},_interpolateWithVariables:function(e,t,n){var r=this._interpolate(e,t);return Object.keys(n).forEach((function(e){r=r.replace(new RegExp("%"+e+"%","g"),"(JSON.parse('"+JSON.stringify(n[e])+"'))")})),r},_executeLifecycleMethod:function(e){var t=e.methodName,n=e.params,r=this,i=this.data[t];if(i)try{return this._getVariablesValues(i).then((function(e){var t=r._interpolateWithVariables(i,n,e);return n.lead?new Function("lead","form",t)(n.lead,n.form):new Function("form",t)(n.form)}))}catch(e){defaultDebug.log(t+" error in integration#"+this.data.id+", form#"+n.form.id,e)}},onRender:function(e){return this._executeLifecycleMethod({methodName:"on_render",params:{form:e}})},onShow:function(e,t){return this._executeLifecycleMethod({methodName:"on_show",params:{form:t.form}})},onClose:function(e,t){return this.success?this._executeLifecycleMethod({methodName:"on_close_success",params:{form:t.form}}):this._executeLifecycleMethod({methodName:"on_close_fail",params:{form:t.form}})},onContactsSent:function(e,t){return this.success=!0,this._executeLifecycleMethod({methodName:"on_success",params:{form:t.form,lead:t.lead}})},onTargetingReady:function(e,t){return this._executeLifecycleMethod({methodName:"on_targeting",params:{form:t.form}})}}),KissmetricsIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.open_event=this.data.open_event,this.close_event=this.data.close_event,this.lead_event=this.data.lead_event},_push:function(e,t){_kmq.push(["record",e,t])},onShow:function(e,t){this.open_event&&this._push(this.open_event,{form:t.form.id})},onClose:function(e,t){this.close_event&&this._push(this.close_event,{form:t.form.id})},onContactsSent:function(e,t){var n=t.lead;this.lead_event&&this._push(this.lead_event,{form:n.form,conditions:n.conditions}),n.email&&_kmq.push(["set",{email:n.email}])}}),MindboxIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.provider=e.provider,this.operation=e.operation},onContactsSent:function(e,t){var n,r=this,i=t.lead,o={};n="email"===this.provider?"email":"phone"===this.provider?"phone":"id",i.first_name&&(o.firstName=i.first_name),i.last_name&&(o.lastName=i.last_name),i.email&&(o.email=i.email),i.phone&&(o.phone=i.phone),mindboxTrackerPromiseOrNull.then((function(){r.counter=window.mindbox,r.counter||(console.log("PopMechanic Mindbox integration error: no counter presented"),r.counter=function(){}),r.counter("identify",{operation:r.operation,identificator:{provider:r.provider,identity:i[n]},data:o})}))}}),MindboxPushIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.isPushAvailable=!!window.PushManager&&window.Notification&&"default"===window.Notification.permission},shouldSkipForm:function(e){return e.id===this.form&&!this.isPushAvailable},onContactsSent:function(){var e=this.data;e.get_subscription_operation&&e.subscribe_operation&&mindboxTrackerPromise.then((function(){window.mindbox("webpush.subscribe",{getSubscriptionOperation:e.get_subscription_operation,subscribeOperation:e.subscribe_operation,onGranted:function(){},onDenied:function(){}})}))}}),MindboxTrackingIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.isLead=!1,this._trackShow=this._trackShow.bind(this),this._trackClick=this._trackClick.bind(this)},canBeUsedWithForm:function(){return!0},canRun:function(e){return(!this.data.form||this.data.form===e.form)&&!this.isLead},onTargetingReady:function(e,t){this._trackTargeting(t)},onRender:function(e){Dispatcher.on("copyCode",this._trackClick),e.template&&e.template.behaviors&&(this.isLead=-1!==e.template.behaviors.indexOf("lead"))},onShow:function(e,t){this._trackShow(t)},onContactsSent:function(e,t){this._trackClick(e,t)},_trackTargeting:function(e){var t=this;this.data&&this.data.targeting_operation&&mindboxTrackerPromise.then((function(){window.mindbox("async",{operation:t.data.targeting_operation,data:{omitCdpAction:e.form.isControlGroup},onSuccess:function(){},onValidationError:function(){},onError:getErrorReporter(e.form.id,t.data.targeting_operation)})}))},_trackShow:function(e){var t=this;this.data&&this.data.show_operation&&mindboxTrackerPromise.then((function(){window.mindbox("async",{operation:t.data.show_operation,data:{omitCdpAction:e.form.isControlGroup},onSuccess:function(){},onValidationError:function(){},onError:getErrorReporter(e.form.id,t.data.show_operation)})}))},_trackClick:function(e,t){if(this.data.form===t.form.id){var n=this,r=t.form.id;this.data&&this.data.click_operation&&mindboxTrackerPromise.then((function(){window.mindbox("async",{operation:n.data.click_operation,data:{},onSuccess:function(){},onValidationError:function(){},onError:getErrorReporter(r,n.data.click_operation)})}))}}}),RetailRocketIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.counter=window.rrApi,this.counter||(console.log("PopMechanic RetailRocket integration error: no counter presented"),this.counter=function(){})},onContactsSent:function(e,t){var n=t.lead,r={};if(n.email){(n.first_name||n.last_name)&&(r.name=[n.first_name,n.last_name].filter(Boolean).join(" ")),n.phone&&(r.phone=n.phone);try{rrApi.setEmail(n.email,r)}catch(e){window.rrApiOnReady&&window.rrApiOnReady.push((function(){rrApi.setEmail(n.email,r)}))}}}}),SailplayIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.tags=e.tags,this.fields=e.fields},onContactsSent:function(e,t){var n=t.lead,r={},i={},o=this,a=this.tags.map((function(e){return o._interpolate(e,{form:t.form,lead:n})}));if(Object.keys(this.fields).forEach((function(e){i[e]=o._interpolate(o.fields[e],{form:t.form,lead:n})})),i.email=n.email,n.first_name&&(r.firstName=n.first_name),n.last_name&&(r.lastName=n.last_name),n.email&&(r.email=n.email),n.phone&&(r.phone=n.phone),this.counter=window.SP,!this.counter)return console.log("PopMechanic Sailplay integration error: no counter presented"),void(this.counter=function(){});try{this.counter.api.users.update(r),this.counter.api.customVariables.add(i),this.counter.tags({action:"add",tags:a,email:n.email})}catch(e){console.log("PopMechanic Sailplay integration error:"),console.log(e)}}}),YandexMetrikaIntegration=inherit(AbstractIntegration,{__constructor:function(e){this.__base(e),this.openGoal=this.data.open_event,this.closeGoal=this.data.close_event,this.leadGoal=this.data.lead_event},getCounter:function(){var e=/^yaCounter/,t=this;return this.data.counter?this.counter=window["yaCounter"+this.data.counter]:Object.keys(window).some((function(n){e.test(n)&&(t.counter=window[n])})),this.counter||console.log("PopMechanic Yandex.Metrika integration failed: no counter found on site"),this.counter},onShow:function(){this.getCounter();try{this.openGoal&&this.counter.reachGoal(this.openGoal)}catch(e){console.log(e)}},onClose:function(){this.getCounter();try{this.closeGoal&&this.counter.reachGoal(this.closeGoal)}catch(e){console.log(e)}},onContactsSent:function(){this.getCounter();try{this.leadGoal&&this.counter.reachGoal(this.leadGoal)}catch(e){console.log(e)}}}),IntegrationFactory=function(e){switch(e.integration_type){case"yandexmetrika":return new YandexMetrikaIntegration(e);case"googleanalytics":return new GoogleAnalyticsIntegration(e);case"carrotquest":return new CarrotQuestIntegration(e);case"mindbox":return new MindboxIntegration(e);case"mindbox_push":return new MindboxPushIntegration(e);case"mindbox_tracking":return new MindboxTrackingIntegration(e);case"kissmetrics":return new KissmetricsIntegration(e);case"sailplay":return new SailplayIntegration(e);case"retailrocket":return new RetailRocketIntegration(e);case"javascript":return new JavaScriptIntegration(e)}},deviceSettings={mindboxDeviceUUID:null},Form=function(e,t){var n=this;this.id=e.id,this.name=e.name,this.settings_splits=e.settings_splits,this.settings={},this.salt=e.salt,this.control_group=e.control_group,this.variants=e.variants,this.newTargeting=e.test_group?e.test_group.new_targeting:e.new_targeting,this.template_id=e.template,this.template=null,this.button_template_id=e.button_template,this.button_template=null,this.conditions=e.conditions,this.frequency=e.frequency||{},this.accountFrequency=e.accountFrequency||{},this.test_group=e.test_group,this.inTargeting=!1,this.inSplitTest=!1,this.embed_selector=e.embed_selector,this.selector=e.selector,this.placement=e.placement,this._targetingCb=[],this.custom_fields=e.custom_fields,this.containerId=e.container_id,this.childForms=e.child_forms||[],this.behaviors={},this.getTargetElement=null,this.isControlGroup=!1,this.isTransactional=e.is_transactional,this._isAbTest=!(!this.salt||!deviceSettings.mindboxDeviceUUID),this._setSettings(),this._integrations=t.filter((function(e){return!!e&&(!e.form||e.form===n.id)})).map((function(e){return IntegrationFactory(e)})),this._activeIntegrations=this._integrations.filter((function(e){return e.canBeUsedWithForm(n)})),this.reportClose=this.reportClose.bind(this),this.reportShow=this.reportShow.bind(this),this._getTargetElementCreator=this._getTargetElementCreator.bind(this),this.setBehaviors=this.setBehaviors.bind(this),this.subscribeIntegrations=this.subscribeIntegrations.bind(this),this.integrationsOnRender=this.integrationsOnRender.bind(this)};Form.prototype.isStatic=function(){return"static"===this.template.template_type||-1!==this.template.behaviors.indexOf("static")},Form.prototype.isEmbedded=function(){return"embedded"===this.template.template_type||-1!==this.template.behaviors.indexOf("embedded")},Form.prototype.setBehaviors=function(){this.behaviors=BehaviorFactory$1.getInstances(this.template.behaviors,this),this.getTargetElement=this._getTargetElementCreator()},Form.prototype._getFormVariant=function(){var e=this,t=window.PopMechanic.formHash,n=this.variants[0];if(!this._isAbTest)return n;if(t){if(-1!==document.location.toString().indexOf("form-variant-id=")){var r=document.location.toString().split("form-variant-id=")[1].split("&")[0],i=this.variants.find((function(e){return e.ab_test_variant_internal_id===r}));if(i)return i}return n}return this.variants.find((function(e){return e.is_winner}))||this.variants.find((function(t){return!!hashMatchesInterval(deviceSettings.mindboxDeviceUUID,e.salt,t.modulus_lower_inclusive,t.modulus_upper_exclusive)}))||n},Form.prototype._setSettings=function(){var e=this._getFormVariant();if(!window.PopMechanic.formHash&&this._isAbTest&&this.control_group)try{hashMatchesInterval(deviceSettings.mindboxDeviceUUID,this.salt,this.control_group.modulus_lower_inclusive,this.control_group.modulus_upper_exclusive)&&(this.isControlGroup=!0)}catch(e){}this.settings=e.view_settings,this.button_template_id=this.settings.button_template,this.settings.conditions_splits=this.settings_splits[0].conditions_splits},Form.prototype.setConditions=function(e){this.conditions=_.find(this.settings.conditions_splits,(function(t){return t.id===e})),this.conditions||(window.PopMechanic.isTesting||this.isEmbedded()?this.conditions={conditions:{delay:0}}:this.conditions={conditions:{reject:!0}})},Form.prototype.isAlways=function(){return-1!==this.template.behaviors.indexOf("always")},Form.prototype.ignoresTargeting=function(){return!(!this.conditions||!this.conditions.conditions||"ignore_targeting"!==this.conditions.conditions.only_forced)},Form.prototype.checkFrequency=function(){return window.PopMechanic.isTesting?Promise.resolve(!0):Frequency.checkForm(this.frequency,this.id)},Form.prototype.checkAccountFrequency=function(){return this.frequency.priority||window.PopMechanic.isTesting?Promise.resolve(!0):Frequency.checkAccount(this.accountFrequency,this.id)},Form.prototype.checkTargeting=function(e){var t=this;if(!_.some(t._activeIntegrations,(function(e){return e.shouldSkipForm(t)}))){var n=_.once((function(){report({type:"bucket",form:t.id,settings:t.settings?t.settings.id:0,conditions:t.conditions?t.conditions.id:""})}));return Promise.resolve(t.getTargetElement&&t.getTargetElement()).then((function(){return!!window.PopMechanic.isTesting||Targeting.check(t,(function(r){t.setInTargeting(r),r&&n(),e&&e(t,r)}))})).catch((function(){return!1})).then((function(e){return t.setInTargeting(e),e&&n(),e}))}},Form.prototype.cancelConditions=function(){},Form.prototype.checkConditions=function(){var e=this,t=getConditionsPromise(e.conditions.conditions,e.conditions.combinator),n=new Promise((function(t,n){e.cancelConditions=n}));return Promise.race([t,n]).then(_.constant(!0)).catch(_.constant(!1))},Form.prototype.setInTargeting=function(e){e!==this.inTargeting&&(this.inTargeting=e,this._targetingCb.forEach((function(t){t(e)})))},Form.prototype.onTargetingChange=function(e){if("function"==typeof e){this._targetingCb.push(e),this.inTargeting&&setTimeout((function(){e(!0)}),0)}},Form.prototype.clearTargetingChange=function(e){this._targetingCb=_.without(this._targetingCb,e)},Form.prototype.getLeadType=function(){var e=this.template.behaviors;return e.indexOf("lead")>-1?"lead":e.indexOf("info")>-1?"info-"+this.id:void 0},Form.prototype.getTestGroupId=function(){return this.test_group&&this.test_group.id?this.test_group.id:"form-"+this.id},Form.prototype.setTemplate=function(e){this.template=e,"embedded"===this.template.template_type&&-1===this.template.behaviors.indexOf("embedded")&&this.template.behaviors.push("embedded"),(_.includes(this.template.behaviors,"banner-h")||_.includes(this.template.behaviors,"banner-v"))&&(this.template.behaviors=_.without(this.template.behaviors,"banner")),this.setBehaviors()},Form.prototype.setButtonTemplate=function(e){this.button_template=e},Form.prototype.setInSplitTest=function(e){this.inSplitTest=e};var specialCaseEvents={show:"formShow",close:"formClose"};Form.prototype.report=function(e,t){var n={form:this.id,settings:this.settings?this.settings.id:"",conditions:this.conditions?this.conditions.id:"",type:e};t&&_.merge(n,t),report(n);var r=specialCaseEvents[e]||e;Dispatcher.trigger(r,{form:this})},Form.prototype.reportShow=function(){this.report("show")},Form.prototype.reportClose=function(){this.report("close")},Form.prototype.reportSlaSuccess=function(){},Form.prototype.reportSlaFailure=function(){},Form.prototype._getTargetElementCreator=function(){var e=_.chain(this.behaviors).values().reverse().find((function(e){return!!e.getTargetElement})).value();return e?e.getTargetElement:null},Form.prototype.terminate=function(){_.forEach(this.behaviors,(function(e){e.terminate()}))},Form.prototype.pushToHistory=function(){form.add({id:this.id,form:{containerId:this.containerId}})},Form.prototype.subscribeIntegrations=function(){var e=this;this._activeIntegrations.forEach((function(t){Dispatcher.on("lead",(function(n,r){r.form.id===e.id&&t.canRun(r.lead)&&t.onContactsSent(n,r)})),Dispatcher.on("targeting",(function(n,r){r.form.id===e.id&&t.onTargetingReady(n,r)})),Dispatcher.on("formShow",(function(n,r){r.form.id===e.id&&t.onShow(n,r)})),Dispatcher.on("formClose",(function(n,r){r.form.id===e.id&&t.onClose(n,r)}))}))},Form.prototype.integrationsOnRender=function(){var e=this;return Promise.all(this._activeIntegrations.map((function(t){return Promise.resolve(t.onRender(e))})))};var SBJS_ALIASES={source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},fieldMappers={phone:function(e){return e.replace(/\D/g,"")}},Lead=inherit({__constructor:function(e,t){var n=this;if(this.updateDeviceUUID(),this._data=e,this._data.form=t.id,t.settings&&(this._data.settings=t.settings.id),t.conditions&&(this._data.conditions=t.conditions.id),this._data.device=device$1.mobile()?"mobile":device$1.tablet()?"tablet":"pc",this._data.source=(sbjs.get.current.typ||"").split("|")[0],"file:"!==location.protocol&&(this._data.url=location.href),this._data.name){var r=this._data.name.replace(/\s\s/g," ").split(" ");r.length>1?(this._data.first_name=r.shift(),this._data.last_name=r.join(" ")):this._data.first_name=r[0]}this._data.customs=this._data.customs||{},Object.keys(this._data).forEach((function(e){fieldMappers[e]&&(n._data[e]=fieldMappers[e](n._data[e])),0===e.indexOf("customs.")&&(n._data.customs[e.substr("customs.".length)]=n._data[e],delete n._data[e])})),window.PopMechanic.customs&&_.extend(this._data.customs,window.PopMechanic.customs),t.custom_fields&&t.custom_fields.forEach((function(e){n._data.customs[e.machine_name]||(n._data.customs[e.machine_name]=e.default_value)})),"utm"===this._data.source?Object.keys(SBJS_ALIASES).forEach((function(e){n._data["utm_"+e]=(sbjs.get.current[SBJS_ALIASES[e]]||"").replace("(none)","")})):n._data.utm_source=(sbjs.get.current[SBJS_ALIASES.source]||"").replace("(none)","")},send:function(e,t){var n=this;return new Promise((function(r,i){cash.ajax({url:CONFIG.CONTACTS_URL+window.PopMechanic.client+"/",type:"POST",data:n.getJSON(),contentType:"application/json; charset=utf-8",success:function(t){r(e(t))},error:function(e,n,r){t(r),i(r)}}),Session.setContactsSent()}))},getJSON:function(){return JSON.stringify(this._data)},updateDeviceUUID:function(){deviceSettings.mindboxDeviceUUID&&(window.PopMechanic.customs=window.PopMechanic.customs||{},window.PopMechanic.customs.mindboxDeviceUUID=deviceSettings.mindboxDeviceUUID)}}),$body=cash("body");Session.isContactsSent("lead")&&$body.addClass(CONFIG.CSS_PREFIX+"submitted"),device$1.mobile()&&$body.addClass(CONFIG.CSS_PREFIX+"mobile"),device$1.tablet()&&$body.addClass(CONFIG.CSS_PREFIX+"tablet"),device$1.desktop()&&$body.addClass(CONFIG.CSS_PREFIX+"desktop");var globalCSS={setState:function(e){cash("body").addClass(CONFIG.CSS_PREFIX+e)}},data=[{mask:"+247-####"},{mask:"+376-###-###"},{mask:"+971-5#-###-####"},{mask:"+971-#-###-####"},{mask:"+93-##-###-####"},{mask:"+1(268)###-####"},{mask:"+1(264)###-####"},{mask:"+355(###)###-###"},{mask:"+374-##-###-###"},{mask:"+599-###-####"},{mask:"+599-###-####"},{mask:"+599-9###-####"},{mask:"+244(###)###-###"},{mask:"+672-1##-###"},{mask:"+54(###)###-####"},{mask:"+1(684)###-####"},{mask:"+43(###)###-####"},{mask:"+61-#-####-####"},{mask:"+297-###-####"},{mask:"+994-##-###-##-##"},{mask:"+387-##-#####"},{mask:"+387-##-####"},{mask:"+1(246)###-####"},{mask:"+880-##-###-###"},{mask:"+32(###)###-###"},{mask:"+226-##-##-####"},{mask:"+359(###)###-###"},{mask:"+973-####-####"},{mask:"+257-##-##-####"},{mask:"+229-##-##-####"},{mask:"+1(441)###-####"},{mask:"+673-###-####"},{mask:"+591-#-###-####"},{mask:"+55-##-####-####"},{mask:"+1(242)###-####"},{mask:"+975-17-###-###"},{mask:"+975-#-###-###"},{mask:"+267-##-###-###"},{mask:"+375(##)###-##-##"},{mask:"+501-###-####"},{mask:"+243(###)###-###"},{mask:"+236-##-##-####"},{mask:"+242-##-###-####"},{mask:"+41-##-###-####"},{mask:"+225-##-###-###"},{mask:"+682-##-###"},{mask:"+56-#-####-####"},{mask:"+237-####-####"},{mask:"+86(###)####-####"},{mask:"+86(###)####-###"},{mask:"+86-##-#####-#####"},{mask:"+57(###)###-####"},{mask:"+506-####-####"},{mask:"+53-#-###-####"},{mask:"+238(###)##-##"},{mask:"+599-###-####"},{mask:"+357-##-###-###"},{mask:"+420(###)###-###"},{mask:"+49(####)###-####"},{mask:"+49(###)###-####"},{mask:"+49(###)##-####"},{mask:"+49(###)##-###"},{mask:"+49(###)##-##"},{mask:"+49-###-###"},{mask:"+253-##-##-##-##"},{mask:"+45-##-##-##-##"},{mask:"+1(767)###-####"},{mask:"+1(809)###-####"},{mask:"+1(829)###-####"},{mask:"+1(849)###-####"},{mask:"+213-##-###-####"},{mask:"+593-##-###-####"},{mask:"+593-#-###-####"},{mask:"+372-####-####"},{mask:"+372-###-####"},{mask:"+20(###)###-####"},{mask:"+291-#-###-###"},{mask:"+34(###)###-###"},{mask:"+251-##-###-####"},{mask:"+358(###)###-##-##"},{mask:"+679-##-#####"},{mask:"+500-#####"},{mask:"+691-###-####"},{mask:"+298-###-###"},{mask:"+262-#####-####"},{mask:"+33(###)###-###"},{mask:"+508-##-####"},{mask:"+590(###)###-###"},{mask:"+241-#-##-##-##"},{mask:"+1(473)###-####"},{mask:"+995(###)###-###"},{mask:"+594-#####-####"},{mask:"+233(###)###-###"},{mask:"+350-###-#####"},{mask:"+299-##-##-##"},{mask:"+220(###)##-##"},{mask:"+224-##-###-###"},{mask:"+240-##-###-####"},{mask:"+30(###)###-####"},{mask:"+502-#-###-####"},{mask:"+1(671)###-####"},{mask:"+245-#-######"},{mask:"+592-###-####"},{mask:"+852-####-####"},{mask:"+504-####-####"},{mask:"+385-##-###-###"},{mask:"+509-##-##-####"},{mask:"+36(###)###-###"},{mask:"+62(8##)###-####"},{mask:"+62-##-###-##"},{mask:"+62-##-###-###"},{mask:"+62-##-###-####"},{mask:"+62(8##)###-###"},{mask:"+62(8##)###-##-###"},{mask:"+353(###)###-###"},{mask:"+972-5#-###-####"},{mask:"+972-#-###-####"},{mask:"+91(####)###-###"},{mask:"+246-###-####"},{mask:"+964(###)###-####"},{mask:"+98(###)###-####"},{mask:"+354-###-####"},{mask:"+39(###)####-###"},{mask:"+1(876)###-####"},{mask:"+962-#-####-####"},{mask:"+81-##-####-####"},{mask:"+81(###)###-###"},{mask:"+254-###-######"},{mask:"+996(###)###-###"},{mask:"+855-##-###-###"},{mask:"+686-##-###"},{mask:"+269-##-#####"},{mask:"+1(869)###-####"},{mask:"+850-191-###-####"},{mask:"+850-##-###-###"},{mask:"+850-###-####-###"},{mask:"+850-###-###"},{mask:"+850-####-####"},{mask:"+850-####-#############"},{mask:"+82-##-###-####"},{mask:"+965-####-####"},{mask:"+1(345)###-####"},{mask:"+7(6##)###-##-##"},{mask:"+7(7##)###-##-##"},{mask:"+856(20##)###-###"},{mask:"+856-##-###-###"},{mask:"+961-##-###-###"},{mask:"+961-#-###-###"},{mask:"+1(758)###-####"},{mask:"+423(###)###-####"},{mask:"+94-##-###-####"},{mask:"+231-##-###-###"},{mask:"+266-#-###-####"},{mask:"+370(###)##-###"},{mask:"+352(###)###-###"},{mask:"+371-##-###-###"},{mask:"+218-##-###-###"},{mask:"+218-21-###-####"},{mask:"+212-##-####-###"},{mask:"+377(###)###-###"},{mask:"+377-##-###-###"},{mask:"+373-####-####"},{mask:"+382-##-###-###"},{mask:"+261-##-##-#####"},{mask:"+692-###-####"},{mask:"+389-##-###-###"},{mask:"+223-##-##-####"},{mask:"+95-##-###-###"},{mask:"+95-#-###-###"},{mask:"+95-###-###"},{mask:"+976-##-##-####"},{mask:"+853-####-####"},{mask:"+1(670)###-####"},{mask:"+596(###)##-##-##"},{mask:"+222-##-##-####"},{mask:"+1(664)###-####"},{mask:"+356-####-####"},{mask:"+230-###-####"},{mask:"+960-###-####"},{mask:"+265-1-###-###"},{mask:"+265-#-####-####"},{mask:"+52(###)###-####"},{mask:"+52-##-##-####"},{mask:"+60-##-###-####"},{mask:"+60(###)###-###"},{mask:"+60-##-###-###"},{mask:"+60-#-###-###"},{mask:"+258-##-###-###"},{mask:"+264-##-###-####"},{mask:"+687-##-####"},{mask:"+227-##-##-####"},{mask:"+672-3##-###"},{mask:"+234(###)###-####"},{mask:"+234-##-###-###"},{mask:"+234-##-###-##"},{mask:"+234(###)###-####"},{mask:"+505-####-####"},{mask:"+31-##-###-####"},{mask:"+47(###)##-###"},{mask:"+977-##-###-###"},{mask:"+674-###-####"},{mask:"+683-####"},{mask:"+64(###)###-###"},{mask:"+64-##-###-###"},{mask:"+64(###)###-####"},{mask:"+968-##-###-###"},{mask:"+507-###-####"},{mask:"+51(###)###-###"},{mask:"+689-##-##-##"},{mask:"+675(###)##-###"},{mask:"+63(###)###-####"},{mask:"+92(###)###-####"},{mask:"+48(###)###-###"},{mask:"+970-##-###-####"},{mask:"+351-##-###-####"},{mask:"+680-###-####"},{mask:"+595(###)###-###"},{mask:"+974-####-####"},{mask:"+262-#####-####"},{mask:"+40-##-###-####"},{mask:"+381-##-###-####"},{mask:"+7(###)###-##-##"},{mask:"+250(###)###-###"},{mask:"+966-5-####-####"},{mask:"+966-#-###-####"},{mask:"+677-###-####"},{mask:"+677-#####"},{mask:"+248-#-###-###"},{mask:"+249-##-###-####"},{mask:"+46-##-###-####"},{mask:"+65-####-####"},{mask:"+290-####"},{mask:"+290-####"},{mask:"+386-##-###-###"},{mask:"+421(###)###-###"},{mask:"+232-##-######"},{mask:"+378-####-######"},{mask:"+221-##-###-####"},{mask:"+252-##-###-###"},{mask:"+252-#-###-###"},{mask:"+252-#-###-###"},{mask:"+597-###-####"},{mask:"+597-###-###"},{mask:"+211-##-###-####"},{mask:"+239-##-#####"},{mask:"+503-##-##-####"},{mask:"+1(721)###-####"},{mask:"+963-##-####-###"},{mask:"+268-##-##-####"},{mask:"+1(649)###-####"},{mask:"+235-##-##-##-##"},{mask:"+228-##-###-###"},{mask:"+66-##-###-####"},{mask:"+66-##-###-###"},{mask:"+992-##-###-####"},{mask:"+690-####"},{mask:"+670-###-####"},{mask:"+670-77#-#####"},{mask:"+670-78#-#####"},{mask:"+993-#-###-####"},{mask:"+216-##-###-###"},{mask:"+676-#####"},{mask:"+90(###)###-####"},{mask:"+1(868)###-####"},{mask:"+688-90####"},{mask:"+688-2####"},{mask:"+886-#-####-####"},{mask:"+886-####-####"},{mask:"+255-##-###-####"},{mask:"+380(##)###-##-##"},{mask:"+256(###)###-###"},{mask:"+44-##-####-####"},{mask:"+598-#-###-##-##"},{mask:"+998-##-###-####"},{mask:"+39-6-698-#####"},{mask:"+1(784)###-####"},{mask:"+58(###)###-####"},{mask:"+1(284)###-####"},{mask:"+1(340)###-####"},{mask:"+84-##-####-###"},{mask:"+84(###)####-###"},{mask:"+678-##-#####"},{mask:"+678-#####"},{mask:"+681-##-####"},{mask:"+685-##-####"},{mask:"+967-###-###-###"},{mask:"+967-#-###-###"},{mask:"+967-##-###-###"},{mask:"+27-##-###-####"},{mask:"+260-##-###-####"},{mask:"+263-#-######"},{mask:"+1(###)###-####"}],EventListener=function(e){this.element=e,this.listeners=[]};function isBeforeInputEventSupported(e){return"onbeforeinput"in e}function isEventProducingCharacter(e){var t=e.key,n=e.ctrlKey,r=e.metaKey,i=e.altKey,o=n||r||i,a=/^(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])$/.test(t);return!o&&"Backspace"!==t&&a}function areElementValuesEqual(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return t.every((function(t){return t.value===e.value}))}function areElementStatesEqual(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return t.every((function(t){var n=t.value,r=t.selection;return n===e.value&&r[0]===e.selection[0]&&r[1]===e.selection[1]}))}function getNotEmptySelection(e,t){var n=e.value,r=e.selection,i=r[0],o=r[1];return i!==o?[i,o]:t?[i,Math.min(o+1,n.length)]:[Math.max(i-1,0),o]}function identity(e){return e}EventListener.prototype.listen=function(e,t,n){var r=this,i=t;this.element.addEventListener(e,i,n),this.listeners.push((function(){return r.element.removeEventListener(e,i)}))},EventListener.prototype.destroy=function(){this.listeners.forEach((function(e){return e()}))};var MaskHistory=function(){this.now=null,this.past=[],this.future=[]};function applyOverwriteMode(e,t,n){var r=e.value,i=e.selection,o=i[0],a=i[1];return{value:r,selection:"replace"===("function"==typeof n?n({value:r,selection:i}):n)?[o,o+t.length]:[o,a]}}function isFixedCharacter(e){return"string"==typeof e}function getLeadingFixedCharacters(e,t,n,r){for(var i="",o=t.length;o<e.length;o++){var a=e[o],s=r.value[o]===a;if(!isFixedCharacter(a)||a===n&&!s)return i;i+=a}return i}function guessValidValueByPattern(e,t,n){var r=null,i=null,o=Array.from(e.value).reduce((function(o,a,s){var c=o+getLeadingFixedCharacters(t,o,a,n),u=t[c.length];return isFixedCharacter(u)?c+u:a.match(u)?(null===r&&s>=e.selection[0]&&(r=c.length),null===i&&s>=e.selection[1]&&(i=c.length),c+a):c}),"");return{value:o,selection:[null!=r?r:o.length,null!=i?i:o.length]}}function guessValidValueByRegExp(e,t){var n=e.value,r=e.selection,i=r[0],o=r[1],a=i,s=o;return{value:Array.from(n).reduce((function(e,n,r){var c=e+n;return i===r&&(a=e.length),o===r&&(s=e.length),c.match(t)?c:e}),""),selection:[a,s]}}function validateValueWithMask(e,t){return Array.isArray(t)?e.length<=t.length&&Array.from(e).every((function(e,n){var r=t[n];return isFixedCharacter(r)?e===r:e.match(r)})):t.test(e)}function calibrateValueByMask(e,t,n){if(void 0===n&&(n=e),validateValueWithMask(e.value,t))return e;var r=Array.isArray(t)?guessValidValueByPattern(e,t,n):guessValidValueByRegExp(e,t),i=r.value;return{selection:r.selection,value:Array.isArray(t)?i.slice(0,t.length):i}}function removeFixedMaskCharacters(e,t){if(!Array.isArray(t))return e;var n=e.selection,r=n[0],i=n[1],o=[],a=Array.from(e.value).reduce((function(e,n,a){var s=t[a];return a===r&&o.push(e.length),a===i&&o.push(e.length),isFixedCharacter(s)&&s===n?e:e+n}),"");return o.length<2&&o.push.apply(o,Array(2-o.length).fill(a.length)),{value:a,selection:[o[0],o[1]]}}MaskHistory.prototype.undo=function(){var e=this.past.pop();e&&this.now&&(this.future.push(this.now),this.updateElement(e,"historyUndo"))},MaskHistory.prototype.redo=function(){var e=this.future.pop();e&&this.now&&(this.past.push(this.now),this.updateElement(e,"historyRedo"))},MaskHistory.prototype.updateHistory=function(e){if(this.now){var t=this.now.value!==e.value,n=this.now.selection.some((function(t,n){return t!==e.selection[n]}));(t||n)&&(t&&(this.past.push(this.now),this.future=[]),this.now=e)}else this.now=e},MaskHistory.prototype.updateElement=function(e,t){this.now=e,this.updateValue(e.value,{inputType:t,data:null}),this.updateSelectionRange(e.selection)};var MaskModel=function(e,t){this.initialElementState=e,this.maskOptions=t,this.value="",this.selection=[0,0];var n=calibrateValueByMask(e,this.getMaskExpression(e)),r=n.value,i=n.selection;this.value=r,this.selection=i};function maskitoTransform(e,t){var n=Object.assign(Object.assign({},MASKITO_DEFAULT_OPTIONS),t),r="string"==typeof e?{value:e,selection:[0,0]}:e,i=n.preprocessor({elementState:r,data:""},"validation").elementState,o=new MaskModel(i,n),a=n.postprocessor(o,r),s=a.value,c=a.selection;return"string"==typeof e?s:{value:s,selection:c}}MaskModel.prototype.addCharacters=function(e,t){var n=e[0],r=e[1],i=this.value,o=this.getMaskExpression({value:i.slice(0,n)+t+i.slice(r),selection:[n+t.length,n+t.length]}),a={value:i,selection:[n,r]},s=removeFixedMaskCharacters(a,o),c=applyOverwriteMode(s,t,this.maskOptions.overwriteMode).selection,u=c[0],l=c[1],d=s.value.slice(0,u)+t+s.value.slice(l),f=u+t.length,h=calibrateValueByMask({value:d,selection:[f,f]},o,a);if(areElementStatesEqual(this,h))throw new Error("Invalid mask value");this.value=h.value,this.selection=h.selection},MaskModel.prototype.deleteCharacters=function(e){var t=e[0],n=e[1];if(t!==n&&n){var r=this.value,i=this.getMaskExpression({value:r.slice(0,t)+r.slice(n),selection:[t,t]}),o={value:r,selection:[t,n]},a=removeFixedMaskCharacters(o,i),s=a.selection,c=s[0],u=s[1],l=calibrateValueByMask({value:a.value.slice(0,c)+a.value.slice(u),selection:[c,c]},i,o);this.value=l.value,this.selection=l.selection}},MaskModel.prototype.getMaskExpression=function(e){var t=this.maskOptions.mask;return"function"==typeof t?t(e):t};var MASKITO_DEFAULT_OPTIONS={mask:/^.*$/,preprocessor:identity,postprocessor:identity,overwriteMode:"shift"},Maskito=function(e){function t(t,n){var r=this;e.call(this),this.element=t,this.maskitoOptions=n,this.eventListener=new EventListener(this.element),this.options=Object.assign(Object.assign({},MASKITO_DEFAULT_OPTIONS),this.maskitoOptions),this.conformValueToMask(),this.updateHistory(this.elementState),this.eventListener.listen("keydown",(function(e){var t=e.ctrlKey,n=e.key,i=e.metaKey,o=e.shiftKey;return i&&o&&"z"===n||t&&"y"===n?(e.preventDefault(),r.redo()):(t||i)&&"z"===n?(e.preventDefault(),r.undo()):void 0})),isBeforeInputEventSupported(t)?this.eventListener.listen("beforeinput",(function(e){switch(r.updateHistory(r.elementState),e.inputType){case"historyUndo":return e.preventDefault(),r.undo();case"historyRedo":return e.preventDefault(),r.redo();case"deleteContentBackward":case"deleteWordBackward":case"deleteByCut":return r.handleDelete(e,!1);case"deleteContentForward":case"deleteWordForward":return r.handleDelete(e,!0);case"insertFromDrop":return;case"insertLineBreak":return r.handleEnter(e);case"insertFromPaste":case"insertText":default:return r.handleInsert(e,e.data||"")}})):(this.eventListener.listen("keydown",(function(e){return r.handleKeydown(e)})),this.eventListener.listen("paste",(function(e){var t;return r.handleInsert(e,(null===(t=e.clipboardData)||void 0===t?void 0:t.getData("text/plain"))||"")}))),this.eventListener.listen("input",(function(){r.conformValueToMask(),r.updateHistory(r.elementState)}))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={elementState:{configurable:!0},isTextArea:{configurable:!0}};return n.elementState.get=function(){var e=this.element;return{value:e.value,selection:[e.selectionStart||0,e.selectionEnd||0]}},n.isTextArea.get=function(){return"TEXTAREA"===this.element.nodeName},t.prototype.destroy=function(){this.eventListener.destroy()},t.prototype.updateSelectionRange=function(e){var t,n,r=e[0],i=e[1];this.element.selectionStart===r&&this.element.selectionEnd===i||null===(n=(t=this.element).setSelectionRange)||void 0===n||n.call(t,r,i)},t.prototype.updateValue=function(e,t){if(void 0===t&&(t={inputType:"insertText",data:null}),this.element.value!==e){var n="undefined"!=typeof window?window:globalThis;this.element.value=e,(null==n?void 0:n.InputEvent)&&this.element.dispatchEvent(new InputEvent("input",Object.assign(Object.assign({},t),{bubbles:!0,cancelable:!0})))}},t.prototype.handleKeydown=function(e){var t=e.key;switch(t){case"Backspace":case"Delete":return this.handleDelete(e,"Delete"===t);case"Enter":return this.handleEnter(e)}isEventProducingCharacter(e)&&this.handleInsert(e,t)},t.prototype.conformValueToMask=function(){var e=maskitoTransform(this.elementState,this.options),t=e.value,n=e.selection;this.updateValue(t),this.updateSelectionRange(n)},t.prototype.handleDelete=function(e,t){var n={value:this.elementState.value,selection:getNotEmptySelection(this.elementState,t)},r=n.selection,i=r[0],o=r[1],a=this.options.preprocessor({elementState:n,data:""},t?"deleteForward":"deleteBackward").elementState,s=new MaskModel(a,this.options),c=a.selection,u=c[0],l=c[1];s.deleteCharacters([u,l]);var d=this.options.postprocessor(s,n);if(n.value.slice(0,i)+n.value.slice(o)!==d.value){if(e.preventDefault(),areElementValuesEqual(n,a,s,d))return this.updateSelectionRange(t?[l,l]:[u,u]);var f=t?"deleteContentForward":"deleteContentBackward";this.updateValue(d.value,{inputType:"inputType"in e?e.inputType:f,data:null}),this.updateSelectionRange(d.selection),this.updateHistory(d)}},t.prototype.handleInsert=function(e,t){var n=this.elementState,r=this.options.preprocessor({data:t,elementState:n},"insert"),i=r.elementState,o=r.data;void 0===o&&(o=t);var a=new MaskModel(i,this.options);try{a.addCharacters(i.selection,o)}catch(t){return e.preventDefault()}var s=i.selection,c=s[0],u=s[1],l=i.value.slice(0,c)+t+i.value.slice(u),d=this.options.postprocessor(a,n),f=d.value,h=d.selection;l!==f&&(e.preventDefault(),this.updateValue(f,{data:t,inputType:"inputType"in e?e.inputType:"insertText"}),this.updateSelectionRange(h),this.updateHistory({value:f,selection:h}))},t.prototype.handleEnter=function(e){this.isTextArea&&this.handleInsert(e,"\n")},Object.defineProperties(t.prototype,n),t}(MaskHistory),PHONE_MASK_DATA_ID=CONFIG.CSS_PREFIX+"phone-mask",DIGIT=/\d/;function maskToMaskito(e){return e.split("").map((function(e){return"#"===e?DIGIT:e}))}function masksSort(e,t,n,r){return e.sort((function(e,i){for(var o=0,a=0;o<e[r].length&&a<i[r].length;){var s=e[r].charAt(o),c=i[r].charAt(a);if(n.test(s))if(n.test(c)){if(-1!==t.indexOf(s)&&-1===t.indexOf(c))return 1;if(-1===t.indexOf(s)&&-1!==t.indexOf(c))return-1;if(-1===t.indexOf(s)&&-1===t.indexOf(c)&&s!==c)return s<c?-1:1;o++,a++}else a++;else o++}for(;o<e[r].length||a<i[r].length;)if(o<e[r].length&&!n.test(e[r].charAt(o)))o++;else if(a<i[r].length&&!n.test(i[r].charAt(a)))a++;else{if(o<e[r].length)return 1;if(a<i[r].length)return-1}return 0})),e}var nullMask={testMask:["+"],mask:["+"],stringMask:"+"},phonesMaskList=masksSort(data,["#"],/[0-9]|#/,"mask").map((function(e){var t=maskToMaskito(e.mask),n=t.map((function(e){return"string"==typeof e&&/\d/.test(e)?/\d/:e}));return{testMask:t,mask:n,stringMask:e.mask}}));function getFittingMask(e){if(0===(e=e.replace(/\D/g,"")).length)return null;for(var t=0;t<phonesMaskList.length;t++){for(var n=phonesMaskList[t].testMask.filter((function(e){return"string"!=typeof e||DIGIT.test(e)})),r=!0,i=0;i<e.length&&void 0!==n[i];i++)if("string"==typeof n[i]){if(n[i]!==e[i]){r=!1;break}}else if(!n[i].test(e[i])){r=!1;break}if(r)return phonesMaskList[t]}return null}var inputmasksReadyPromise=new Promise((function(e){cash(document).ready((function(){e()}))})),inputsCache=[];function isMaskitoCompleted(e,t){var n=t.split("");if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if("string"==typeof e[r]){if(n[r]!==e[r])return!1}else if(!e[r].test(n[r]))return!1;return!0}function inputmasks(e,t){var n=maskToMaskito(t);return cash(e).each((function(e,t){var r=new Maskito(t,{mask:n,overwriteMode:"shift"});inputsCache.push(r)})),this}function phoneMasks(e){cash(e).each((function(e,t){var n=new Maskito(t,{mask:function(e){var n=e.value?getFittingMask(e.value):nullMask;return n?(cash(t).data(PHONE_MASK_DATA_ID,n.stringMask),n.mask):maskToMaskito(cash(t).data(PHONE_MASK_DATA_ID)||"+")},overwriteMode:"shift"});inputsCache.push(n)}))}Dispatcher.on("destroy",(function(){for(;inputsCache.length>0;){inputsCache.pop().destroy()}}));var inputmask={common:function(e,t){inputmasks(e,t)},phones:function(e){phoneMasks(e)},dates:function(e){inputmasks(e,"##.##.####")},isCompleted:function(e,t){return isMaskitoCompleted(maskToMaskito(t=t||cash(e).data(PHONE_MASK_DATA_ID)),cash(e).val())},readyPromise:inputmasksReadyPromise},fieldValidators={email:{test:function(e){return/^[^\s--@]+@[^\s@]+\.[^\s@!#\.\$%\^\&\*]{2,}$/.test(e)}},phone:/^\+?[\d\s-()]+$/,name:/^[\s\S]+$/},fieldTypeValidators={date:{test:function(e){try{var t=e.split("."),n=t[0],r=t[1],i=t[2],o=Date.parse([i,r,n].join("-"));return!isNaN(o)}catch(e){return!1}}}},validators={fieldValidators:fieldValidators,fieldTypeValidators:fieldTypeValidators};function convertBaseFieldNameToLowercase(e){var t=e.toLowerCase();return["name","email","phone","first_name","last_name"].includes(t)?t:e}function normalizeDate(e){if(!device$1.desktop())try{var t=e.split("-"),n=t[0],r=t[1],i=t[2];return _.some(t)?[i,r,n].join("."):""}catch(e){return""}return e}function normalizeInputValue(e,t){return"date"===e?normalizeDate(t):t}var AbstractLeadBehavior=inherit(AbstractBehavior$1,{_sending:!1,_fields:[],_fieldNamesInHtml:[],_canSubmit:!0,_$elem:null,_view:null,_showSuccess:!0,_sent:!1,_requiredFields:["name","email","phone"],__constructor:function(e){this.__base(e),this._fields=[],this._fieldNamesInHtml=[];var t=e.form.settings.behavior_settings.lead||{legal_text:""};this.legalText=t.legal_text},_updateField:function(e,t,n){var r=!0,i=this._fieldNamesInHtml.find((function(t){return t.field===e})),o=i?i.fieldName:"",a=this._$elem.find("[data-"+CONFIG.CSS_PREFIX+'input="'+o+'"]'),s=(!!a.filter("[data-"+CONFIG.CSS_PREFIX+"required]").length||_.includes(this._requiredFields,e))&&!a.filter("[data-"+CONFIG.CSS_PREFIX+"unrequired]").length,c=a.first().data(CONFIG.CSS_PREFIX+"type"),u=validators.fieldTypeValidators[c];if(!(!(t=(t=null==t?"":t).trim?t.trim():+t)&&!s)){if(validators.fieldValidators[e]&&(r=r&&validators.fieldValidators[e].test(t)),r&&u&&(r=r&&u.test(t)),"phone"===e&&r&&t)try{var l=cash(a).filter("[data-"+CONFIG.CSS_PREFIX+"mask]").first().data(CONFIG.CSS_PREFIX+"mask");r=r&&inputmask.isCompleted(a.first(),l)}catch(e){r=!1}if(r&&a.filter("[data-"+CONFIG.CSS_PREFIX+"mask]").length)try{var d=cash(a).filter("[data-"+CONFIG.CSS_PREFIX+"mask]").first().data(CONFIG.CSS_PREFIX+"mask");r=r&&inputmask.isCompleted(a.first(),d)}catch(e){r=!1}s&&(r=r&&!!t)}return!r&&n?(a.filter(':not([type="radio"])').filter(':not([type="checkbox"])').val(t),a.addClass(CONFIG.CSS_PREFIX+"invalid")):a.addClass(CONFIG.CSS_PREFIX+"valid"),this._leadModel[e]=t,this._runIf(),r},_runIf:function(){var e=this._leadModel;this._$elem.find("[data-popmechanic-if]").each((function(){var t=new Function("lead","PopMechanic","return "+cash(this).data("popmechanic-if")+";"),n=_.clone(e);n.customs=n.customs||{},_.extend(n.customs,window.PopMechanic.customs);try{t(n,window.PopMechanic)?cash(this).show():cash(this).hide()}catch(e){cash(this).hide()}}))},canSubmit:function(){return this._canSubmit&&!this._sending&&!this._sent},_submit:function(e){var t,n=!0,r=this;if(r.canSubmit()&&(r._fields.forEach((function(e){var t=r._updateField(e,r._leadModel[e],!0);n=t&&n})),n))return r._sending=!0,t=new Lead(r._leadModel,r._view.form),r._$elem.addClass(CONFIG.CSS_PREFIX+"pending"),e&&e.preventDefault(),t.send((function(e){if(r._runIf(),window.PopMechanic.leads.push(e),r._$elem.removeClass(CONFIG.CSS_PREFIX+"pending"),r._$elem.addClass(CONFIG.CSS_PREFIX+"submitted"),r._$elem.addClass(CONFIG.CSS_PREFIX+"success"),globalCSS.setState("success"),r._sending=!1,r._sent=!0,Dispatcher.trigger("lead",{lead:e,form:r._view.form}),event.push({type:"lead-success",form:r._view.form.id}),Session.setCompleted(e.form||r._view.form.id),r._showSuccess)return r._view.success(e)}),(function(){return r._$elem.removeClass(CONFIG.CSS_PREFIX+"pending"),r._$elem.addClass(CONFIG.CSS_PREFIX+"error"),r._sending=!1,report({type:"exception"}),Dispatcher.trigger("cancel",{form:r._view.form}),event.push({type:"lead-cancel",form:r._view.form.id}),Session.setUncompleted(r._view.form.id),r._view.close()}))},_bindEvents:function(){},onBeforeRender:function(){return inputmask.readyPromise},onRender:function(e,t){(this.__base(e,t),device$1.desktop()||e.find("input[data-"+CONFIG.CSS_PREFIX+"type=date]").attr("type","date"),this.legalText)&&this._filterForm(e).append('<div class="js-popmechanic-legal-aux" style="display: none;">'+this.legalText+"</div>")},onShow:function(e,t){var n=this;this._$elem=e,this._view=t,this._leadModel={},e.find("[data-"+CONFIG.CSS_PREFIX+"input]").each((function(){var t=this,r=cash(this),i=r.data(CONFIG.CSS_PREFIX+"input"),o=e.find("[data-"+CONFIG.CSS_PREFIX+'input="'+i+'"]'),a=r.data(CONFIG.CSS_PREFIX+"type");o.each((function(){return n._initInputMask(cash(t))}));var s=convertBaseFieldNameToLowercase(i);if(-1===n._fields.indexOf(s)&&(n._fields.push(s),n._fieldNamesInHtml.push({field:s,fieldName:i})),r.on("keyup click",(function(){var e="checkbox"===r.attr("type")?r.is(":checked"):r.val();o.removeClass(CONFIG.CSS_PREFIX+"invalid"),e=normalizeInputValue(a,e),n._updateField(s,e)})),r.on("change blur",(function(){var e="checkbox"===r.attr("type")?r.is(":checked"):r.val();e=normalizeInputValue(a,e),n._updateField(s,e,!0)})),"radio"!==r.attr("type")){var c="checkbox"===r.attr("type")?r.is(":checked"):r.val();c=normalizeInputValue(a,c),n._updateField(s,c,!1)}else{var u=r.val();u=normalizeInputValue(a,u),r.is(":checked")&&n._updateField(s,u,!1)}})),this._bindEvents()},_initInputMask:function(e){try{e.is("input[data-"+CONFIG.CSS_PREFIX+"mask]")?inputmask.common(e,e.data(CONFIG.CSS_PREFIX+"mask")):e.is("input[data-"+CONFIG.CSS_PREFIX+"input=phone]")?inputmask.phones(e):e.is("input[data-"+CONFIG.CSS_PREFIX+"type=date]")&&device$1.desktop()&&inputmask.dates(e)}catch(e){window.PopMechanic.debugMode&&console.error("Error setting inputmask:",e)}},onSuccess:function(e,t,n){var r=!1;return new Promise((function(t){n=n||window.PopMechanic.leads[window.PopMechanic.leads.length-1],e.find("[data-popmechanic-var]").each((function(){var e=cash(this),t=e.attr("data-popmechanic-var");0===t.indexOf("customs")&&(r=!0),e.text(util.propertyByPath(n,t))})),r?(cash("."+CONFIG.CSS_PREFIX+"close").on("click",(function(){t()})),cash(document).on("keyup",(function(e){27==e.keyCode&&t()})),cash("."+CONFIG.CSS_PREFIX+"js-paranja").on("click",(function(){t()}))):t()}))},onClose:function(e,t,n){n.success||(Dispatcher.trigger("cancel",{form:t.form}),Session.setUncompleted(t.form.id),event.push({type:"lead-cancel",form:this._view.form.id}))}}),LeadBehavior=inherit(AbstractLeadBehavior,{_bindEvents:function(){var e=this;this._$elem.find("[data-"+CONFIG.CSS_PREFIX+"submit]").on("click",(function(t){e._submit(t)})),this._$elem.on("keyup",(function(t){13==t.keyCode&&"textarea"!==t.target.type.toLowerCase()&&e._submit(t)})),this._$elem.find("form").on("submit",(function(e){e.preventDefault()}))}}),LeadOnClose=inherit(AbstractLeadBehavior,{_canSubmit:!1,_bindEvents:function(){var e=this;this._$elem.find("[data-popmechanic-submit]").on("click",(function(){e._canSubmit=!0})),this._$elem.find("[data-popmechanic-submit-close]").on("click",(function(){e._canSubmit=!0,e._view.close(!0)}))},onBeforeClose:function(e,t,n){return this._showSuccess=n.showSuccess,this._submit()}}),MultiscreenBehavior=inherit(AbstractBehavior$1,{onShow:function(e,t){e.find("[rel=screen], [data-target=screen]").on("click",(function(n){var r,i,o=e.find(cash(this).attr("href")),a=e.find(".popmechanic-screen").filterVisible(),s=e.find("#popmechanic-form-"+t.form.id),c=!0;if(a.find("[data-popmechanic-input]").each((function(){var e=cash(this),t=e.attr("data-popmechanic-input"),n=e.data(CONFIG.CSS_PREFIX+"type"),r=void 0!==e.attr("data-popmechanic-required"),i=validators.fieldValidators[t]&&!validators.fieldValidators[t].test(e.val()),o=validators.fieldTypeValidators[n]&&!validators.fieldTypeValidators[n].test(e.val()),a=r&&"checkbox"===e.attr("type")&&!e.is(":checked"),s=r&&!e.val();(i||o||a||s)&&(c=!1,e.addClass("popmechanic-invalid"))})),!c&&!cash(n.target).attr("data-popmechanic-novalidate"))return!1;o.show(),r=o.outerWidth(),i=o.outerHeight(),o.hide(),s.animate({width:r,height:i}),a.animate({opacity:0},(function(){this.hide(),o.css({opacity:0}).show().animate({opacity:1},(function(){if(o.data("onshow"))try{new Function(o.data("onshow"))()}catch(e){}}))})),n.preventDefault(),n.stopPropagation()}))}}),BASE_WRAPPER_CLASS=CONFIG.CSS_PREFIX+"js-wrapper",ANIMATION_WRAPPER_CLASS=CONFIG.CSS_PREFIX+"js-animation-wrapper",AbstractPositioner=function(e){var t=e.settings,n=e.id,r=e.runAnimation;this._settings=t,this._id=n,this._runAnimation=r,this.onRender=this.onRender.bind(this),this.onShow=this.onShow.bind(this),this.onClose=this.onClose.bind(this)};function getCssPropertyWithUnits(e){return"number"==typeof e?e+"px":"string"!=typeof e?0:-1!==e.indexOf("%")?e:(parseFloat(e)||0)+"px"}AbstractPositioner.prototype._initBaseWrapper=function(){return cash('<div class="'+BASE_WRAPPER_CLASS+'" />')},AbstractPositioner.prototype._getBaseWrapper=function(e){return e.find("."+BASE_WRAPPER_CLASS)},AbstractPositioner.prototype._initAnimationWrapper=function(){return cash('<div class="'+ANIMATION_WRAPPER_CLASS+'" />')},AbstractPositioner.prototype._getAnimationWrapper=function(e){return e.find("."+ANIMATION_WRAPPER_CLASS)},AbstractPositioner.prototype.onRender=function(){},AbstractPositioner.prototype.onShow=function(e,t,n){},AbstractPositioner.prototype.onClose=function(e){};var STATIC_STYLES={top:{top:0,left:"50%",transform:"translate(-50%, 0)"},left:{left:0,top:"50%",transform:"translate(0, -50%)"},right:{right:0,top:"50%",transform:"translate(0, -50%)"},bottom:{bottom:0,left:"50%",transform:"translate(-50%, 0)"},"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},center:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},CLICKABLE_OVERLAY_CLASS=CONFIG.CSS_PREFIX+"js-clickable-overlay",WRAPPER_BASE_STYLES={display:"block",textAlign:"left",maxHeight:"100%",maxWidth:"100%"},PARANJA_POSITION_STYLES={position:"fixed",top:0,left:0,right:0,bottom:0,height:"auto",minHeight:0,overflow:"auto",zIndex:100000001},WindowPositioner=function(e){function t(t){e.call(this,t),this._paranjaId=CONFIG.CSS_PREFIX+"paranja-"+this._id,this._getParanja=this._getParanja.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._handleKeyUp=function(){},t.prototype._getBaseWrapperStyles=function(){var e=_.extend({},{zIndex:100000002},STATIC_STYLES[this._settings.position]);return-1!==this._settings.position.indexOf("top")&&(e.marginTop=getCssPropertyWithUnits(this._settings.vertical_offset)),-1!==this._settings.position.indexOf("bottom")&&(e.marginBottom=getCssPropertyWithUnits(this._settings.vertical_offset)),-1!==this._settings.position.indexOf("left")&&(e.marginLeft=getCssPropertyWithUnits(this._settings.horizontal_offset)),-1!==this._settings.position.indexOf("right")&&(e.marginRight=getCssPropertyWithUnits(this._settings.horizontal_offset)),"center"===this._settings.position?e.position="absolute":e.position="fixed",e},t.prototype._initParanja=function(){return cash('<div class="'+CONFIG.CSS_PREFIX+'js-paranja" id="'+this._paranjaId+'">').css(_.extend({},PARANJA_POSITION_STYLES,{backgroundColor:this._settings.paranja_color,opacity:"0",transition:"opacity "+CONFIG.ANIMATION_SPEED+"ms"}))},t.prototype._getParanja=function(e){return e.find("#"+this._paranjaId)},t.prototype._getClickableOverlay=function(e){return e.find("."+CLICKABLE_OVERLAY_CLASS)},t.prototype._initWrappers=function(e){var t=this._initBaseWrapper();t.css(_.extend({},WRAPPER_BASE_STYLES,this._getBaseWrapperStyles()));var n=this._initAnimationWrapper();n.append(t),e.append(n);var r=null,i=null;return"center"===this._settings.position&&(r=this._initParanja(),i=cash('<div class="'+CLICKABLE_OVERLAY_CLASS+'" />'),n.append(i),e.append(r)),{$paranja:r,$animationWrapper:n,$baseWrapper:t,$clickableOverlay:i}},t.prototype.onRender=function(){var e=this;return new Promise((function(t,n){if(isOverlayBlocked()||isOverlayPresent()&&!e._settings.allow_overlay)return n(getRejectMessage(e._id));addOverlay(e._id,e._settings.allow_overlay),t("OK")}))},t.prototype.onShow=function(e,t,n){var r=this;return new Promise((function(i){var o=r._initWrappers(t),a=o.$paranja,s=o.$animationWrapper,c=o.$baseWrapper,u=o.$clickableOverlay;r._handleKeyUp=function(e){27===e.keyCode&&n()},cash(document).on("keyup",r._handleKeyUp),"center"===r._settings.position&&(disableScroll(),e.css({position:"relative"}),s.css(_.extend({},PARANJA_POSITION_STYLES,{pointerEvents:"all"})),a.css({zIndex:1e8,opacity:r._settings.paranja_opacity})),c.append(e),r._runAnimation(s,r._settings.animation_in,(function(){a&&u.on("click",(function(){n(!1)})),i("OK")}))}))},t.prototype.onClose=function(e){var t=this,n=t._getAnimationWrapper(e),r=t._getBaseWrapper(e),i=t._getParanja(e),o=t._getClickableOverlay(e);return removeOverlay(t._id),new Promise((function(e){t._runAnimation(n,t._settings.animation_out,(function(){r.remove(),n.css({position:"static",height:0,minHeight:0,overflow:"visible"}),i?(i.css({opacity:0}),setTimeout((function(){i.remove(),o.remove(),enableScroll(),cash(document).off("keyup",t._handleKeyUp),e()}),CONFIG.ANIMATION_SPEED)):(enableScroll(),cash(document).off("keyup",t._handleKeyUp),e())}))})).catch((function(){i&&(i.remove(),o.remove()),cash(document).off("keyup",t._handleKeyUp)}))},t}(AbstractPositioner),top="top",bottom="bottom",right="right",left="left",auto="auto",basePlacements=[top,bottom,right,left],start="start",end="end",clippingParents="clippingParents",viewport="viewport",popper="popper",reference="reference",variationPlacements=basePlacements.reduce((function(e,t){return e.concat([t+"-"+start,t+"-"+end])}),[]),placements=[].concat(basePlacements,[auto]).reduce((function(e,t){return e.concat([t,t+"-"+start,t+"-"+end])}),[]),beforeRead="beforeRead",read="read",afterRead="afterRead",beforeMain="beforeMain",main="main",afterMain="afterMain",beforeWrite="beforeWrite",write="write",afterWrite="afterWrite",modifierPhases=[beforeRead,read,afterRead,beforeMain,main,afterMain,beforeWrite,write,afterWrite];function getNodeName(e){return e?(e.nodeName||"").toLowerCase():null}function getWindow(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function isElement(e){return e instanceof getWindow(e).Element||e instanceof Element}function isHTMLElement(e){return e instanceof getWindow(e).HTMLElement||e instanceof HTMLElement}function isShadowRoot(e){return"undefined"!=typeof ShadowRoot&&(e instanceof getWindow(e).ShadowRoot||e instanceof ShadowRoot)}function applyStyles(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e];isHTMLElement(i)&&getNodeName(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))}function effect$2(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],i=t.attributes[e]||{},o=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});isHTMLElement(r)&&getNodeName(r)&&(Object.assign(r.style,o),Object.keys(i).forEach((function(e){r.removeAttribute(e)})))}))}}var applyStyles$1={name:"applyStyles",enabled:!0,phase:"write",fn:applyStyles,effect:effect$2,requires:["computeStyles"]};function getBasePlacement(e){return e.split("-")[0]}var round$1=Math.round;function getBoundingClientRect(e,t){void 0===t&&(t=!1);var n=e.getBoundingClientRect(),r=1,i=1;return isHTMLElement(e)&&t&&(r=n.width/e.offsetWidth||1,i=n.height/e.offsetHeight||1),{width:round$1(n.width/r),height:round$1(n.height/i),top:round$1(n.top/i),right:round$1(n.right/r),bottom:round$1(n.bottom/i),left:round$1(n.left/r),x:round$1(n.left/r),y:round$1(n.top/i)}}function getLayoutRect(e){var t=getBoundingClientRect(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function contains(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&isShadowRoot(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function getComputedStyle(e){return getWindow(e).getComputedStyle(e)}function isTableElement(e){return["table","td","th"].indexOf(getNodeName(e))>=0}function getDocumentElement(e){return((isElement(e)?e.ownerDocument:e.document)||window.document).documentElement}function getParentNode(e){return"html"===getNodeName(e)?e:e.assignedSlot||e.parentNode||(isShadowRoot(e)?e.host:null)||getDocumentElement(e)}function getTrueOffsetParent(e){return isHTMLElement(e)&&"fixed"!==getComputedStyle(e).position?e.offsetParent:null}function getContainingBlock(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&isHTMLElement(e)&&"fixed"===getComputedStyle(e).position)return null;for(var n=getParentNode(e);isHTMLElement(n)&&["html","body"].indexOf(getNodeName(n))<0;){var r=getComputedStyle(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}function getOffsetParent(e){for(var t=getWindow(e),n=getTrueOffsetParent(e);n&&isTableElement(n)&&"static"===getComputedStyle(n).position;)n=getTrueOffsetParent(n);return n&&("html"===getNodeName(n)||"body"===getNodeName(n)&&"static"===getComputedStyle(n).position)?t:n||getContainingBlock(e)||t}function getMainAxisFromPlacement(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}var max=Math.max,min=Math.min,round=Math.round;function within(e,t,n){return max(e,min(t,n))}function getFreshSideObject(){return{top:0,right:0,bottom:0,left:0}}function mergePaddingObject(e){return Object.assign({},getFreshSideObject(),e)}function expandToHashMap(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}var toPaddingObject=function(e,t){return mergePaddingObject("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:expandToHashMap(e,basePlacements))};function arrow(e){var t,n=e.state,r=e.name,i=e.options,o=n.elements.arrow,a=n.modifiersData.popperOffsets,s=getBasePlacement(n.placement),c=getMainAxisFromPlacement(s),u=[left,right].indexOf(s)>=0?"height":"width";if(o&&a){var l=toPaddingObject(i.padding,n),d=getLayoutRect(o),f="y"===c?top:left,h="y"===c?bottom:right,p=n.rects.reference[u]+n.rects.reference[c]-a[c]-n.rects.popper[u],m=a[c]-n.rects.reference[c],g=getOffsetParent(o),v=g?"y"===c?g.clientHeight||0:g.clientWidth||0:0,_=p/2-m/2,y=l[f],b=v-d[u]-l[h],S=v/2-d[u]/2+_,w=within(y,S,b),I=c;n.modifiersData[r]=((t={})[I]=w,t.centerOffset=w-S,t)}}function effect$1(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&contains(t.elements.popper,r)&&(t.elements.arrow=r)}var arrow$1={name:"arrow",enabled:!0,phase:"main",fn:arrow,effect:effect$1,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},unsetSides={top:"auto",right:"auto",bottom:"auto",left:"auto"};function roundOffsetsByDPR(e){var t=e.x,n=e.y,r=window.devicePixelRatio||1;return{x:round(round(t*r)/r)||0,y:round(round(n*r)/r)||0}}function mapToStyles(e){var t,n=e.popper,r=e.popperRect,i=e.placement,o=e.offsets,a=e.position,s=e.gpuAcceleration,c=e.adaptive,u=e.roundOffsets,l=!0===u?roundOffsetsByDPR(o):"function"==typeof u?u(o):o,d=l.x,f=void 0===d?0:d,h=l.y,p=void 0===h?0:h,m=o.hasOwnProperty("x"),g=o.hasOwnProperty("y"),v=left,_=top,y=window;if(c){var b=getOffsetParent(n),S="clientHeight",w="clientWidth";b===getWindow(n)&&"static"!==getComputedStyle(b=getDocumentElement(n)).position&&(S="scrollHeight",w="scrollWidth"),b=b,i===top&&(_=bottom,p-=b[S]-r.height,p*=s?1:-1),i===left&&(v=right,f-=b[w]-r.width,f*=s?1:-1)}var I,C=Object.assign({position:a},c&&unsetSides);return s?Object.assign({},C,((I={})[_]=g?"0":"",I[v]=m?"0":"",I.transform=(y.devicePixelRatio||1)<2?"translate("+f+"px, "+p+"px)":"translate3d("+f+"px, "+p+"px, 0)",I)):Object.assign({},C,((t={})[_]=g?p+"px":"",t[v]=m?f+"px":"",t.transform="",t))}function computeStyles(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=void 0===r||r,o=n.adaptive,a=void 0===o||o,s=n.roundOffsets,c=void 0===s||s,u={placement:getBasePlacement(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,mapToStyles(Object.assign({},u,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,mapToStyles(Object.assign({},u,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}var computeStyles$1={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:computeStyles,data:{}},passive={passive:!0};function effect(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,o=void 0===i||i,a=r.resize,s=void 0===a||a,c=getWindow(t.elements.popper),u=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&u.forEach((function(e){e.addEventListener("scroll",n.update,passive)})),s&&c.addEventListener("resize",n.update,passive),function(){o&&u.forEach((function(e){e.removeEventListener("scroll",n.update,passive)})),s&&c.removeEventListener("resize",n.update,passive)}}var eventListeners={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:effect,data:{}},hash$1={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,(function(e){return hash$1[e]}))}var hash={start:"end",end:"start"};function getOppositeVariationPlacement(e){return e.replace(/start|end/g,(function(e){return hash[e]}))}function getWindowScroll(e){var t=getWindow(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function getWindowScrollBarX(e){return getBoundingClientRect(getDocumentElement(e)).left+getWindowScroll(e).scrollLeft}function getViewportRect(e){var t=getWindow(e),n=getDocumentElement(e),r=t.visualViewport,i=n.clientWidth,o=n.clientHeight,a=0,s=0;return r&&(i=r.width,o=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(a=r.offsetLeft,s=r.offsetTop)),{width:i,height:o,x:a+getWindowScrollBarX(e),y:s}}function getDocumentRect(e){var t,n=getDocumentElement(e),r=getWindowScroll(e),i=null==(t=e.ownerDocument)?void 0:t.body,o=max(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),a=max(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-r.scrollLeft+getWindowScrollBarX(e),c=-r.scrollTop;return"rtl"===getComputedStyle(i||n).direction&&(s+=max(n.clientWidth,i?i.clientWidth:0)-o),{width:o,height:a,x:s,y:c}}function isScrollParent(e){var t=getComputedStyle(e),n=t.overflow,r=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function getScrollParent(e){return["html","body","#document"].indexOf(getNodeName(e))>=0?e.ownerDocument.body:isHTMLElement(e)&&isScrollParent(e)?e:getScrollParent(getParentNode(e))}function listScrollParents(e,t){var n;void 0===t&&(t=[]);var r=getScrollParent(e),i=r===(null==(n=e.ownerDocument)?void 0:n.body),o=getWindow(r),a=i?[o].concat(o.visualViewport||[],isScrollParent(r)?r:[]):r,s=t.concat(a);return i?s:s.concat(listScrollParents(getParentNode(a)))}function rectToClientRect(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function getInnerBoundingClientRect(e){var t=getBoundingClientRect(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}function getClientRectFromMixedType(e,t){return t===viewport?rectToClientRect(getViewportRect(e)):isHTMLElement(t)?getInnerBoundingClientRect(t):rectToClientRect(getDocumentRect(getDocumentElement(e)))}function getClippingParents(e){var t=listScrollParents(getParentNode(e)),n=["absolute","fixed"].indexOf(getComputedStyle(e).position)>=0&&isHTMLElement(e)?getOffsetParent(e):e;return isElement(n)?t.filter((function(e){return isElement(e)&&contains(e,n)&&"body"!==getNodeName(e)})):[]}function getClippingRect(e,t,n){var r="clippingParents"===t?getClippingParents(e):[].concat(t),i=[].concat(r,[n]),o=i[0],a=i.reduce((function(t,n){var r=getClientRectFromMixedType(e,n);return t.top=max(r.top,t.top),t.right=min(r.right,t.right),t.bottom=min(r.bottom,t.bottom),t.left=max(r.left,t.left),t}),getClientRectFromMixedType(e,o));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function getVariation(e){return e.split("-")[1]}function computeOffsets(e){var t,n=e.reference,r=e.element,i=e.placement,o=i?getBasePlacement(i):null,a=i?getVariation(i):null,s=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(o){case top:t={x:s,y:n.y-r.height};break;case bottom:t={x:s,y:n.y+n.height};break;case right:t={x:n.x+n.width,y:c};break;case left:t={x:n.x-r.width,y:c};break;default:t={x:n.x,y:n.y}}var u=o?getMainAxisFromPlacement(o):null;if(null!=u){var l="y"===u?"height":"width";switch(a){case start:t[u]=t[u]-(n[l]/2-r[l]/2);break;case end:t[u]=t[u]+(n[l]/2-r[l]/2)}}return t}function detectOverflow(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=void 0===r?e.placement:r,o=n.boundary,a=void 0===o?clippingParents:o,s=n.rootBoundary,c=void 0===s?viewport:s,u=n.elementContext,l=void 0===u?popper:u,d=n.altBoundary,f=void 0!==d&&d,h=n.padding,p=void 0===h?0:h,m=mergePaddingObject("number"!=typeof p?p:expandToHashMap(p,basePlacements)),g=l===popper?reference:popper,v=e.elements.reference,_=e.rects.popper,y=e.elements[f?g:l],b=getClippingRect(isElement(y)?y:y.contextElement||getDocumentElement(e.elements.popper),a,c),S=getBoundingClientRect(v),w=computeOffsets({reference:S,element:_,strategy:"absolute",placement:i}),I=rectToClientRect(Object.assign({},_,w)),C=l===popper?I:S,P={top:b.top-C.top+m.top,bottom:C.bottom-b.bottom+m.bottom,left:b.left-C.left+m.left,right:C.right-b.right+m.right},E=e.modifiersData.offset;if(l===popper&&E){var k=E[i];Object.keys(P).forEach((function(e){var t=[right,bottom].indexOf(e)>=0?1:-1,n=[top,bottom].indexOf(e)>=0?"y":"x";P[e]+=k[n]*t}))}return P}function computeAutoPlacement(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=n.boundary,o=n.rootBoundary,a=n.padding,s=n.flipVariations,c=n.allowedAutoPlacements,u=void 0===c?placements:c,l=getVariation(r),d=l?s?variationPlacements:variationPlacements.filter((function(e){return getVariation(e)===l})):basePlacements,f=d.filter((function(e){return u.indexOf(e)>=0}));0===f.length&&(f=d);var h=f.reduce((function(t,n){return t[n]=detectOverflow(e,{placement:n,boundary:i,rootBoundary:o,padding:a})[getBasePlacement(n)],t}),{});return Object.keys(h).sort((function(e,t){return h[e]-h[t]}))}function getExpandedFallbackPlacements(e){if(getBasePlacement(e)===auto)return[];var t=getOppositePlacement(e);return[getOppositeVariationPlacement(e),t,getOppositeVariationPlacement(t)]}function flip(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,o=void 0===i||i,a=n.altAxis,s=void 0===a||a,c=n.fallbackPlacements,u=n.padding,l=n.boundary,d=n.rootBoundary,f=n.altBoundary,h=n.flipVariations,p=void 0===h||h,m=n.allowedAutoPlacements,g=t.options.placement,v=getBasePlacement(g),_=c||(v===g||!p?[getOppositePlacement(g)]:getExpandedFallbackPlacements(g)),y=[g].concat(_).reduce((function(e,n){return e.concat(getBasePlacement(n)===auto?computeAutoPlacement(t,{placement:n,boundary:l,rootBoundary:d,padding:u,flipVariations:p,allowedAutoPlacements:m}):n)}),[]),b=t.rects.reference,S=t.rects.popper,w=new Map,I=!0,C=y[0],P=0;P<y.length;P++){var E=y[P],k=getBasePlacement(E),x=getVariation(E)===start,O=[top,bottom].indexOf(k)>=0,T=O?"width":"height",R=detectOverflow(t,{placement:E,boundary:l,rootBoundary:d,altBoundary:f,padding:u}),F=O?x?right:left:x?bottom:top;b[T]>S[T]&&(F=getOppositePlacement(F));var A=getOppositePlacement(F),D=[];if(o&&D.push(R[k]<=0),s&&D.push(R[F]<=0,R[A]<=0),D.every((function(e){return e}))){C=E,I=!1;break}w.set(E,D)}if(I)for(var M=function(e){var t=y.find((function(t){var n=w.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return C=t,"break"},N=p?3:1;N>0;N--){if("break"===M(N))break}t.placement!==C&&(t.modifiersData[r]._skip=!0,t.placement=C,t.reset=!0)}}var flip$1={name:"flip",enabled:!0,phase:"main",fn:flip,requiresIfExists:["offset"],data:{_skip:!1}};function getSideOffsets(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function isAnySideFullyClipped(e){return[top,right,bottom,left].some((function(t){return e[t]>=0}))}function hide(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,o=t.modifiersData.preventOverflow,a=detectOverflow(t,{elementContext:"reference"}),s=detectOverflow(t,{altBoundary:!0}),c=getSideOffsets(a,r),u=getSideOffsets(s,i,o),l=isAnySideFullyClipped(c),d=isAnySideFullyClipped(u);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:u,isReferenceHidden:l,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":l,"data-popper-escaped":d})}var hide$1={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:hide};function distanceAndSkiddingToXY(e,t,n){var r=getBasePlacement(e),i=[left,top].indexOf(r)>=0?-1:1,o="function"==typeof n?n(Object.assign({},t,{placement:e})):n,a=o[0],s=o[1];return a=a||0,s=(s||0)*i,[left,right].indexOf(r)>=0?{x:s,y:a}:{x:a,y:s}}function offset(e){var t=e.state,n=e.options,r=e.name,i=n.offset,o=void 0===i?[0,0]:i,a=placements.reduce((function(e,n){return e[n]=distanceAndSkiddingToXY(n,t.rects,o),e}),{}),s=a[t.placement],c=s.x,u=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=u),t.modifiersData[r]=a}var offset$1={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:offset};function popperOffsets(e){var t=e.state,n=e.name;t.modifiersData[n]=computeOffsets({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}var popperOffsets$1={name:"popperOffsets",enabled:!0,phase:"read",fn:popperOffsets,data:{}};function getAltAxis(e){return"x"===e?"y":"x"}function preventOverflow(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,o=void 0===i||i,a=n.altAxis,s=void 0!==a&&a,c=n.boundary,u=n.rootBoundary,l=n.altBoundary,d=n.padding,f=n.tether,h=void 0===f||f,p=n.tetherOffset,m=void 0===p?0:p,g=detectOverflow(t,{boundary:c,rootBoundary:u,padding:d,altBoundary:l}),v=getBasePlacement(t.placement),_=getVariation(t.placement),y=!_,b=getMainAxisFromPlacement(v),S=getAltAxis(b),w=t.modifiersData.popperOffsets,I=t.rects.reference,C=t.rects.popper,P="function"==typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,E={x:0,y:0};if(w){if(o||s){var k="y"===b?top:left,x="y"===b?bottom:right,O="y"===b?"height":"width",T=w[b],R=w[b]+g[k],F=w[b]-g[x],A=h?-C[O]/2:0,D=_===start?I[O]:C[O],M=_===start?-C[O]:-I[O],N=t.elements.arrow,$=h&&N?getLayoutRect(N):{width:0,height:0},B=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:getFreshSideObject(),j=B[k],H=B[x],L=within(0,I[O],$[O]),U=y?I[O]/2-A-L-j-P:D-L-j-P,W=y?-I[O]/2+A+L+H+P:M+L+H+P,V=t.elements.arrow&&getOffsetParent(t.elements.arrow),q=V?"y"===b?V.clientTop||0:V.clientLeft||0:0,G=t.modifiersData.offset?t.modifiersData.offset[t.placement][b]:0,X=w[b]+U-G-q,z=w[b]+W-G;if(o){var K=within(h?min(R,X):R,T,h?max(F,z):F);w[b]=K,E[b]=K-T}if(s){var Y="x"===b?top:left,J="x"===b?bottom:right,Q=w[S],Z=Q+g[Y],ee=Q-g[J],te=within(h?min(Z,X):Z,Q,h?max(ee,z):ee);w[S]=te,E[S]=te-Q}}t.modifiersData[r]=E}}var preventOverflow$1={name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]};function getHTMLElementScroll(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function getNodeScroll(e){return e!==getWindow(e)&&isHTMLElement(e)?getHTMLElementScroll(e):getWindowScroll(e)}function isElementScaled(e){var t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,r=t.height/e.offsetHeight||1;return 1!==n||1!==r}function getCompositeRect(e,t,n){void 0===n&&(n=!1);var r=isHTMLElement(t),i=isHTMLElement(t)&&isElementScaled(t),o=getDocumentElement(t),a=getBoundingClientRect(e,i),s={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(r||!r&&!n)&&(("body"!==getNodeName(t)||isScrollParent(o))&&(s=getNodeScroll(t)),isHTMLElement(t)?((c=getBoundingClientRect(t,!0)).x+=t.clientLeft,c.y+=t.clientTop):o&&(c.x=getWindowScrollBarX(o))),{x:a.left+s.scrollLeft-c.x,y:a.top+s.scrollTop-c.y,width:a.width,height:a.height}}function order(e){var t=new Map,n=new Set,r=[];return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||function e(i){n.add(i.name),[].concat(i.requires||[],i.requiresIfExists||[]).forEach((function(r){if(!n.has(r)){var i=t.get(r);i&&e(i)}})),r.push(i)}(e)})),r}function orderModifiers(e){var t=order(e);return modifierPhases.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}function debounce(e){var t;return function(){return t||(t=new Promise((function(n){Promise.resolve().then((function(){t=void 0,n(e())}))}))),t}}function mergeByName(e){var t=e.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}var DEFAULT_OPTIONS={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var e=arguments,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=e[r];return!n.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function popperGenerator(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,i=t.defaultOptions,o=void 0===i?DEFAULT_OPTIONS:i;return function(e,t,n){void 0===n&&(n=o);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,o),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},a=[],s=!1,c={state:i,setOptions:function(n){u(),i.options=Object.assign({},o,i.options,n),i.scrollParents={reference:isElement(e)?listScrollParents(e):e.contextElement?listScrollParents(e.contextElement):[],popper:listScrollParents(t)};var s=orderModifiers(mergeByName([].concat(r,i.options.modifiers)));return i.orderedModifiers=s.filter((function(e){return e.enabled})),i.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,o=e.effect;if("function"==typeof o){var s=o({state:i,name:t,instance:c,options:r});a.push(s||function(){})}})),c.update()},forceUpdate:function(){if(!s){var e=i.elements,t=e.reference,n=e.popper;if(areValidElements(t,n)){i.rects={reference:getCompositeRect(t,getOffsetParent(n),"fixed"===i.options.strategy),popper:getLayoutRect(n)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach((function(e){return i.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<i.orderedModifiers.length;r++)if(!0!==i.reset){var o=i.orderedModifiers[r],a=o.fn,u=o.options,l=void 0===u?{}:u,d=o.name;"function"==typeof a&&(i=a({state:i,options:l,name:d,instance:c})||i)}else i.reset=!1,r=-1}}},update:debounce((function(){return new Promise((function(e){c.forceUpdate(),e(i)}))})),destroy:function(){u(),s=!0}};if(!areValidElements(e,t))return c;function u(){a.forEach((function(e){return e()})),a=[]}return c.setOptions(n).then((function(e){!s&&n.onFirstUpdate&&n.onFirstUpdate(e)})),c}}var defaultModifiers=[eventListeners,popperOffsets$1,computeStyles$1,applyStyles$1,offset$1,flip$1,preventOverflow$1,arrow$1,hide$1],createPopper=popperGenerator({defaultModifiers:defaultModifiers});function getIsVerticalElementPlacement(e){return-1!==e.indexOf("top")||-1!==e.indexOf("bottom")}function getIsHorizontalElementPlacement(e){return-1!==e.indexOf("left")||-1!==e.indexOf("right")}function getIsEndElementPlacement(e){return-1!==e.indexOf("end")}function convertOffsetsToPopperJs(e,t,n){var r=0,i=0;return getIsVerticalElementPlacement(e)?(i=n,r=t):getIsHorizontalElementPlacement(e)&&(i=t,r=n),getIsEndElementPlacement(e)&&(r*=-1),[r,i]}var PopperPositioner=function(e){function t(t){e.call(this,t),this._targetElementCheckingInterval=100,this._targetElementCheckingIntervalId=null,this._popper=null,this._getTargetElement=this._getTargetElement.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._getTargetElement=function(){return cash(this._settings.target)[0]},t.prototype._initWrappers=function(e){var t=this._initBaseWrapper();t.css({display:"block",textAlign:"left",maxHeight:"100%",maxWidth:"100%",zIndex:99999998});var n=this._initAnimationWrapper();return n.css({position:"relative",zIndex:1}),n.append(t),e.append(n),{$animationWrapper:n,$baseWrapper:t}},t.prototype._initPopper=function(e){var t=this;t._popper=createPopper(t._getTargetElement(),e,{placement:t._settings.element_position,modifiers:[{name:"offset",options:{offset:function(e){return convertOffsetsToPopperJs(e.placement,t._settings.element_horizontal_offset,t._settings.element_vertical_offset)}}}]})},t.prototype._clearPopper=function(){this._popper&&(this._popper.destroy(),this._popper=null)},t.prototype.onRender=function(){var e=this;return new Promise((function(t){var n=setInterval((function(){e._getTargetElement()&&(clearInterval(n),t("OK"))}),e._targetElementCheckingInterval)}))},t.prototype.onShow=function(e,t){var n=this;return new Promise((function(r){var i=n._initWrappers(t),o=i.$baseWrapper,a=i.$animationWrapper;o.append(e),n._settings.show_legal&&"0"!==n._settings.show_legal&&n._showLegal(e),n._initPopper(a[0]),n._runAnimation(a,n._settings.animation_in,(function(){n._targetElementCheckingIntervalId=setInterval((function(){var e=n._getTargetElement();!e&&t.filterVisible().length&&n._popper&&(t.hide(),n._clearPopper()),!e||t.filterVisible().length||n._popper||(t.show(),n._initPopper(a[0]))}),n._targetElementCheckingInterval),r()}))}))},t.prototype.onClose=function(e){var t=this,n=t._getAnimationWrapper(e),r=t._getBaseWrapper(e);return new Promise((function(e){t._runAnimation(n,t._settings.animation_out,(function(){r.remove(),n.css({position:"static",height:0,minHeight:0,overflow:"visible"}),t._clearPopper(),t._checkingTargetElementIntervalId&&clearInterval(t._checkingTargetElementIntervalId),e()}))})).catch((function(){t._clearPopper()}))},t}(AbstractPositioner),PartscreenBehavior=inherit(AbstractConditionedBehavior,{__constructor:function(e){this.__base(e);var t=e.form.settings.behavior_settings.partscreen||{},n=this._getDeviceSettings(t);this.settings=_.defaults({},n,t,{animation_in:"fadeIn",animation_out:"fadeOut",paranja_opacity:.3,paranja_color:"black",show_legal:!1,position:"center",horizontal_offset:0,vertical_offset:0,allow_overlay:!1,target:"window",element_position:"right",element_horizontal_offset:0,element_vertical_offset:0}),"desktop"===this._device||n.hasOwnProperty("horizontal_offset")||(this.settings.horizontal_offset=0),"desktop"===this._device||n.hasOwnProperty("vertical_offset")||(this.settings.vertical_offset=0);var r={id:this.formId,settings:this.settings,runAnimation:this._runAnimation};this._positioner="window"===this.settings.target?new WindowPositioner(r):new PopperPositioner(r)},_positioner:null,_showLegal:function(e){this.settings.show_legal&&"0"!==this.settings.show_legal&&e.find(".js-popmechanic-legal-aux").css({position:"absolute",top:"100%",left:"0",right:"0",color:"white",textAlign:"center",display:"block"})},onRender:function(){return this._positioner.onRender()},onShow:function(e,t){var n=this._getForm(e),r=this._getContainer(e);this.settings.show_legal&&"0"!==this.settings.show_legal&&this._showLegal(n),Promise.resolve(this._positioner.onShow(n,r,t.close)).then((function(){n.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))}))}))},onClose:function(e){var t=this._getContainer(e);return this._positioner.onClose(t)}}),PopupBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e);var t=_.defaults({},e.form.settings.behavior_settings.popup,{paranja_opacity:.3,animation_type:"slide",animation_settings:{from:"top"},show_legal:!1});this.animationType=t.animation_type,this.animationSettings=t.animation_settings,this.paranjaOpacity=t.paranja_opacity,this.showLegal=t.show_legal&&"0"!==t.show_legal},_prepareAnimation:function(e){if("slide"===this.animationType){var t={};t["margin-"+this.animationSettings.from]=-Math.max(window.innerWidth,window.innerHeight),e.css(t)}else this._initialOpacity=e.css("opacity")||1,e.css({opacity:0})},_runAnimation:function(e,t){var n={};"slide"===this.animationType?n["margin-"+this.animationSettings.from]=0:n.opacity=this._initialOpacity,e.animate(n,{duration:CONFIG.ANIMATION_SPEED,queue:!1,always:t})},onRender:function(e,t,n){var r=this._filterForm(e),i=cash('<div class="'+CONFIG.CSS_PREFIX+'js-wrapper"></div>');this._$formWrapper=i,n.append(i),this._$paranja=cash('<div class="'+CONFIG.CSS_PREFIX+'js-paranja" id="'+CONFIG.CSS_PREFIX+"paranja-"+this.formId+'">').css({display:"block",position:"absolute",top:"0",left:"0",bottom:"0",right:"0","background-color":"black",opacity:"0",pointerEvents:"all","z-index":1e6}),i.append(this._$paranja),i.css({position:"relative","text-align":"center",margin:"0",top:0,left:0,right:0}),r.css({display:"inline-block","z-index":100000002,position:"relative","vertical-align":"middle","text-align":"left"}),this._prepareAnimation(i)},onShow:function(e,t){var n=this._getForm(e),r=this._$formWrapper,i=this._getContainer(e),o=this._$paranja,a=this;disableScroll(),this._$formWrapper.append(n),setTimeout((function(){if(i.css({position:"fixed",top:0,left:0,right:0,bottom:0,height:"auto","min-height":0,overflow:"auto","z-index":1e8}),a.showLegal){var e=document.createElement("DIV");e.style.marginLeft="calc(1px)",e.style.getPropertyValue("margin-left"),n.find(".js-popmechanic-legal-aux").css({position:"absolute",top:"100%",left:"0",right:"0",color:"white",textAlign:"center",display:"block"})}a._$vaHelper=cash("<div></div>"),a._$vaHelper.css({height:window.innerHeight,display:"inline-block",width:0,"vertical-align":"middle"}).appendTo(r),cash(window).on("resize",(function(){a._$vaHelper.css({height:window.innerHeight})})),o.animate({opacity:a.paranjaOpacity},{duration:CONFIG.ANIMATION_SPEED,queue:!1}),a._runAnimation(a._$formWrapper,(function(){o.on("click",(function(){t.close(!1)})),n.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))}))})),cash(document).on("keyup",(function(e){27==e.keyCode&&t.close()}))}),10)},onClose:function(e){var t=this,n=this._getContainer(e);return new Promise((function(r){e.animate({top:"-50%"},CONFIG.ANIMATION_SPEED,(function(){t._$paranja.animate({opacity:"0"},CONFIG.ANIMATION_SPEED,(function(){t._$paranja.remove(),t._$vaHelper.remove(),t._$formWrapper.remove(),n.css({position:"static",height:0,"min-height":0}),enableScroll(),r()}))}))}))},onSuccess:function(){},onFail:function(){}}),PostTextBehavior=inherit(AbstractBehavior$1,{onSuccess:function(e){return new Promise((function(t){e.addClass(CONFIG.CSS_PREFIX+"success"),setTimeout(t,6e3)}))}});function reportSuccess(e){if(!window.PopMechanic.sampleSent){window.PopMechanic.sampleSent=!0;var t=Date.now()-window.PopMechanic.initStartedAt;(new Image).src=SPEEDTEST+"/check-reco?result=success"+(e?"&reason="+e:"")+"&t="+t+"&c="+window.PopMechanic.client+"&url="+encodeURIComponent(location.pathname)+"&_="+ +Date.now()}}function reportFailure(e){if(!window.PopMechanic.sampleSent){window.PopMechanic.sampleSent=!0;var t=Date.now()-window.PopMechanic.initStartedAt;(new Image).src=SPEEDTEST+"/check-reco?result=failure"+(e?"&reason="+e:"")+"&t="+t+"&c="+window.PopMechanic.client+"&url="+encodeURIComponent(location.pathname)+"&_="+ +Date.now()}}var lifecycle_es5={exports:{}};
/*!
	 Copyright 2018 Google Inc. All Rights Reserved.
	 Licensed under the Apache License, Version 2.0 (the "License");
	 you may not use this file except in compliance with the License.
	 You may obtain a copy of the License at

	     http://www.apache.org/licenses/LICENSE-2.0

	 Unless required by applicable law or agreed to in writing, software
	 distributed under the License is distributed on an "AS IS" BASIS,
	 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 See the License for the specific language governing permissions and
	 limitations under the License.
	*/!function(e,t){
/*! lifecycle.es5.js v0.1.1 */
e.exports=function(){var e=void 0;try{new EventTarget,e=!1}catch(t){e=!1}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a=function(){function e(){n(this,e),this._registry={}}return r(e,[{key:"addEventListener",value:function(e,t){this._getRegistry(e).push(t)}},{key:"removeEventListener",value:function(e,t){var n=this._getRegistry(e),r=n.indexOf(t);r>-1&&n.splice(r,1)}},{key:"dispatchEvent",value:function(e){return e.target=this,Object.freeze(e),this._getRegistry(e.type).forEach((function(t){return t(e)})),!0}},{key:"_getRegistry",value:function(e){return this._registry[e]=this._registry[e]||[]}}]),e}(),s=e?EventTarget:a,c=e?Event:function e(t){n(this,e),this.type=t},u=function(e){function t(e,r){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.newState=r.newState,i.oldState=r.oldState,i.originalEvent=r.originalEvent,i}return i(t,c),t}(),l="active",d="passive",f="hidden",h="frozen",p="terminated",m="object"===("undefined"==typeof safari?"undefined":t(safari))&&safari.pushNotification,g=["focus","blur","visibilitychange","freeze","resume","pageshow","onpageshow"in self?"pagehide":"unload"],v=function(e){return e.preventDefault(),e.returnValue="Are you sure?"},_=[[l,d,f,p],[l,d,f,h],[f,d,l],[h,f],[h,l],[h,d]].map((function(e){return e.reduce((function(e,t,n){return e[t]=n,e}),{})})),y=function(){return document.visibilityState===f?f:document.hasFocus()?l:d};return new(function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=y();return e._state=r,e._unsavedChanges=[],e._handleEvents=e._handleEvents.bind(e),g.forEach((function(t){return addEventListener(t,e._handleEvents,!0)})),m&&addEventListener("beforeunload",(function(t){e._safariBeforeUnloadTimeout=setTimeout((function(){t.defaultPrevented||t.returnValue.length>0||e._dispatchChangesIfNeeded(t,f)}),0)})),e}return i(t,s),r(t,[{key:"addUnsavedChanges",value:function(e){!this._unsavedChanges.indexOf(e)>-1&&(0===this._unsavedChanges.length&&addEventListener("beforeunload",v),this._unsavedChanges.push(e))}},{key:"removeUnsavedChanges",value:function(e){var t=this._unsavedChanges.indexOf(e);t>-1&&(this._unsavedChanges.splice(t,1),0===this._unsavedChanges.length&&removeEventListener("beforeunload",v))}},{key:"_dispatchChangesIfNeeded",value:function(e,t){if(t!==this._state)for(var n=function(e,t){for(var n,r=0;n=_[r];++r){var i=n[e],o=n[t];if(i>=0&&o>=0&&o>i)return Object.keys(n).slice(i,o+1)}return[]}(this._state,t),r=0;r<n.length-1;++r){var i=n[r],o=n[r+1];this._state=o,this.dispatchEvent(new u("statechange",{oldState:i,newState:o,originalEvent:e}))}}},{key:"_handleEvents",value:function(e){switch(m&&clearTimeout(this._safariBeforeUnloadTimeout),e.type){case"pageshow":case"resume":this._dispatchChangesIfNeeded(e,y());break;case"focus":this._dispatchChangesIfNeeded(e,l);break;case"blur":this._state===l&&this._dispatchChangesIfNeeded(e,y());break;case"pagehide":case"unload":this._dispatchChangesIfNeeded(e,e.persisted?h:p);break;case"visibilitychange":this._state!==h&&this._state!==p&&this._dispatchChangesIfNeeded(e,y());break;case"freeze":this._dispatchChangesIfNeeded(e,h)}}},{key:"state",get:function(){return this._state}},{key:"pageWasDiscarded",get:function(){return document.wasDiscarded||!1}}]),t}())}()}(lifecycle_es5);var pageLifecycle=lifecycle_es5.exports;function reportUnload(){if(!window.PopMechanic.sampleSent){window.PopMechanic.sampleSent=!0;var e=Date.now()-window.PopMechanic.initStartedAt,t=SPEEDTEST+"/check-reco?result=unknown&t="+e+"&c="+window.PopMechanic.client+"&url="+encodeURIComponent(location.pathname)+"&_="+ +Date.now();navigator.sendBeacon(t,"")}}var reportUnloadEnabled=!1,enableReportUnload=function(){reportUnloadEnabled||(reportUnloadEnabled=!0,pageLifecycle.addEventListener("statechange",(function(e){"terminated"===e.newState&&reportUnload()})))};function randInt(e,t){return void 0===t&&(t=0),Math.floor(t+Math.random()*(e-t))}var getFakePicture=function(e){return"https://picsum.photos/"+randInt(300,200)+"/"+randInt(300,200)+"?image="+e},recoIds={location:"",ids:[]},pendingRecoWidgets$1=[],fakeProductsList=[],EMPTY_RECO_ARR_ERROR_MSG="Recommendations array is empty, so the form will not be shown";function coinToss(){return!!Math.floor(Math.random()+.5)}function getFakeProduct(e,t){var n,r="Product "+randInt(1e5),i=randInt(1e5,1),o=coinToss?Math.round(i*(1+.5*Math.random())):i;return"number"!=typeof e&&(e=randInt(70,50)),{ids:(n={mindboxId:randInt(1e4)},n[t]=randInt(1e4),n),name:r,displayName:r,description:Array(randInt(6,4)).fill("lorem ipsum").join(" "),code:"Category",url:"#",pictureUrl:getFakePicture(e),price:i,oldPrice:o,manufacturer:{name:"Mfr"}}}function firstLetterToLower(e){if(!e)return"";var t=e[0],n=e.slice(1);return""+t.toLowerCase()+n}var RecoDataBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e),this.behaviorSettings=_.defaults({},e.form.settings.behavior_settings.reco_data,{shopId:"website",operations:[],productIdsCode:null,filterByOtherReco:!1,returnOptimizedPictures:!1}),this.currentEntityDataIds=[],this.onBeforeRenderRejectIsDebuggable=!1,this.behaviorSettings.shopId=firstLetterToLower(this.behaviorSettings.shopId),this._reportedMbError=!1,this._handleSuccess=this._handleSuccess.bind(this),this._handleError=this._handleError.bind(this),this._reportMbError=this._reportMbError.bind(this),this._parseMbError=this._parseMbError.bind(this),this._processQueue=this._processQueue.bind(this),this._sendRequest=this._sendRequest.bind(this),this._getFakeRecommendationsList=this._getFakeRecommendationsList.bind(this),this._reportSlaSuccess=this._reportSlaSuccess.bind(this),this._reportSlaFailure=this._reportSlaFailure.bind(this),this._setProductPriceAndDiscount=this._setProductPriceAndDiscount.bind(this),this._getEntityDataIds=this._getEntityDataIds.bind(this)},onInit:function(){this.behaviorSettings.operations.forEach((function(e){switch(e.recoTarget){case"Offer":e.recoType="product";break;case"Category":e.recoType="category";break;default:e.recoType="personal"}})),this.behaviorSettings.recoType=this.behaviorSettings.operations[0]?this.behaviorSettings.operations[0].recoType:"personal"},onTargetingReady:function(){window.PopMechanic.slaRequired=!0,pendingRecoWidgets$1.push(this.formId),enableReportUnload()},onBeforeRender:function(e,t){var n=this,r=n.behaviorSettings.operations.filter((function(e){return!e.disabled}));return this._getEntityDataIds(t,r[0]&&r[0].recoType).then((function(e){return n.currentEntityDataIds=e,function(){var e=Promise.resolve();n.sendArea=t.attr("data-popmechanic-area")||window.mindboxAreaId;try{if(window.mindbox&&-1===location.href.indexOf("pm-dummy")){try{e=Promise.all(r.map((function(e){return n._processQueue([e.id],e.recoType,e.limit,0)}))).then((function(e){return _.chain(e).flatten().uniq(!1,(function(e){return e.ids.mindboxId})).value()})).then(n._handleSuccess).then((function(){if(!n.recommendations.length)return Promise.reject(EMPTY_RECO_ARR_ERROR_MSG)})).catch(n._handleError)}catch(e){console.error(e)}window.mindboxInitialized||n._reportSlaSuccess()}else location.href.indexOf("pm-dummy")>-1?(n._handleSuccess(n._getFakeRecommendationsList().recommendations),n._reportSlaSuccess()):n._reportSlaSuccess()}catch(e){console.error(e),n.recommendations=[],n._reportSlaFailure(encodeURIComponent(e.message))}return e}()}))},onClose:function(){},getSettings:function(){return{recommendations:this.recommendations||[]}},_setProductPriceAndDiscount:function(e){var t=_.extend({},e);t.customFields=t.customFields||{},t.oldPrice&&t.oldPrice<=t.price&&(t.oldPrice=null),t.discount=null,t.oldPrice&&t.oldPrice!==t.price&&(t.discount=(100*(t.oldPrice-t.price)/t.oldPrice).toFixed(0)+"%");try{t.formattedPrice=t.price.toLocaleString("ru-RU"),t.oldPrice&&(t.formattedOldPrice=t.oldPrice.toLocaleString("ru-RU"))}catch(e){}return t},_filterProductListByOtherReco:function(e){var t=location.href.split("#")[0];if(recoIds.location!==t||location.href.indexOf(".mindbox.ru")>-1||location.href.indexOf(".directcrm.ru")>-1)return e;var n=recoIds.ids;return e.filter((function(e){return-1===n.indexOf(e.ids.mindboxId)}))},_saveProductIdsToFilter:function(e){var t=location.href.split("#")[0];(recoIds.location!==t||location.href.indexOf(".mindbox.ru")>-1||location.href.indexOf(".directcrm.ru")>-1)&&(recoIds={location:t,ids:[]});var n=_.map(e,(function(e){return e.ids.mindboxId}));recoIds.ids=_.union(recoIds.ids,n)},_handleSuccess:function(e){var t=this;try{t.currentEntityDataIds.length&&"category"!==t.behaviorSettings.recoType&&(e=e.filter((function(e){var n=e.ids[t.behaviorSettings.shopId];return void 0!==n&&-1===t.currentEntityDataIds.indexOf(n.toString())})))}catch(e){console.error(e)}var n=t.behaviorSettings.filterByOtherReco?t._filterProductListByOtherReco(e):e;t._saveProductIdsToFilter(n),t.recommendations=n.map(t._setProductPriceAndDiscount)},_handleError:function(e){return this.recommendations=[],this._reportedMbError?this._reportSlaSuccess():this._reportSlaFailure(e||"request error"),defaultDebug.log("PopMechanic widget "+this.formId+": "+(e||"request error")),Promise.reject(e)},_processQueue:function(e,t,n,r){var i=this;if(!e||r>e.length)return Promise.resolve([]);var o=e[r],a=i._getRequestParams(t,n);return i._sendRequest(o,t,a).catch((function(o){return console.error(o),i._processQueue(e,t,n,r+1)}))},_getRequestParams:function(e,t){var n,r,i=this.behaviorSettings.shopId,o={recommendation:{returnOptimizedPictures:!!this.behaviorSettings.returnOptimizedPictures,limit:t}};if(this.sendArea&&(o.recommendation.area={ids:{externalId:this.sendArea}}),"product"===e){var a=this.currentEntityDataIds[0];o.recommendation.product={ids:(n={},n[i]=a,n)}}if("category"===e){var s=this.currentEntityDataIds[0];o.recommendation.productCategory={ids:(r={},r[i]=s,r)}}return o},_sendRequest:function(e,t,n){var r=this;return e?mindboxTrackerPromise.then((function(){return new Promise((function(i,o){var a=!1;window.mindbox("sync",{operation:e,data:n,onSuccess:function(e){a=!0,i(e.recommendations||[])},onError:function(e){a=!0;var i=r._parseMbError(e,t,n);r._reportMbError(i),o(e)}}),setTimeout((function(){a||r._reportSlaSuccess()}),1e3)}))})).catch((function(){return[]})):Promise.resolve([])},_parseMbError:function(e,t,n){var r="unknownError",i={},o=/^Unknown endpoint: "([^"]+)"/,a=this.behaviorSettings.shopId;return o.test(e.errorMessage)?(r="endpointInvalid",i={endpoint:e.errorMessage.replace(o,"$1"),site:document.location.host}):"product"===t&&/  /.test(e.message)?(r="productNotFound",void 0===(i={productId:n.recommendation.product.ids[a]}).productId&&(i.productId="undefined")):"category"===t&&/   /.test(e.message)&&(r="categoryNotFound",void 0===(i={categoryId:n.recommendation.productCategory.ids[a]}).categoryId&&(i.categoryId="undefined")),{type:r,payload:i,url:document.location.href}},_reportMbError:function(e){var t=CONFIG.WEB_URL;if("unknownError"!==e.type){this._reportedMbError=!0;try{cash.ajax({type:"post",url:t+window.PopMechanic.client+"/report/"+this.formId+"/",data:JSON.stringify(e),contentType:"application/json",dataType:"json"})}catch(e){console.error(e)}}else this._reportedMbError=!1},_getFakeRecommendationsList:function(){var e=this;if(!fakeProductsList.length){fakeProductsList=[];var t=_.reduce(e.behaviorSettings.operations,(function(e,t){return t.disabled||"number"!=typeof t.limit?e:e+t.limit}),0);fakeProductsList=_.times(t,(function(t){return getFakeProduct(t+50,e.behaviorSettings.shopId)}))}return{recommendations:fakeProductsList}},_reportSlaSuccess:function(e){0===(pendingRecoWidgets$1=_.without(pendingRecoWidgets$1,this.formId)).length&&reportSuccess(e)},_reportSlaFailure:function(e){reportFailure(e)},_getEntityDataIds:function(e,t){var n=this;return new Promise((function(r){try{if("string"==typeof n.behaviorSettings.productIdsCode){var i=new Function(n.behaviorSettings.productIdsCode)();r(i)}}catch(e){}var o=e.attr("data-popmechanic-argument");o&&"ID   mindbox"!==o&&r(o.split(",")),(!t||"product"!==t&&"category"!==t)&&r([]),getMindboxKnownPageDataPromise().then((function(e){var i=n.behaviorSettings.shopId,o=[];e&&e[t]&&e[t].ids[i]&&(o=[e[t].ids[i]]),r(o)}),(function(){r([])}))}))}}),pendingRecoWidgets=[],RecoSlaBehavior=inherit(AbstractBehavior$1,{onTargetingReady:function(e){window.PopMechanic.slaRequired=!0,pendingRecoWidgets.push(this.formId),e.form.reportSlaSuccess=this._reportSlaSuccess.bind(this),e.form.reportSlaFailure=this._reportSlaFailure.bind(this),enableReportUnload()},_reportSlaSuccess:function(e){0===(pendingRecoWidgets=_.without(window.PopMechanic.pendingRecoWidgets,this.formId)).length&&reportSuccess(e)},_reportSlaFailure:function(e){reportFailure(e)}});function getVerticalStyles(e){return-1!==e.direction.indexOf("top")?{top:0,"margin-top":e.vertical_offset}:-1!==e.direction.indexOf("bottom")?{bottom:0,"margin-bottom":e.vertical_offset}:{top:"50%",transform:"translate(0, -50%)"}}function getHorizontalStyles(e){return-1!==e.direction.indexOf("left")?{left:0,"margin-left":e.horizontal_offset}:-1!==e.direction.indexOf("right")?{right:0,"margin-right":e.horizontal_offset}:{left:"50%",transform:"translate(-50%, 0)"}}var defaultAnimationsIn={top:"fadeInUp",bottom:"fadeInDown",left:"fadeInLeft",right:"fadeInRight","top-left":"fadeInUp","top-right":"fadeInUp","bottom-left":"fadeInDown","bottom-right":"fadeInDown"},defaultAnimationsOut={top:"fadeOutUp",bottom:"fadeOutDown",left:"fadeOutLeft",right:"fadeOutRight","top-left":"fadeOutUp","top-right":"fadeOutUp","bottom-left":"fadeOutDown","bottom-right":"fadeOutDown"},ScrollboxBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e),this.settings=_.defaults({},e.form.settings.behavior_settings.scrollbox,{direction:"bottom",horizontal_offset:0,vertical_offset:0}),this.settings.animation_in||(this.settings.animation_in=defaultAnimationsIn[this.settings.direction]),this.settings.animation_out||(this.settings.animation_out=defaultAnimationsOut[this.settings.direction]),this.staticStyles=_.extend({},getVerticalStyles(this.settings),getHorizontalStyles(this.settings))},onRender:function(e,t,n){this._filterForm(e);var r=cash('<div class="'+CONFIG.CSS_PREFIX+'js-wrapper"></div>');this._$formWrapper=r,n.append(r);var i={display:"block","z-index":100000002,position:"fixed","text-align":"left"};_.extend(i,this.staticStyles),r.css(i)},onShow:function(e,t){var n=this._getForm(e);this._$formWrapper.append(n),this._runAnimation(n,this.settings.animation_in),n.find("."+CONFIG.CSS_PREFIX+"close, [data-popmechanic-close]").on("click",(function(){t.close(cash(this).data("popmechanic-close"))}))},onClose:function(e){var t=this,n=this._getForm(e);return new Promise((function(r){t._runAnimation(n,t.settings.animation_out,(function(){e.css({position:"static",height:0,"min-height":0}),r()}))}))},onSuccess:function(){},onFail:function(){}});function padLeft(e){return"number"!=typeof e||e<=0?"00":e<10?"0"+e:""+e}function toDigits(e){return'<span class="'+CONFIG.CSS_PREFIX+'timer-digit">'+e.split("").join('</span><span class="'+CONFIG.CSS_PREFIX+'timer-digit">')+"</span>"}var formatters={seconds:function(e){return Math.floor(e%60)},minutes:function(e){return Math.floor(e/60)%60},hours:function(e){return Math.floor(e/3600)%24},days:function(e){return Math.floor(e/86400)}},secondsInWeek=604800,TimerBehavior=inherit(AbstractBehavior$1,{__constructor:function(e){this.__base(e),this._updateLoop=null,this._showTime=Math.floor(getCachedVisitStartTs()/1e3),this._settings=e.form&&e.form.settings&&e.form.settings.behavior_settings&&e.form.settings.behavior_settings.timer||{}},_getTimers:function(e,t){if(!_.isArray(e))return[];var n=this;return _.chain(e).filter((function(e){return"timer"===e.type})).map((function(e){var r="object"==typeof t[e.machine_name]?t[e.machine_name]:JSON.parse(t[e.machine_name]);return{id:e.machine_name,settings:r,end:n._getEndTime(r)}})).value()},_getEndTime:function(e){switch(e.type){case"end":return e.end.date;case"range":return"visit"===e.range.start?this._showTime+e.range.duration:e.range.start+e.range.duration;case"cycle":if(!e.cycle||!e.cycle.day||!e.cycle.day.length)return 0;var t=new Date,n=(24*t.getUTCDay()*60*60+60*t.getUTCHours()*60+60*t.getUTCMinutes()+t.getUTCSeconds())%secondsInWeek,r=e.cycle.time.split(":");r=60*r[0]*60+60*r[1]+60*e.cycle.local;var i=_.chain(e.cycle.day).map((function(e){return(24*e*60*60+r)%secondsInWeek})).sortBy(_.identity).value(),o=i.filter((function(e){return e<=n})),a=!o.length,s=a?_.last(i):_.last(o),c=n-s+(a?secondsInWeek:0);return Math.round(new Date/1e3)-c+e.cycle.duration;default:return 0}},_updateValues:function(e,t,n){var r=this,i=Math.floor(Date.now()/1e3);t.forEach((function(t){Object.keys(formatters).forEach((function(o){var a="[data-"+CONFIG.CSS_PREFIX+'timer="'+t.id+":"+o+'"]',s=e.find(a),c=t.end-i,u=formatters[o];s.each((function(){var e;try{e=parseInt(cash(this).data("popmechanicDigit"),10)}catch(e){}var t=padLeft(u(c));0!==e&&1!==e||(t=t[e]),cash(this).html(toDigits(t))})),c<=0&&r._settings.close_on_end&&n()}))}))},onBeforeRender:function(e){var t=Math.floor(Date.now()/1e3);this.timers=this._getTimers(e.form.template.parameters,e.form.settings.settings);var n=_.any(this.timers,(function(e){return e.end<t}));if(this._settings.close_on_end&&n)return Promise.reject("Form #"+this.formId+": timer has expired")},onShow:function(e,t){var n=this;n.$view=e,this._updateLoop=setInterval((function(){n._updateValues(e,n.timers,(function(){setTimeout((function(){t.close()}),3e3)}))}),100)},onClose:function(){clearInterval(this._updateLoop)}}),getFakeCartProduct=function(e){var t=e+1;return{count:1,priceOfLine:1e3*t,product:{ids:{website:t}}}},getFakeCart=function(){return _.times(3,getFakeCartProduct)},getFakePopmechanicProduct=function(e){var t=1e3*e,n=e+1;return{id:n,price:t,priceWithDiscount:.75*t,name:"Product "+n,quantity:1,pictureUrl:getFakePicture(e),url:"#",brand:"Brand",brandId:120,hasDiscount:!0,category:"Category",categoryId:229,tags:["tag 1"]}},getFakePopmechanicCart=function(){var e=_.times(3,getFakePopmechanicProduct);return{total:_.reduce(e,(function(e,t){return e+parseInt(t.price,10)}),0),totalWithDiscount:_.reduce(e,(function(e,t){return e+parseInt(t.priceWithDiscount,10)}),0),products:e}},CartBehavior=inherit(AbstractBehavior$1,{__constructor:function(e,t){this.__base(e,t),this._cart=[],this._popmechanicCart=null,this.getSettings=this.getSettings.bind(this),this.onBeforeRender=this.onBeforeRender.bind(this)},onBeforeRender:function(){var e=this;return this._dependencies.dummyIsRequired?(this._cart=getFakeCart(),this._popmechanicCart=getFakePopmechanicCart(),Promise.resolve()):Promise.all([waitPromisesOrDelay([this._dependencies.getCart().catch((function(){return[]}))],1e3),waitPromisesOrDelay([this._dependencies.getPopmechanicCart().catch((function(){return null}))],1e3)]).then((function(t){e._cart=t[0]&&t[0][0]||[],e._popmechanicCart=t[1]&&t[1][0]||null}))},getSettings:function(){return{cart:this._cart||[],popmechanicCart:this._popmechanicCart||null}}}),STATIC="https://static.popmechanic.ru",addScript=function(e){return new Promise((function(t,n){if(cash('script[src="'+e+'"]').length)t();else{var r=document.createElement("script");r.onload=t,r.onerror=function(e){return n(e)},r.src=e,document.head.appendChild(r)}}))},TNS_VERSION="2",TNS_SRC$1=STATIC+"/media/popmechanic/tns-2.9.2.js?v="+TNS_VERSION,loadTns=function(){return addScript(TNS_SRC$1).catch((function(e){throw console.error("Error loading tns-slider script:",e),e}))},TnsBehavior=inherit(AbstractBehavior$1,{onBeforeRender:loadTns}),TNS_SRC=STATIC+"/media/popmechanic/tns-new.js",TnsLegacyBehavior=inherit(AbstractBehavior$1,{onBeforeRender:function(){return addScript(TNS_SRC).catch((function(e){throw console.error("Error loading tns-slider script:",e),e}))}}),behaviorMap={"banner-h":BannerBehavior,"banner-v":BannerBehavior,"copy-code":CopyCodeBehavior,"form-container":FormContainerBehavior,"lead-on-close":LeadOnClose,"post-text":PostTextBehavior,"reco-data":RecoDataBehavior,"reco-sla":RecoSlaBehavior,always:AlwaysBehavior,banner:BannerBehavior,banner_h:BannerBehavior,banner_v:BannerBehavior,button:ButtonBehavior,copy_code:CopyCodeBehavior,embedded:EmbeddedBehavior$1,fullscreen:FullscreenBehavior,humble:HumbleBehavior,info:InfoBehavior,lead:LeadBehavior,lead_on_close:LeadOnClose,multiscreen:MultiscreenBehavior,partscreen:PartscreenBehavior,popup:PopupBehavior,post_text:PostTextBehavior,reco_data:RecoDataBehavior,reco_sla:RecoSlaBehavior,scrollbox:ScrollboxBehavior,social:FacebookBehavior,timer:TimerBehavior,cart:CartBehavior,tns:TnsBehavior,"tns-legacy":TnsLegacyBehavior},dependencies={dummyIsRequired:PopMechanic.dummyIsRequired,getCart:getCart,getPopmechanicCart:getPopmechanicCart};function getInstances(e,t){return e.map((function(e){if(behaviorMap[e])return new behaviorMap[e](t,dependencies)}))}var BehaviorFactory={getInstances:getInstances},$;$=cash,$.fn.fontSpy=function(e,t){var n=$("html"),r=$("body");if("string"!=typeof e||""===e)throw"A valid fontName is required. fontName must be a string and must not be an empty string.";var i={font:e,fontClass:e.toLowerCase().replace(/\s/g,""),success:function(){},failure:function(){},testFont:"Courier New",testString:"QW@HhsXJ",glyphs:"",delay:50,timeOut:1e3,callback:$.noop},o=$.extend(i,t),a=$("<span>"+o.testString+o.glyphs+"</span>").css("position","absolute").css("top","-9999px").css("left","-9999px").css("visibility","hidden").css("fontFamily",o.testFont).css("fontSize","250px");r.append(a);var s=a.outerWidth();a.css("fontFamily",o.font+","+o.testFont);var c=function(){var e=a.outerWidth();s!==e?(o.callback(),n.addClass(o.fontClass),o&&o.success&&o.success(),a.remove()):o.timeOut<0?(n.addClass("no-"+o.fontClass),o&&o.failure&&o.failure(),o.callback(new Error("FontSpy timeout")),a.remove()):(setTimeout(c,o.delay),o.timeOut=o.timeOut-o.delay)};c()};var fontSpy=cash.fn.fontSpy,AVAILABLE_VARS=["first_name","last_name","email"],AbstractFormView=inherit({_resources:[],_success:!1,__constructor:function(e){var t=e.template;this.id=t.id,this.html=e.settings.html||t.html,this.css=e.settings.css||t.css,this.behaviors=t.behaviors||[],this.fonts=t.fonts,this.form=e,this.data=t,this.init()},init:function(){this.behaviors=BehaviorFactory.getInstances(this.behaviors,this),this.behaviorsReady=this.form.isControlGroup?Promise.resolve():this._behaviorsOnInit(),this.form.subscribeIntegrations()},_behaviorsOnInit:function(){var e=this,t=this.behaviors.map((function(t){return t.onInit(e)})).filter((function(e){return!!e}));return Promise.all(t)},_getSettings:function(e){var t=_.extend({},this.form.settings.settings,{desktop:device$1.desktop(),tablet:device$1.tablet(),mobile:device$1.mobile(),formId:this.form.id});if(e)return t;var n=[t].concat(this.behaviors.map((function(e){return e.getSettings()})).filter((function(e){return!!e})));return _.extend.apply(_,n)},_extractImports:function(){var e=this._getSettings(!0),t=_.template(this.css)(e).matchAll(/(?:@import)\s(?:url\()?\s?["'](.*?)["']\s?\)?(?:[^;]*);?/gi);Array.from(t).forEach((function(e){e[0];var t=e[1];cash("head").append('<link href="'+t+'" rel="stylesheet"/>')}))},_extractFonts:function(){var e=this._getSettings(!0),t=_.template(this.css)(e).match(/@font-face\s{[\s\S]*?}/gi);return t?t.map((function(e){return{name:e.split("font-family:")[1].split(";")[0].trim(),body:e}})):null},_prefetchFonts:function(){var e=this,t=this._extractFonts(),n=this._getSettings(!0);t&&($snippet.append("<style>"+_.template(t.map((function(e){return e.body})).join("\n"))(n)+"</style>"),t.forEach((function(t){e._resources.push(new Promise((function(e){fontSpy(t.name,{fontClass:"pm-"+t.name+"-loaded",success:e,fail:e}),setTimeout(e,5e3)})))})))},_prefetchUrl:function(e){var t,n=new Promise((function(n){if(e.indexOf(".ttf")>-1||e.indexOf(".svg")>-1||e.indexOf(".eot")>-1||e.indexOf(".woff")>-1)return n();(t=new Image).onload=n,t.onerror=n,setTimeout(n,5e3),t.src=e}));this._resources.push(n)},_prefetch:function(){var e,t,n,r,i=/url\((.*?)\)|src="(.*?)"/g;for(t=(e=this._render()).html(),e.remove(),this._extractImports();n=i.exec(t);)r=n[1].replace(/'|"/g,""),this._prefetchUrl(r);this._prefetchFonts()},_getCssTemplate:function(e){return containerizeCss(_.template(this.css)(e),this.form.id)},_getCssReset:function(){return containerizeCss(getCssReset(this.form.id),this.form.id)},_getHtmlTemplate:function(e){return containerizeHtml(_.template(this.html)(e),this.form.id).replace(/%([\w.]+?)%/g,(function(e,t){return AVAILABLE_VARS.indexOf(t)>-1||0===t.indexOf("customs")?"<span data-popmechanic-var="+t+"></span>":e}))},_setDeviceClasses:function(e){device$1.mobile()&&e.addClass(CONFIG.CSS_PREFIX+"mobile"),device$1.tablet()&&e.addClass(CONFIG.CSS_PREFIX+"tablet"),device$1.desktop()&&e.addClass(CONFIG.CSS_PREFIX+"desktop")},_render:function(){var e,t,n;return e=this._getSettings(),t=cash('<style id="'+CONFIG.CSS_PREFIX+"css-"+this.form.id+'">'+this._getCssTemplate(e)+"</style>"),(n=cash(this._getHtmlTemplate(e))).addClass(CONFIG.CSS_PREFIX+"js-form"),this._setDeviceClasses(n),this.data.need_reset?cash('<style id="'+CONFIG.CSS_PREFIX+"reset-"+this.form.id+'">'+this._getCssReset(e)+"</style>").add(t).add(n):t.add(n)},_handler:function(e,t){var n,r,i=function(){};if(!e)return i;n=this._getSettings();try{r=_.template(e)(n),i=new Function("form","settings",r)}catch(n){return defaultDebug.log("Error creating form#"+this.form.id+", "+t+" handler",r,e,n),i}return function(r){try{return i.call(this,r,n)}catch(n){defaultDebug.log("Error in form#"+r.id+", "+t+" handler",e,n)}}},onTargetingReady:function(){var e=this;if(e.behaviors.forEach((function(t){try{t.onTargetingReady(e)}catch(e){}})),e.data.on_targeting_ready)try{e.onTargetingReady=e._handler(e.data.on_targeting_ready,"on_targeting_ready"),e.onTargetingReady(e.form)}catch(e){}if(e.data.on_child_ready)try{e.onChildReady=e._handler(e.data.on_child_ready,"on_child_ready")}catch(e){}Dispatcher.trigger("targeting",{form:e.form}),e._prefetch()},controlGroupIsShownNotify:function(){defaultDebug.isDebugging()&&console.log("Form "+this.form.id+" control group is shown")},controlGroupShow:function(){},variantShow:function(){},show:function(e){return this.form.isControlGroup?this.controlGroupShow(e):this.variantShow(e)},success:function(){},close:function(){},terminate:function(){}}),FormView=inherit(AbstractFormView,{_resources:[],_success:!1,__constructor:function(e){this.__base(e),this.close=this.close.bind(this)},init:function(){var e=this.form;-1===this.behaviors.indexOf("button")&&e.button_template&&e.button_template.id&&this.behaviors.push("button"),this.__base()},variantShow:function(e){var t,n=getContainer(this.form.id),r=this;this._$elem||snippetHasForm(this.form.id)||(this._closed=!1,r.form.cancelConditions(),Promise.all(this._resources).then((function(){return r.behaviorsReady})).then((function(){return!(!e&&!window.PopMechanic.isTesting)||(!r.form.newTargeting||r.form.newTargeting.double_check?Targeting.check(r.form):r.form.inTargeting)})).then((function(i){if(i)return Promise.all(r.behaviors.map((function(e){return Promise.resolve(e.onBeforeRender(r,n)).catch((function(t){return e.onBeforeRenderRejectIsDebuggable&&defaultDebug.isDebugging()?Promise.resolve():Promise.reject(t)}))}))).then((function(){return!1})).catch((function(e){return defaultDebug.log("onBeforeRender error:",e),!0})).then((function(i){if(!i){return(e?Promise.resolve(!0):Promise.all([r.form.checkFrequency(),r.form.checkAccountFrequency()]).then((function(e){var t=e[0],n=e[1];return!!t&&(n?(event.push({type:"show_start",form:r.form.id,behaviors:r.form.template.behaviors}),!0):(r.form.report("frequency_exceed"),!1))})).catch((function(e){return console.error("Error checking frequency:",e),!0}))).then((function(e){if(e)return r.onShow=r._handler(r.data.on_show,"on_show"),t=r._render(),r._$container=n,r._$elem=t,Promise.all(r.behaviors.map((function(e){return e.onRender(t,r,n)})).concat(r.form.integrationsOnRender())).then((function(){snippetHasForm(r.form.id)||(n.append(t),r.behaviors.forEach((function(e){e.onShow(n,r,n)})),r.form.inTargeting||r.form.report("bucket"),r.form.reportShow(),Session.setLastShown(r.form.id),"function"==typeof window.PopMechanic.onFormShow&&window.PopMechanic.onFormShow({form:r.form}),r.onShow(r.form))})).catch((function(){t.remove()}))}))}}));r.form.report("targeting_excluded")})))},controlGroupShow:function(e){var t=this;t.form.cancelConditions();(e||window.PopMechanic.isTesting?Promise.resolve(!0):!t.form.newTargeting||t.form.newTargeting.double_check?Targeting.check(t.form):Promise.resolve(t.form.inTargeting)).then((function(n){return n?!!e||Promise.all([t.form.checkFrequency(),t.form.checkAccountFrequency()]).then((function(e){var r=e[0],i=e[1];return!!r&&(i?n:(t.form.report("frequency_exceed"),!1))})).catch((function(e){return console.error("Error checking frequency:",e),n})):(t.form.report("targeting_excluded"),!1)})).then((function(e){if(e)return t.form.integrationsOnRender().then((function(){t.form.inTargeting||t.form.report("bucket"),t.controlGroupIsShownNotify(),t.form.reportShow()}))}))},success:function(){var e=this;return this._success=!0,Promise.all(this.behaviors.map((function(t){return t.onSuccess(e._$container,e)}))).then((function(){e.close()}),(function(){e.close()}))},close:function(e){this.terminate(this.form.reportClose,e)},terminate:function(e,t){var n=this;function r(){n._$elem&&(n._$elem.remove(),n._$elem=null)}n._closed||(Promise.all(this.behaviors.map((function(e){return Promise.resolve(e.onBeforeClose(n._$container,n,{showSuccess:!!t})).catch((function(){}))}))).then((function(){if(!n._closed)return n._closed=!0,Promise.all(n.behaviors.map((function(e){return e.onClose(n._$container,n,{success:n._success})})))})).then(r,r),"function"==typeof e&&e(),"function"==typeof window.PopMechanic.onFormClose&&window.PopMechanic.onFormClose(this._success),n.onClose=n._handler(n.data.on_close,"on_close"),n.onClose(n.form))}}),StaticFormView=inherit({__constructor:function(e,t){var n=e.template;this.id=n.id,this.html=n.html,this.css=n.css,this.behaviors=n.behaviors,this.form=e,this.data=n,this.behaviors=BehaviorFactory.getInstances(t,this),this._behaviorsOnInit()},init:function(){var e=this;this._$elem=cash("[data-popmechanic-form="+this.form.id+"]"),this._$elem.each((function(){var t=cash(this);t.on("submit",(function(e){e.preventDefault()})),Session.isContactsSent(e.form.getLeadType())?t.addClass(CONFIG.CSS_PREFIX+"submitted"):e.behaviors.forEach((function(n){n.onShow(t,e)}))}))},success:function(e){var t=this;return this._success=!0,Promise.all(this.behaviors.map((function(e){return e.onSuccess(t._$elem,t)}))).then((function(){t.close()}),(function(){t.close()}))},close:function(){}}),scrollLastPos=null,scrollTimer=0,scroll={};function track(){var e=window.scrollY||window.pageYOffset;null!=scrollLastPos&&(scroll.velocity=e-scrollLastPos,scroll.delta=scroll.velocity>=0?scroll.velocity:-1*scroll.velocity),scrollLastPos=e,scrollTimer&&clearTimeout(scrollTimer),scrollTimer=setTimeout((function(){scrollLastPos=null}),30)}function viewable(e,t){var n=e.getBoundingClientRect();return n.top+n.height>=0&&n.left+n.width>=0&&n.bottom-n.height<=(window.innerHeight||document.documentElement.clientHeight)+t&&n.right-n.width<=(window.innerWidth||document.documentElement.clientWidth)+t}function appear(e){return function(e){var t,n,r,i,o=!1,a=[],s=[],c=0,u=0,l={};function d(){scroll.delta<l.delta.speed&&(r||(r=!0,p(),setTimeout((function(){r=!1}),l.delta.timeout))),function(e,t){return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout((function(){e.apply(r,i)}),t)}}((function(){p()}),l.debounce)()}function f(){p(),addEventListener("scroll",d,!1),addEventListener("resize",d,!1)}function h(){removeEventListener("scroll",d,!1),removeEventListener("resize",d,!1)}function p(){i||(a.forEach((function(e,t){e&&viewable(e,l.bounds)?s[t]&&(s[t]=!1,c++,l.appear&&l.appear(e),l.disappear||l.reappear||(a[t]=null)):(!1===s[t]&&(l.disappear&&l.disappear(e),u++,l.reappear||(a[t]=null)),s[t]=!0)})),l.reappear||l.appear&&(!l.appear||c!==t)||l.disappear&&(!l.disappear||u!==t)||(i=!0,h(),l.done&&l.done()))}function m(){var e;if(!o&&(o=!0,l.init&&l.init(),e="function"==typeof l.elements?l.elements():l.elements)){t=e.length;for(var n=0;n<t;n+=1)a.push(e[n]),s.push(!0);f()}}var g=function(e){l={init:(e=e||{}).init,elements:e.elements,appear:e.appear,disappear:e.disappear,done:e.done,reappear:e.reappear,bounds:e.bounds||0,debounce:e.debounce||50,delta:{speed:e.deltaSpeed||50,timeout:e.deltaTimeout||500}},addEventListener("DOMContentLoaded",m,!1);var t=!1;Function("/*@cc_on return document.documentMode===10@*/")()&&(t=!0);var r="complete"===document.readyState||"loaded"===document.readyState;return t?r&&m():(r||"interactive"===document.readyState)&&m(),{trigger:function(){p()},pause:function(){h()},resume:function(){f()},destroy:function(){a=[],n&&clearTimeout(n),h()}}};if("undefined"==typeof module||void 0===module.exports)return g;module.exports=g}()(e)}addEventListener("scroll",track,!1);var EmbeddedFormView=inherit(AbstractFormView,{_success:!1,_appear:null,$target:null,__constructor:function(e){this.__base(e)},init:function(){var e=this.form;this.placement=e.embed_selector?e.placement:"end",this.__base()},controlGroupShow:function(){var e,t=this;return Promise.resolve(t.form.getTargetElement&&t.form.getTargetElement()).then((function(n){e=n,t.onTargetingReady()})).then((function(){return window.PopMechanic.isTesting||Targeting.check(t.form)})).then((function(e){return e?t.form.checkFrequency().then((function(t){return!!t&&e})).catch((function(t){return console.error("Error checking frequency:",t),e})):(t.form.report("targeting_excluded"),!1)})).then((function(e){if(e)return t.form.integrationsOnRender()})).then((function(){var n=CONFIG.CSS_PREFIX+"form-"+t.form.id+"-control-group";embedElement({$target:e,$element:cash('<div id="'+n+'" style="visibility: hidden; width: 0; height: 0; padding: 0; margin: 0; overflow: hidden;"></div>'),placement:t.placement}),t._appear=appear({elements:function(){return cash("#"+n).get()},appear:function(){t.controlGroupIsShownNotify(),t.form.reportShow(),this._appear&&this._appear.destroy()}})}))},variantShow:function(){var e,t=this,n=null,r=getContainerMarkup(t.form.id);return Promise.resolve(t.form.getTargetElement&&t.form.getTargetElement()).then((function(e){e&&(n=e)})).then((function(){t.onTargetingReady()})).then((function(){return t.behaviorsReady})).then((function(){return window.PopMechanic.isTesting||Targeting.check(t.form)})).then((function(i){if(i)return Promise.all(t.behaviors.map((function(e){return Promise.resolve(e.onBeforeRender(t,n)).catch((function(t){return e.onBeforeRenderRejectIsDebuggable&&defaultDebug.isDebugging()?Promise.resolve():Promise.reject(t)}))}))).then((function(){return!1})).catch((function(e){return defaultDebug.log("onBeforeRender error:",e),!0})).then((function(i){if(!i)return t.form.checkFrequency().catch((function(e){return console.error("Error checking frequency:",e),!0})).then((function(i){if(i)return event.push({type:"show_start",form:t.form.id,behaviors:t.form.template.behaviors}),t.onShow=t._handler(t.data.on_show,"on_show"),t.onClose=t._handler(t.data.on_close,"on_close"),e=t._render(),r.append(e),t._$elem=r,Promise.all(t.behaviors.map((function(e){return Promise.resolve(e.onRender(t._$elem,t))})).concat(t.form.integrationsOnRender())).then((function(){var e;t.behaviors.forEach((function(e){e.onShow(t._$elem,t,n)})),t.onShow(t.form),window.PopMechanic.leads&&window.PopMechanic.leads.some((function(n){return n.form===t.form.id&&(e=n,!0)}))&&t.success(e,!0)})).then((function(){t._appear=appear({elements:function(){return cash("#"+CONFIG.CSS_PREFIX+"form-"+t.form.id).get()},appear:function(){t.form.reportShow(),Session.setLastShownWithId(t.form.id),this._appear&&this._appear.destroy()}})}))}))}));t.form.report("targeting_excluded")}))},success:function(e){var t=this;return this._success=!0,Promise.all(this.behaviors.map((function(n){return n.onSuccess(t._$elem,t,e)})))},close:function(e){this.terminate(this.form.reportClose,e)},terminate:function(e,t){var n=this;function r(){n._$elem&&(n._$elem.remove(),n._$elem=null);for(var e="#"+getContainerId(n.form.id.toString());cash(e).length;)cash(e).remove()}n.form.terminate(),n._$elem&&Promise.all(this.behaviors.map((function(e){return Promise.resolve(e.onBeforeClose(n._$container,n,{showSuccess:!!t})).catch((function(){}))}))).then((function(){if(!n._closed)return n._closed=!0,Promise.all(n.behaviors.map((function(e){return e.onClose(n._$elem,n,{success:n._success})})))})).then(r,r),"function"==typeof e&&e(),"function"==typeof window.PopMechanic.onFormClose&&window.PopMechanic.onFormClose(this._success),n.onClose=n._handler(n.data.on_close,"on_close"),n.onClose(n.form)}}),view={init:function(e){return e.isStatic()?view.initStatic(e):e.isEmbedded()?view.initEmbedded(e):view.initNormal(e)},initNormal:function(e){var t=new FormView(e,e.template.behaviors),n=function(r){r&&(e.clearTargetingChange(n),t.onTargetingReady())};return e.ignoresTargeting()?n(!0):e.onTargetingChange(n),t},initStatic:function(e){var t=new StaticFormView(e,e.template.behaviors);return t.init(),t},initEmbedded:function(e){var t=window.PopMechanic.initAt,n=new EmbeddedFormView(e),r=function(i){i&&t===window.PopMechanic.initAt&&(n.show(),e.clearTargetingChange(r))};return e.onTargetingChange(r),n}};function chunk(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(Array.prototype.slice.call(e,r,r+=t));return n}function rafMap(e,t,n){void 0===n&&(n=10);var r,i,o=[],a=0,s=chunk(e,n),c=new Promise((function(e,t){r=e,i=t}));return requestAnimationFrame((function e(){if(a>=s.length)return r(_.flatten(o,1));try{var n=s[a];o.push(_.map(n,t)),a+=1,requestAnimationFrame(e)}catch(e){i(e)}})),c}var Init=inherit({forms:[],activeForms:[],pluginData:[],formsMap:{},formsReady:null,_deviceUUID:null,__constructor:function(e){var t=e.data,n=e.deviceUUID,r=e.onTargetingChange,i=e.debug;void 0===i&&(i=defaultDebug);var o=_.identity,a=_.identity;this.formsReady=new Promise((function(e,t){o=e,a=t})),this.onTargetingChange=r,this._debug=i,this._data=this._normalizeData(t),this._data.contacts?window.PopMechanic.leads=this._data.contacts:window.PopMechanic.leads=[],n&&(this._deviceUUID=n),this._getAbTestFormsIds=this._getAbTestFormsIds.bind(this),this._getTransactionalForms=this._getTransactionalForms.bind(this),this._setFormsAsync().then(o,(function(e){report({type:"exception",url:location.href}),a(e)}))},_getAbTestFormsIds:function(e){var t=this,n=_.find(e.variants,(function(n){return hashMatchesInterval(t._deviceUUID,e.salt,n.modulus_lower_inclusive,n.modulus_upper_exclusive)}));if(!n)return[];if(n.is_control_group){try{this._debug.log('Control group of global ab-test (global_ab_test_internal_id="'+e.global_ab_test_internal_id+'") is used')}catch(e){}return[]}var r=n.forms.map(_.property("id")),i=_.chain(e.variants).reduce((function(e,t){return t.internal_id!==n.internal_id?e.concat(t.forms.map(_.property("id"))):e}),[]).difference(r).value();return _.chain(this.forms).map((function(e){return e.id})).difference(i).value()},_getAbTestsForms:function(){var e=this;return this._data.global_ab_tests.length?_.intersection.apply(_,this._data.global_ab_tests.map(this._getAbTestFormsIds)).map((function(t){return e.formsMap[t]})).filter(_.isObject):this.forms},_getTransactionalForms:function(){return this.forms.filter((function(e){return e.isTransactional}))},_getActiveForms:function(){var e=this._getAbTestsForms(),t=this._getTransactionalForms();return _.union(e,t)},_normalizeData:function(e){return _.extend({},{global_ab_tests:[]},e)},_selectFormFromGroup:function(e,t){if(!e.length)return null;if(1===e.length)return e[0];if(!Session.formsChanged(t,e)){var n=Session.getForm(t);return _.find(e,(function(e){return e.id===n}))}var r=_.sample(e);return Session.setForms(t,e),Session.setForm(t,r.id),r},_setFormsAsync:function(){var e=this;return rafMap(this._data.forms,(function(t){var n=new Form(_.extend({},t,{accountFrequency:e._data.frequency}),e._data.integrations||[]);return n.setTemplate(e.getTemplate(n.template_id)),n.setButtonTemplate(e.getButtonTemplate(n.button_template_id)),n.pushToHistory(),n})).then((function(t){e.formsMap=_.indexBy(t,"id");var n=_.groupBy(t,(function(e){return e.getTestGroupId()}));return _.map(n,e._selectFormFromGroup).filter(_.isObject)})).then((function(t){e.forms=t,t.forEach((function(e){e.setInSplitTest(!0);var t=e.test_group?e.test_group.conditions_splits:e.settings.conditions_splits;if(Session.conditionsSplitsChanged(e.id,t)){var n=_.sample(t);n&&Session.setConditionsSplit(e.id,n.id)}e.setConditions(Session.getConditionsSplit(e.id))}))})).then((function(){return e.activeForms=e._getActiveForms(),rafMap(e.activeForms,(function(t){t.checkTargeting(e.onTargetingChange)}))})).then((function(){e.pluginData=_.map(e.formsMap,(function(e){return{id:e.id,name:e.name,isEmbedded:e.isEmbedded()||e.isStatic(),testGroup:{id:e.getTestGroupId(),name:e.test_group?e.test_group.name:""},inSplitTest:!!e.inSplitTest,inTargeting:e.inTargeting}}))}))},getTemplate:function(e){return _.find(this._data.templates,(function(t){return t.id===e}))||{}},getButtonTemplate:function(e){return _.find(this._data.button_templates,(function(t){return t.id===e}))||{}}}),trimHostname=function(e){return e.split(".").length>2?e.replace(/(^www\.)/gi,""):e},getDomainsByHost=function(e){var t=trimHostname(e),n=t.split("."),r=[];r.push(t);for(var i=0;i<n.length-1;i++){var o="*"+n.slice(i,n.length).join(".");r.push(o)}return r},s3Fetch=function(e){return new Promise((function(t,n){var r=e.retryLimit||3,i=_.omit(e,"retryLimit"),o=Date.now(),a=new URLSearchParams(window.location.search),s=Math.floor("true"==a.get("mindbox_nocache")?o/1e3:o/3e5),c=function(){return cash.ajax(_.extend({},i,{success:function(e,r,i){200===i.status&&t(e),n(i)},error:function(e){if((0===e.status||e.status>=500)&&r>0)return r--,void c();n(e)},dataType:"json",data:{_:s.toString()}}))};c()}))},runPrioritizedPromise=function(e){return new Promise((function(t,n){var r=[];_.forEach(e,(function(e,t){return r.push(new CancelablePromise(e,(function(){return function(e){var t=r.slice(e+1);_.forEach(t,(function(e){return e.cancel()}))}(t)})))}));var i=_.map(r,(function(e){return e.execute()}));return Promise.all(i).then((function(e){var r=_.findIndex(e,(function(e){var t=e.error,n=e.cancelled;return!t&&!n}));r>-1&&t({data:e[r].data,index:r});var i=e[e.length-1];n(i.error)}))}))},CancelablePromise=function(e,t){this.promise=e,this._onResolve=t,this.cancel=this.cancel.bind(this),this.execute=this.execute.bind(this)};CancelablePromise.prototype._onResolve=function(){},CancelablePromise.prototype.cancel=function(){return Promise.resolve({cancelled:!0})},CancelablePromise.prototype.execute=function(){var e=this;return new Promise((function(t){e.cancel=function(){return t({cancelled:!0})},e.promise.then((function(n){e._onResolve(),t({data:n})})).catch((function(e){return t({error:e})}))}))};var WebInit=function(e){var t=e.s3Server,n=e.server,r=e.clientId,i=e.endpointId,o=e.hostname,a=e.s3Fetch;void 0===a&&(a=s3Fetch);var s=e.host;this._s3server=t,this._server=n,this._clientId=r,this._endpointId=i?i.toLowerCase():void 0,this._hostname=o,this._s3Fetch=a,this._host=s,this._getUrlWithDomainAndEndpoint=this._getUrlWithDomainAndEndpoint.bind(this),this._getUrlWithEndpoint=this._getUrlWithEndpoint.bind(this),this._getUrlWithDomain=this._getUrlWithDomain.bind(this),this._getDefaultUrl=this._getDefaultUrl.bind(this),this._getApiUrlsWithEndpoint=this._getApiUrlsWithEndpoint.bind(this),this._getApiUrlsWithoutEndpoint=this._getApiUrlsWithoutEndpoint.bind(this),this.fetch=this.fetch.bind(this)};WebInit.prototype._getUrlWithDomainAndEndpoint=function(e){return this._s3server+"/init/"+this._clientId+"/domain_and_endpoint/"+this._endpointId+":"+e},WebInit.prototype._getUrlWithEndpoint=function(){return this._s3server+"/init/"+this._clientId+"/endpoint/"+this._endpointId},WebInit.prototype._getNoEndpointUrl=function(){return this._s3server+"/init/"+this._clientId+"/no_endpoint"},WebInit.prototype._getUrlWithDomain=function(e){return this._s3server+"/init/"+this._clientId+"/domain/"+e},WebInit.prototype._getNoDomainUrl=function(){return this._s3server+"/init/"+this._clientId+"/no_domain"},WebInit.prototype._getDefaultUrl=function(){return this._s3server+"/init/"+this._clientId+"/default"},WebInit.prototype._getApiUrlsWithEndpoint=function(){var e=this,t=getDomainsByHost(this._hostname),n=[];return _.forEach(t,(function(t){var r=e._getUrlWithDomainAndEndpoint(t);n.push(r)})),n.push(this._getUrlWithEndpoint()),n.push(this._getNoEndpointUrl()),n},WebInit.prototype._getApiUrlsWithoutEndpoint=function(){var e=this,t=getDomainsByHost(this._hostname),n=[];return _.forEach(t,(function(t){var r=e._getUrlWithDomain(t);n.push(r)})),n.push(this._getNoDomainUrl()),n},WebInit.prototype.fetch=function(){var e=this,t=[];(t=this._endpointId?this._getApiUrlsWithEndpoint():this._getApiUrlsWithoutEndpoint()).push(this._getDefaultUrl());var n=_.map(t,(function(t){return e._s3Fetch({url:t,type:"HEAD"})}));return runPrioritizedPromise(n).then((function(n){var r=n.index;return e._s3Fetch({url:t[r],type:"GET"})}))};var settings=window.PopMechanic,prevLocation=null,locationWatchInterval=null,formViews={},lockUpdate=!0,mindboxDeviceUUID=document.cookie.replace(/(?:(?:^|.*;\s*)mindboxDeviceUUID\s*\=\s*([^;]*).*$)|^.*$/,"$1");mindboxDeviceUUID&&(window.PopMechanic.customs=window.PopMechanic.customs||{},window.PopMechanic.customs.mindboxDeviceUUID=mindboxDeviceUUID);var getMindboxIsReadyPromise=function(){return waitPromisesOrDelay([getIntegrationPromise("mindbox",void 0,150,1e3,3),mindboxInitializedPromise,mindboxBatchedModulesInitializedPromise],1300)},getUUIDPromise=function(){return new Promise((function(e){window.mindbox||e(null);try{window.mindbox("helpers.getDeviceUUID",(function(t){t&&(deviceSettings.mindboxDeviceUUID=t),e(t||null)}))}catch(t){return e(null)}}))},getInvokeEndpointIdPromise=function(){return new Promise((function(e){window.mindbox||e(null);try{window.mindbox("personalization.invokeWithActualEndpointId",(function(t){e(t||null)}))}catch(t){return e(null)}}))},getEndpointIdPromise=function(){return getMindboxIsReadyPromise().then((function(){return window.mindbox?window.PopMechanic.initializedByMindbox?Promise.all([getInvokeEndpointIdPromise(),getUUIDPromise()]).then((function(e){return e[0]})):waitPromisesOrDelay([getInvokeEndpointIdPromise(),getUUIDPromise()],1e3).then((function(e){return e&&_.isArray(e)?e[0]:null})):null}))},getWebForm=function(e){return new Promise((function(t){var n={domain:location.host};cash.ajax({type:"GET",url:CONFIG.FORM_TEST_URL+settings.formHash+"/?c="+settings.client,data:e?_.extend({},n,{endpointId:e}):n,success:t,dataType:"json"})}))};window.PopMechanic.initStartedAt=Date.now(),window.PopMechanic.sbjs=sbjs,window.PopMechanic.$=cash,window.PopMechanic._=_,window.PopMechanic.Promise=Promise;try{updateCachedVisitStartTs()}catch(e){}function handleInit(){getEndpointIdPromise().then((function(e){return window.__POPMECHANIC_INIT?window.__POPMECHANIC_INIT:settings.formHash?getWebForm(e):new WebInit({s3Server:S3_SERVER,server:SERVER,clientId:settings.client,endpointId:e,hostname:location.hostname,host:location.host}).fetch().catch((function(e){e.status>=400&&reportFailure("init-error")}))})).then(init)}function init(e){var t;lockUpdate=!0,window.PopMechanic.initAt=Date.now(),reportVisit({url:location.href,ts:Date.now(),vst:sbjs.get.udata.vst}),(t=new Init({data:e,deviceUUID:deviceSettings.mindboxDeviceUUID,onTargetingChange:function(e,n){t.formsReady.then((function(){if(n&&!formViews[e.id]){var t=view.init(e);t&&(formViews[e.id]=t)}if(window.PopMechanic.debugMode)try{window.postMessage({source:CONFIG.CSS_PREFIX+"script",type:"SET_IN_TARGETING",data:{clientId:window.PopMechanic.client,formId:e.id,inTargeting:n}},"*")}catch(e){}}))}})).formsReady.then((function(){report({type:"pageview",url:location.href}),Dispatcher.on("lead",(function(e,t){try{window.PopMechanic.onContactsSent(t.lead)}catch(e){}})),window.PopMechanic.show=function(e,n){var r=t.formsMap[e];if(!r||r.isEmbedded()||r.isStatic())return!1;var i=formViews[r.id];if(!i){if(!(i=new FormView(t.formsMap[e],t.formsMap[e].template.behaviors)))return!1;formViews[r.id]=i}var o=i.form.getLeadType();return!(Session.isContactsSent(o)&&!n)&&(i.show(!0),i)},window.PopMechanic.getModel=function(e){return t.formsMap[e]},window.PopMechanic.getView=function(e){return formViews[e]},window.PopMechanic.embed=function(e,n){if(void 0===n&&(n={}),t.formsMap[e]){var r="string"==typeof n?{selector:n}:n;r.selector&&(t.formsMap[e].selector=r.selector,t.formsMap[e].embed_selector=!0);var i=view.init(t.formsMap[e]);r.force&&i.show(!0)}},window.PopMechanic.watchHash?(prevLocation=window.location.href,locationWatchInterval=setInterval(watchLocation,300)):!1!==window.PopMechanic.watchLocation&&(prevLocation=window.location.pathname,locationWatchInterval=setInterval(watchPathname,300)),t.activeForms.forEach((function(e){if(!formViews[e.id]){var t=view.init(e);t&&(formViews[e.id]=t)}})),settings.isTesting&&e.forms.forEach((function(e){e.container_id||window.PopMechanic.show(e.id,!0)})),window.PopMechanic.loaded=!0,window.PopMechanic.onLoad&&"function"==typeof window.PopMechanic.onLoad&&window.PopMechanic.onLoad();try{window.postMessage({source:CONFIG.CSS_PREFIX+"script",type:"SET_LOADED",data:{clientId:window.PopMechanic.client,forms:t.pluginData}},"*")}catch(e){}cash("html").addClass(CONFIG.CSS_PREFIX+"loaded"),lockUpdate=!1}))}function watchPathname(){var e=window.location.pathname;e!==prevLocation&&(prevLocation=e,window.PopMechanic.update())}function watchLocation(){var e=window.location.href;e!==prevLocation&&(prevLocation=e,window.PopMechanic.update())}function destroy(){Dispatcher.trigger("destroy"),_.forEach(formViews,(function(e){e&&"function"==typeof e.terminate&&e.terminate()})),formViews={},Dispatcher.off("lead"),Dispatcher.off("formShow"),Dispatcher.off("formClose"),Dispatcher.off("targeting"),window.PopMechanic.loaded=!1,window.PopMechanic.sampleSent=!1,clearInterval(locationWatchInterval),cash("#"+CONFIG.CSS_PREFIX+"snippet").html(""),cash("[data-popmechanic-embed]").html(""),cash("html").removeClass(CONFIG.CSS_PREFIX+"loaded"),enableScroll(),window.PopMechanic.restartWatchdog()}sbjs.init({prefix:"popmechanic_"}),cash.ajaxSettings.xhrFields={withCredentials:!!settings.formHash},cash.ajaxSettings.global=!1,handleInit(),window.PopMechanic.update=function(){lockUpdate||(lockUpdate=!0,destroy(),window.PopMechanic.initStartedAt=Date.now(),sbjs.init({prefix:"popmechanic_"}),handleInit())},window.PopMechanic.destroy=destroy,window.addEventListener("message",(function(e){e.source===window&&e.data&&"popmechanic-extension"===e.data.source&&"SHOW"===e.data.type&&window.PopMechanic.show(e.data.id,!0)}))}();
