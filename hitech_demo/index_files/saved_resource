(function() {
    const options = { token: 'eyJhbGciOiJkaXIiLCJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwidHlwIjoiSldUIn0..kbkVAWwZgc53sbDS.aaZHmCeMhpaVoYnoFdlJIan7DUOsgQTy8CqU58Sn6bbVhVNJUoIgkSX1mDdaxIuoEQpuDvV8mo_3aKEOq-S7L3G7b6YOHPscNce7wyylCH9Dk4NwHi-AsUlOHejiiCvJjhYmNNhRzoL81L-Bt7elTGEE5U2Njys-CXsBWm-2A2Fv2gKZEl51htMdhl1ig7t-czyxeQoj6VAeGvWgl1CcFSphhBjpLQUVCdHfnIhYtY7RYPFHtdMAzKjAijSweaj1mFjyViHb7H1wDZdmE-FYAdv9Ao6-Z6hwdwVJmBLTzmH97kDfdO1Xl3LPR1O26mtivp6tiTq0qM_PeBBT6btKTTd3wpikzdsnzWD60SVRMtmDhKZcp_wrjKHOJglG3-fSCrOar9MXYClZFIKjInJQWKi6vPN1Fde3hhkbewumVYkppc4hZpv4wOHfXtnYkLVVPPWyGhzHqr3Z0lDh-POHBeT3LJJHirgK7angKUugcDRc7ky_oXZBJXQGVNUgyAcFtzc5cMPSKuDFo3Ro7inHRa2XWQ695M-un7grswAMtnPPWwKzHpIFaXVM1uVanvh7Ym3ZlSOA7qdCI0MLDyzqq8di4jLfHADbAQ.mrdHMaB4IHEjN_gEuQWeYA', version: '1.0', autostart: true, swipeToSite: false, projectUUID: '800a6f3d-2ccc-33db-419a-7d507a8aba4b', entityType: 'article', entityTypeID: 0 };
    return (()=>{"use strict";const e=(e,t)=>{const n=t?"\n    background: #5CD85A;\n    color: #08313A;\n  ":"\n    background: #ffb9b0;\n    color: #702743;\n  ";console.log(`%c MediaStat: ${e} `,n)},t=t=>{e(`Ошибка отправки, причина: ${t.replace(/\r?\n/g,"")}`)},n=e=>{const t=e.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,s=window.pageXOffset||i.scrollLeft||n.scrollLeft,c=i.clientTop||n.clientTop||0,r=i.clientLeft||n.clientLeft||0;return{top:t.top+o-c,left:t.left+s-r}},i=(e,t)=>{const n=t.querySelectorAll(e.cssSels.section),i=[];return n&&n.length&&n.forEach((e=>{i.push(e)})),i},o=e=>{const t=[],i=[];let o=0;return e&&e.length?(o=e.length-1,[].forEach.call(e,(function(e){t.push(e.getBoundingClientRect()),i.push(n(e))}))):(t.push(e.getBoundingClientRect()),i.push(n(e))),{rect:{left:t[0].left,right:t[0].right,top:t[0].top,bottom:t[o].bottom,width:t[0].width||t[0].right-t[0].left,height:i[o].top-i[0].top+(t[o].bottom-t[o].top)},offset:i[0]}},s=e=>!(0===e.offsetWidth&&0===e.offsetHeight),c=()=>({top:window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,left:window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}),r=(e,t)=>{let n="";if(3===t.nodeType)n=t.nodeValue;else if(1===t.nodeType&&-1===e.tagListIgnore.indexOf(t.nodeName)){const i=t.childNodes;for(let t=i.length;t--;)n+=r(e,i[t])}return n},l=(e,t=100,n=!1)=>{let i=null;return(...o)=>{null!==i?clearTimeout(i):n&&e(...o),i="undefined"!=typeof window?window.setTimeout((()=>{n||e(...o),i=null}),t):null}},a=e=>Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&"),d=e=>{var t,n,i,o,s,c;const r=(e?[["marker_author",e.marker_author],["canonical",e.canonical],["description",e.description],["published_time",e.published_time],["marker_source",e.marker_source],["title",e.title]]:[["marker_author",null===(t=document.querySelector('meta[property="marker:author"]'))||void 0===t?void 0:t.content],["canonical",null===(n=document.querySelector('link[rel="canonical"]'))||void 0===n?void 0:n.href],["description",null===(i=document.querySelector('meta[property="og:description"]'))||void 0===i?void 0:i.content],["published_time",null===(o=document.querySelector('meta[property="article:published_time"]'))||void 0===o?void 0:o.content],["marker_source",null===(s=document.querySelector('meta[property="marker:source"]'))||void 0===s?void 0:s.content],["title",null===(c=document.querySelector('meta[property="og:title"]'))||void 0===c?void 0:c.content]]).filter((([,e])=>"string"==typeof e));return Object.fromEntries(r.map((([e,t])=>[e,encodeURIComponent(t)])))};function u(e){const{elems:t}=this,n={};for(const e in t){let i=t[e];if(Object.prototype.hasOwnProperty.call(t,e)&&i)if("section"===e&&(i||[]).length){n[e]=[];for(let t=0;t<i.length;t++)n[e][t]=o(i[t])}else{if("article"===e){const e=(i||{}).length;"number"==typeof e&&e>2&&(i=[i[0],i[e-1]])}n[e]=o(i)}}if(e){const{article:e,section:t}=n,i=t.length-1;e.swipeToSiteWidth=e.rect.width-t[i].rect.width}this.sizes=n}const m=function(e,t){const{sizes:n,elems:i,marks:o}=this,{dimensions:s,section:c}=e,r=s[t],l=o||{};let a,d,u;if(i.section&&i.section.length)for(a=i.section.length,d=0;d<a;d++){const e=n.section[d],t=e.offset[r.section.start];u=l[d],u||(u={}),u.meta=d+1,u.pos=t,d===a-1&&(u.posEnd=t+e.rect[r.section.size]-4),l[d]=u}else{a=c.count;const e=n.article.offset[r.article.start],t=n.article.rect[r.article.size];let i=t/a;for(i<c.minSize&&(a=Math.floor(t/c.minSize),i=t/a),d=0;d<a;d++)u=l[d],u||(u={}),u.pos=e+i*d,d===a-1&&(u.posEnd=e+t),l[d]=u}this.marks=l};function p(e,t,n){if("horizontal"===t)return;const{dictionary:i,dimensions:o,cssClss:s}=e,c=o[t],r=this.marks;let l=this.nodes;l||(l=[]);const a=e=>{const t=c.mark.style,n=document.createElement("div");if(n.classList.add(s.mark),n.style.cssText=t.mark,!e){const e=document.createElement("span");e.style.cssText=t.label,n.appendChild(e)}return n};if(n){const e=[],t=document.createDocumentFragment();let n="";const o=Math.max(l.length,r.length);for(let s=0;s<o;s++){const u=r[s];let m=l[s],p=l[o-1];u&&(m||(m=a(),t.appendChild(m)),p||(p=a(!0),t.appendChild(p)),m.style[c.mark.pos]=u.pos+"px",u.posEnd&&(p.style[c.mark.pos]=u.posEnd+"px"),d=s+1,n=i.section+" "+d,m.firstChild&&(m.firstChild.textContent=n),e[s]=m,e.push(p))}document.body.appendChild(t),l=e}else if(l.length){for(let e=0;e<l.length;e++)document.body.removeChild(l[e]);l=null}var d;this.nodes=l}function h(e){const t=this,{cssClss:n,accessStyles:i,ACCESS_URL:o}=e;if(t.isDebugMode){const e=document.querySelector(`.${n.access}`);e&&e.remove();const s=document.createElement("form");s.style.cssText=i.root,s.className=n.access,s.method="post",s.action=o;const c=document.createElement("button");c.textContent="Share stat",c.style.cssText=i.button;const r=[{name:"token",value:t.token},{name:"title",value:document.title}],l=document.querySelector('meta[name="description"]');l&&r.push({name:"description",value:l.content});const a=document.querySelector("link[rel='canonical']");a&&r.push({name:"canonical",value:a.href});const d=document.querySelector('meta[property="article:published_time"]');d&&r.push({name:"published_time",value:d.content});for(let e=0;e<r.length;e++){const t=document.createElement("input");t.hidden=!0,t.name=r[e].name,t.value=r[e].value,s.appendChild(t)}s.appendChild(c);const u=document.createDocumentFragment();u.appendChild(s),document.body.appendChild(u)}}function f(n,i){if("error"===this.requestStatus)return;const o=this,{type:s,orientation:c,initialMarkers:r}=i,l=`${s}:${Date.now()}`,u=d(r);if("process"===o.requestStatus)return void(o.requestString+=`${l},`);let m={e:`${o.requestString}${l}`};o.requestString="","v"===s&&(m=Object.assign(Object.assign(Object.assign({},m),u),{chars:o.charsCount,platform:o.platform})),"horizontal"===c&&s.includes("s")&&(m=Object.assign(Object.assign(Object.assign({},m),u),{slides:o.slidesCount,platform:o.platform})),o.isDebugMode&&e(`Отправляем ${i.type} - ${JSON.stringify(m)}`,!0),o.requestStatus="process",fetch(n.FETCH_URL,{method:"POST",mode:"cors",headers:{Authorization:`Bearer ${o.token}`,"Content-Type":"application/x-www-form-urlencoded"},body:a(m),credentials:"include"}).then((e=>{if(e.status>=400)throw e.text();return e.text()})).then((e=>{e&&(o.token=e,o.requestStatus="success",h.call(o,n))})).catch((e=>{t(e.message),o.requestStatus="error"}))}function g(t,n,i,o,s){var c;const r=this,l=r.events,a=null===(c=r.elems.section)||void 0===c?void 0:c.length,d=f.bind(r,t);let u=[n+i];const m=r.marks[i];if(a)try{u=[n+m.meta].concat(["_"+n+i])}catch(t){this.isDebugMode?window.console.error(t):e("Произошла ошибка, подробности в debug mode")}u.forEach((function(t){function i(){-1!==t.indexOf("_")?r.isDebugMode&&e(`Сгенерировано псевдособытие ${t}`,!0):d({initialMarkers:s,orientation:o,type:t})}"s"===n?l.has(t)||(l.add(t),i()):i()}))}function b(e,t){const n="horizontal"===t,i=this,o=i.elems,c=e.timeouts.hit,r=i.timers.hit;r&&clearTimeout(r),n&&"number"!=typeof i.currentSlide||!n&&"number"!=typeof i.readingSection||(i.timers.hit=window.setTimeout((function t(){const r=[].every.call(o.section?o.section:o.article,s);i.isStarted&&i.isActivePage&&(n&&"number"==typeof i.currentSlide&&g.call(i,e,"t",i.currentSlide),!n&&"number"==typeof i.readingSection&&r&&g.call(i,e,"t",i.readingSection+1)),i.timers.hit=window.setTimeout(t,c)}),c))}function y(e){const{elems:t,isActivePage:n,isInited:i,isStarted:o,marks:r,sizes:l,readingSection:a}=this,d=t.section&&t.section.length,u=[].every.call(d?t.section:t.article,s);if(!(n&&i&&o&&u))return;const m=e.dimensions.vertical,p=c();let h=p[m.viewport.start],f=p[m.viewport.size];t.parent!=document.body&&(h=l.parent.offset[m.parent.offsetStart],f=Math.min(f,t.parent[m.parent.clientSize]));const y=h+f*e.triggerArea,S=h+f,v=d?t.section.length-1:e.section.count,w=d?r[v].pos:l.article.offset[m.article.start]+l.article.rect[m.article.size],k={reading:a,current:null};for(let t=0;t<r.length;t++){const n=r[t];n.pos<S&&(g.call(this,e,"s",t+1),t<v&&(0===t||n.pos<y)&&(k.current=t))}w<h&&(k.current=null),k.current!=k.reading&&(this.readingSection=k.current,b.call(this,e))}function S(e,t){const n=this;document.location.hash.slice(1)===e.debugHash&&(n.isStarted&&p.call(n,e,t),n.isDebugMode=!0)}function v(){const{platform:t,isDebugMode:n}=this;this.platform=(()=>{if((window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=600)return"mobile";const e=navigator.userAgent,t=[/iPhone/i,/iPod/i,/iPad/i,/Android/i,/IEMobile/i,/(?=.*\bWindows\b)(?=.*\bARM\b)/i,/BlackBerry/i,/BB10/i,/Opera Mini/i,/(CriOS|Chrome)(?=.*\bMobile\b)/i,/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,/(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)/i];for(let n=0,i=t.length;n<i;++n)if(t[n].test(e))return"mobile";return"desktop"})(),n&&e(`Опция platform определена как ${t}`,!0)}function w(t,n){var o;const s=this,{cssSels:c}=t;if(s.elems.parent=document.querySelector(c.scrollCont)||document.querySelector("body"),s.elems.parent)if(s.elems.article=s.elems.parent.querySelector(c.article),"horizontal"===n)s.elems.section=i(t,s.elems.parent),(null===(o=s.elems.section)||void 0===o?void 0:o.length)||e(`Не найдено ни одной секции ${c.section}`),s.elems.article||e(`На странице отсутствует контейнер для статьи-диафильма ${c.article}`);else if(s.elems.article||(s.elems.article=s.elems.parent.querySelector("article")),s.elems.article||e(`На странице отсутствует контейнер для статьи ${c.article} или <article>`),options.entityID){const e=s.elems.parent.querySelector(`[${t.dataAttrs.article}="${options.entityID}"]`);e&&(s.elems.article=e)}}function k(e){const t=((e,t)=>{let n="";return t&&(n+=r(e,t)),n})(e,this.elems.article);this.charsCount=t.length}function z(e,t,n){const i=n||window,o=this.handlers,s=e.split(" ");for(let e=0;e<s.length;e++){const n={el:i,name:"",func:t},c=s[e];"visibilitychange"==c?(n.el=document,n.name=c,document.addEventListener("visibilitychange",t)):(n.name=c,i.addEventListener(c,t)),o.push(n)}}function x(t,n,i,o){const s=this,c="horizontal"===o;"boolean"!=typeof n&&(n=document.hasFocus()),s.isActivePage=n,s.isDebugMode&&e(`пользователь ${n?"активен":"не активен"} ${i?"(активность:"+i+")":""}`,!0),!c&&n&&s.isStarted&&y.call(s,t)}function C(){const t=this;t.isStarted&&(t.isActivePage=!1,t.isDebugMode&&e("пользователь не активен",!0))}let E=null;function A(e,t,n){const i="horizontal"===n,o=this,{elems:s}=o,c=s.parent,r=e.timeouts,a=t.recalculate;E||(E=l(C.bind(o),r.sleep));const d=E,u=z.bind(o);if(u("resize",l(a,r.resize)),!i){const t=y.bind(o,e);document.body!==c?u("scroll",l((function(){o.isActivePage=!0,d(),a(),t()}),r.scroll),c):u("scroll",l(t,r.scroll))}u("load",a),u("hashchange",t.checkHash),u("visibilitychange blur focus",(function(t){d();const i=t.type,s=i in e.events_map?e.events_map[i]:!document.hidden;x.call(o,e,s,i,n)})),u("load resize scroll click touchstart keydown hashchange",l(function(t){d(),x.call(o,e,null,t.type,n)}.bind(this),300,!0)),d()}function T(e,t){const n=this,c=n.elems,r=e.dimensions.vertical,l=e.timeouts.size;let a=document.documentElement[r.page.scrollSize],d=n.sizes.parent.rect[r.parent.size];!function u(){const m=document.documentElement[r.page.scrollSize],p=o(c.parent).rect[r.parent.size],h=c.section&&c.section.length,f=[].every.call(h?c.section:c.article,s);m===a&&d===p||!f||(a=m,d=p,h&&(c.section=i(e,n.elems.parent)),t()),n.timers.size=window.setTimeout(u,l)}()}function _(t){const n=this;n.isInited||e("Предварительная инициализация не пройдена");const i=n.isStarted;let o=t;"boolean"==typeof t?i===t&&e("Ошибка при настройке активности модуля"):o=!i,n.isStarted=o}function M(){const e=this.timers;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&clearTimeout(Number(t))}function D(){this.handlers.forEach((function(e){const t=e.func,n=e.name;e.el.removeEventListener(n,t)}))}function O(){const e=this;e.isStarted||(D.call(e),M.call(e))}const q={MODULE_NAME:"__mediaStat",FETCH_URL:"https://media-stat.mail.ru/metrics/1.0/",FETCH_TOKEN_URL:"https://media-stat.mail.ru/token/1.0/",ACCESS_URL:"https://media-stat.mail.ru/grant_access/1.0/",cssSels:{scrollCont:".js-media-stat-container",article:".js-media-stat-article",section:".js-media-stat-section"},dataAttrs:{article:"data-media-stat-entityid"},cssClss:{mark:"js-media-stat-mark",access:"js-media-stat-access"},tagListIgnore:["TEXTAREA","SCRIPT","STYLE"],debugHash:"media-stat-debug",timeouts:{sleep:3e4,hit:5e3,size:2e3,scroll:300,resize:300},triggerArea:.66,section:{minSize:0,count:3},accessStyles:{root:"position: fixed;top: 50%;left: 16px;z-index: 9999;",button:"border: none;background: #ccc;color: #08313a;background: #5cd85a;padding: 10px;border-radius: 4px;"},dimensions:{vertical:{viewport:{start:"top",size:"height"},page:{scrollSize:"scrollHeight"},parent:{offsetStart:"top",clientSize:"clientHeight",size:"height"},article:{start:"top",size:"height"},section:{start:"top",size:"height"},mark:{pos:"top",style:{mark:"position: absolute; left: 0px; right: 0px; height: 4px; z-index: 9999; background: #5CD85A;",label:"position: absolute;top: -34px;left: 16px;font-family: Arial;font-size: 14px;color: #08313A;background: #5CD85A;padding: 8px;height: 20px;display: inline-block;border-radius: 4px;"}}},horizontal:{viewport:{start:"left",size:"width"},page:{scrollSize:"scrollWidth"},parent:{offsetStart:"left",clientSize:"clientWidth",size:"width"},article:{start:"left",size:"width"},section:{start:"left",size:"width"},mark:{pos:"left",style:{mark:"position: absolute;bottom: 0px;top: 0px;width: 4px;z-index: 9999;background: #5CD85A;left: 0px;",label:"position: relative;top: 0px;left: 0px;width: 120px;font-family: Arial;font-size: 14px;color: #08313A;background: #5CD85A;line-height: 32px;padding: 0px 16px;display: inline-block;border-radius: 3px;"}}}},dictionary:{section:"Начало секции",noArticle:{title:"Предупреждение",text:"на странице отсутствует контейнер для статьи"}},events_map:{focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1}},I="vertical";let L={};const $=()=>{u.call(L),m.call(L,q,I),p.call(L,q,I,L.isDebugMode),L.isStarted&&y.call(L,q)},P=()=>{L={isInited:!1,isStarted:!1,isDebugMode:!1,isActivePage:!1,platform:void 0,token:options.token,elems:{parent:null,article:null,section:null},charsCount:0,slidesCount:0,nodes:[],marks:[],sizes:{},timers:{},readingSection:null,handlers:[],events:new Set,requestString:"",requestStatus:"initial"},S.call(L,q,I),v.call(L),L.isInited=!0},j=e=>{w.call(L,q,I),k.call(L,q),A.call(L,q,{recalculate:$.bind(L),checkHash:S.bind(L,q,I)}),$(),x.call(L,q),T.call(L,q,$),f.call(L,q,{type:"v",initialMarkers:null==e?void 0:e.markers}),_.call(L,!0)};(n=>{const i=()=>{window[q.MODULE_NAME]=function(){try{P(),options.autostart?j():O.call(L)}catch(t){L.isDebugMode?window.console.error(t):e("Произошла ошибка, подробности в debug mode")}return{start:n=>{if(L.isInited)if(!n.markers||n.markers.title&&n.markers.canonical)try{if(L.isStarted)return void e("start API, модуль уже запущен, для использования start сначала необходимо сделать stop");const i={project_uuid:options.projectUUID,entity_type:options.entityType,entity_type_id:options.entityTypeID};n.entityId&&(i.entity_id=n.entityId),n.model&&(i.model=n.model),fetch(q.FETCH_TOKEN_URL,{method:"POST",mode:"cors",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a(i)}).then((e=>{if(e.status>=400)throw e.text();return e.text()})).then((t=>{t&&(options.entityID=n.entityId,options.token=t,L.isDebugMode&&e("start API, работа модуля запущена",!0),P(),j(n),x.call(L,q))})).catch((e=>{e.then((e=>{t(e)}))}))}catch(e){window.console.error(e)}else e("start API, поля `markers.title` и `markers.canonical` обязательны и не могут быть пустыми")},stop:()=>{_.call(L,!1),p.call(L,q,I,!1),O.call(L),L.isDebugMode&&e("stop API, работа модуля остановлена",!0)},pause:()=>{_.call(L,!1),L.isDebugMode&&e("pause API, работа модуля приостановлена",!0)},continue:()=>{_.call(L,!0),L.isDebugMode&&e("continue API, работа модуля продолжена",!0)},isActive:()=>L.isStarted}}()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()})()})();
}());